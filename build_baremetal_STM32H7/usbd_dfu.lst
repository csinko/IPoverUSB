ARM GAS  /tmp/ccCRZMdU.s 			page 1


   1              		.cpu cortex-m7
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 2
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"usbd_dfu.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.rodfu_getDesc,"ax",%progbits
  18              		.align	1
  19              		.p2align 2,,3
  20              		.arch armv7e-m
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  24              		.fpu fpv4-sp-d16
  26              	rodfu_getDesc:
  27              	.LVL0:
  28              	.LFB149:
  29              		.file 1 "USBDevice/Class/DFU/usbd_dfu.c"
   1:USBDevice/Class/DFU/usbd_dfu.c **** /**
   2:USBDevice/Class/DFU/usbd_dfu.c ****   ******************************************************************************
   3:USBDevice/Class/DFU/usbd_dfu.c ****   * @file    usbd_dfu.c
   4:USBDevice/Class/DFU/usbd_dfu.c ****   * @author  Benedek Kupper
   5:USBDevice/Class/DFU/usbd_dfu.c ****   * @version 0.1
   6:USBDevice/Class/DFU/usbd_dfu.c ****   * @date    2018-03-11
   7:USBDevice/Class/DFU/usbd_dfu.c ****   * @brief   USB Device Firmware Upgrade Class implementation
   8:USBDevice/Class/DFU/usbd_dfu.c ****   *
   9:USBDevice/Class/DFU/usbd_dfu.c ****   * Copyright (c) 2018 Benedek Kupper
  10:USBDevice/Class/DFU/usbd_dfu.c ****   *
  11:USBDevice/Class/DFU/usbd_dfu.c ****   * Licensed under the Apache License, Version 2.0 (the "License");
  12:USBDevice/Class/DFU/usbd_dfu.c ****   * you may not use this file except in compliance with the License.
  13:USBDevice/Class/DFU/usbd_dfu.c ****   * You may obtain a copy of the License at
  14:USBDevice/Class/DFU/usbd_dfu.c ****   *
  15:USBDevice/Class/DFU/usbd_dfu.c ****   *     http://www.apache.org/licenses/LICENSE-2.0
  16:USBDevice/Class/DFU/usbd_dfu.c ****   *
  17:USBDevice/Class/DFU/usbd_dfu.c ****   * Unless required by applicable law or agreed to in writing, software
  18:USBDevice/Class/DFU/usbd_dfu.c ****   * distributed under the License is distributed on an "AS IS" BASIS,
  19:USBDevice/Class/DFU/usbd_dfu.c ****   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  20:USBDevice/Class/DFU/usbd_dfu.c ****   * See the License for the specific language governing permissions and
  21:USBDevice/Class/DFU/usbd_dfu.c ****   * limitations under the License.
  22:USBDevice/Class/DFU/usbd_dfu.c ****   */
  23:USBDevice/Class/DFU/usbd_dfu.c **** #include <private/usbd_internal.h>
  24:USBDevice/Class/DFU/usbd_dfu.c **** #include <usbd_dfu.h>
  25:USBDevice/Class/DFU/usbd_dfu.c **** 
  26:USBDevice/Class/DFU/usbd_dfu.c **** #include <string.h>
  27:USBDevice/Class/DFU/usbd_dfu.c **** 
  28:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
  29:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_APP(ITF)    ((USBD_DFU_AppType*)(&(ITF)->App[(ITF)->Base.AltSelector]))
ARM GAS  /tmp/ccCRZMdU.s 			page 2


  30:USBDevice/Class/DFU/usbd_dfu.c **** #else
  31:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_APP(ITF)    ((USBD_DFU_AppType*)((ITF)->App))
  32:USBDevice/Class/DFU/usbd_dfu.c **** #endif
  33:USBDevice/Class/DFU/usbd_dfu.c **** 
  34:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_CLASS_REQ_COUNT (sizeof(dfu_validStates)/sizeof(dfu_validStates[0]))
  35:USBDevice/Class/DFU/usbd_dfu.c **** 
  36:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_ATTR_WILL_DETACH            0x08
  37:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_ATTR_MANIFESTATION_TOLERANT 0x04
  38:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_ATTR_CAN_UPLOAD             0x02
  39:USBDevice/Class/DFU/usbd_dfu.c **** #define DFU_ATTR_CAN_DNLOAD             0x01
  40:USBDevice/Class/DFU/usbd_dfu.c **** 
  41:USBDevice/Class/DFU/usbd_dfu.c **** #ifndef USBD_DFU_ST_EXTENSION
  42:USBDevice/Class/DFU/usbd_dfu.c **** #define USBD_DFU_ST_EXTENSION           0
  43:USBDevice/Class/DFU/usbd_dfu.c **** #endif
  44:USBDevice/Class/DFU/usbd_dfu.c **** /* DFU STMicroelectronics Extension (DFUSE) commands */
  45:USBDevice/Class/DFU/usbd_dfu.c **** #define DFUSE_CMD_GETCOMMANDS           0x00
  46:USBDevice/Class/DFU/usbd_dfu.c **** #define DFUSE_CMD_SETADDRESSPOINTER     0x21
  47:USBDevice/Class/DFU/usbd_dfu.c **** #define DFUSE_CMD_ERASE                 0x41
  48:USBDevice/Class/DFU/usbd_dfu.c **** #define DFUSE_CMD_READ_UNPROTECT        0x92
  49:USBDevice/Class/DFU/usbd_dfu.c **** 
  50:USBDevice/Class/DFU/usbd_dfu.c **** #define DFUSE_GETADDRESS(ITF, DESC)     \
  51:USBDevice/Class/DFU/usbd_dfu.c ****     ((uint8_t*)((ITF)->Address + (((ITF)->BlockNum - 2) * (DESC)->DFUFD.wTransferSize)))
  52:USBDevice/Class/DFU/usbd_dfu.c **** 
  53:USBDevice/Class/DFU/usbd_dfu.c **** typedef struct {
  54:USBDevice/Class/DFU/usbd_dfu.c ****     uint8_t  bLength;
  55:USBDevice/Class/DFU/usbd_dfu.c ****     uint8_t  bDescriptorType;
  56:USBDevice/Class/DFU/usbd_dfu.c ****     uint8_t  bmAttributes; /*
  57:USBDevice/Class/DFU/usbd_dfu.c ****                             [bitCanDnload]
  58:USBDevice/Class/DFU/usbd_dfu.c ****                             [bitCanUpload]
  59:USBDevice/Class/DFU/usbd_dfu.c ****                             [bitManifestationTolerant] means no USB reset is needed
  60:USBDevice/Class/DFU/usbd_dfu.c ****                             [bitWillDetach] means Disconnect-Connect for DFU_DETACH
  61:USBDevice/Class/DFU/usbd_dfu.c ****                             4b reserved */
  62:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t wDetachTimeOut;
  63:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t wTransferSize;
  64:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t bcdDFUVersion;
  65:USBDevice/Class/DFU/usbd_dfu.c **** }__packed USBD_DFU_FuncDescType;
  66:USBDevice/Class/DFU/usbd_dfu.c **** 
  67:USBDevice/Class/DFU/usbd_dfu.c **** 
  68:USBDevice/Class/DFU/usbd_dfu.c **** typedef struct
  69:USBDevice/Class/DFU/usbd_dfu.c **** {
  70:USBDevice/Class/DFU/usbd_dfu.c ****     /* DFU Interface Descriptor */
  71:USBDevice/Class/DFU/usbd_dfu.c ****     USB_InterfaceDescType DFU;
  72:USBDevice/Class/DFU/usbd_dfu.c ****     /* DFU Functional Descriptor */
  73:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_FuncDescType DFUFD;
  74:USBDevice/Class/DFU/usbd_dfu.c **** }__packed USBD_DFU_DescType;
  75:USBDevice/Class/DFU/usbd_dfu.c **** 
  76:USBDevice/Class/DFU/usbd_dfu.c **** 
  77:USBDevice/Class/DFU/usbd_dfu.c **** static const USBD_DFU_DescType dfu_desc = {
  78:USBDevice/Class/DFU/usbd_dfu.c ****     .DFU = { /* DFU Interface Descriptor */
  79:USBDevice/Class/DFU/usbd_dfu.c ****         .bLength            = sizeof(dfu_desc.DFU),
  80:USBDevice/Class/DFU/usbd_dfu.c ****         .bDescriptorType    = USB_DESC_TYPE_INTERFACE,
  81:USBDevice/Class/DFU/usbd_dfu.c ****         .bInterfaceNumber   = 0,
  82:USBDevice/Class/DFU/usbd_dfu.c ****         .bAlternateSetting  = 0,
  83:USBDevice/Class/DFU/usbd_dfu.c ****         .bNumEndpoints      = 0,
  84:USBDevice/Class/DFU/usbd_dfu.c ****         .bInterfaceClass    = 0xFE, /* bInterfaceClass: Application Specific Class Code */
  85:USBDevice/Class/DFU/usbd_dfu.c ****         .bInterfaceSubClass = 0x01, /* bInterfaceSubClass: Device Firmware Upgrade Code */
  86:USBDevice/Class/DFU/usbd_dfu.c ****         .bInterfaceProtocol = 0x02, /* bInterfaceProtocol: 1=runtime, 2=boot mode */
ARM GAS  /tmp/ccCRZMdU.s 			page 3


  87:USBDevice/Class/DFU/usbd_dfu.c ****         .iInterface         = USBD_ISTR_INTERFACES,
  88:USBDevice/Class/DFU/usbd_dfu.c ****     },
  89:USBDevice/Class/DFU/usbd_dfu.c ****     .DFUFD = { /* DFU Functional Descriptor */
  90:USBDevice/Class/DFU/usbd_dfu.c ****         .bLength            = sizeof(dfu_desc.DFUFD),
  91:USBDevice/Class/DFU/usbd_dfu.c ****         .bDescriptorType    = DFU_DESC_TYPE_FUNCTIONAL,
  92:USBDevice/Class/DFU/usbd_dfu.c ****         .bmAttributes       =
  93:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_MANIFEST_TOLERANT != 0)
  94:USBDevice/Class/DFU/usbd_dfu.c ****                               DFU_ATTR_MANIFESTATION_TOLERANT |
  95:USBDevice/Class/DFU/usbd_dfu.c **** #endif
  96:USBDevice/Class/DFU/usbd_dfu.c ****                               DFU_ATTR_WILL_DETACH,
  97:USBDevice/Class/DFU/usbd_dfu.c ****         .wDetachTimeOut     = 100,  /* Wait time [ms] between DFU_DETACH and USB reset */
  98:USBDevice/Class/DFU/usbd_dfu.c ****         .wTransferSize      = USBD_EP0_BUFFER_SIZE,
  99:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 100:USBDevice/Class/DFU/usbd_dfu.c ****         .bcdDFUVersion      = 0x011A,
 101:USBDevice/Class/DFU/usbd_dfu.c **** #else
 102:USBDevice/Class/DFU/usbd_dfu.c ****         .bcdDFUVersion      = 0x0101,
 103:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 104:USBDevice/Class/DFU/usbd_dfu.c ****     },
 105:USBDevice/Class/DFU/usbd_dfu.c **** };
 106:USBDevice/Class/DFU/usbd_dfu.c **** 
 107:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 108:USBDevice/Class/DFU/usbd_dfu.c **** __alignment(USBD_DATA_ALIGNMENT)
 109:USBDevice/Class/DFU/usbd_dfu.c **** /* List of supported DFU SE commands */
 110:USBDevice/Class/DFU/usbd_dfu.c **** static const uint8_t dfuse_cmds[] __align(USBD_DATA_ALIGNMENT) = {
 111:USBDevice/Class/DFU/usbd_dfu.c ****     DFUSE_CMD_GETCOMMANDS,
 112:USBDevice/Class/DFU/usbd_dfu.c ****     DFUSE_CMD_SETADDRESSPOINTER,
 113:USBDevice/Class/DFU/usbd_dfu.c ****     DFUSE_CMD_ERASE,
 114:USBDevice/Class/DFU/usbd_dfu.c **** };
 115:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 116:USBDevice/Class/DFU/usbd_dfu.c **** 
 117:USBDevice/Class/DFU/usbd_dfu.c **** /** @brief Bitmask stores which request (key) is valid in which DFU states (value) */
 118:USBDevice/Class/DFU/usbd_dfu.c **** static const uint16_t dfu_validStates[] = {
 119:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_DETACH */
 120:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_APP_IDLE),
 121:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_DNLOAD */
 122:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_IDLE) | (1 << DFU_STATE_DNLOAD_IDLE),
 123:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_UPLOAD */
 124:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_IDLE) | (1 << DFU_STATE_UPLOAD_IDLE),
 125:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_GETSTATUS */
 126:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_APP_IDLE)    | (1 << DFU_STATE_APP_DETACH) |
 127:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_IDLE)        | (1 << DFU_STATE_DNLOAD_SYNC) |
 128:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_DNLOAD_IDLE) | (1 << DFU_STATE_MANIFEST_SYNC) |
 129:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_UPLOAD_IDLE) | (1 << DFU_STATE_ERROR),
 130:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_CLRSTATUS */
 131:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_ERROR),
 132:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_GETSTATE */
 133:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_APP_IDLE)    | (1 << DFU_STATE_APP_DETACH) |
 134:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_IDLE)        | (1 << DFU_STATE_DNLOAD_SYNC) |
 135:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_DNLOAD_IDLE) | (1 << DFU_STATE_MANIFEST_SYNC) |
 136:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_UPLOAD_IDLE) | (1 << DFU_STATE_ERROR),
 137:USBDevice/Class/DFU/usbd_dfu.c ****         /* DFU_REQ_ABORT */
 138:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_IDLE)        | (1 << DFU_STATE_DNLOAD_SYNC) |
 139:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_DNLOAD_IDLE) | (1 << DFU_STATE_MANIFEST_SYNC) |
 140:USBDevice/Class/DFU/usbd_dfu.c ****         (1 << DFU_STATE_UPLOAD_IDLE),
 141:USBDevice/Class/DFU/usbd_dfu.c **** };
 142:USBDevice/Class/DFU/usbd_dfu.c **** 
 143:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_detach       (USBD_DFU_IfHandleType *itf);
ARM GAS  /tmp/ccCRZMdU.s 			page 4


 144:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_download     (USBD_DFU_IfHandleType *itf);
 145:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_upload       (USBD_DFU_IfHandleType *itf);
 146:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_getStatus    (USBD_DFU_IfHandleType *itf);
 147:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_clearStatus  (USBD_DFU_IfHandleType *itf);
 148:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_getState     (USBD_DFU_IfHandleType *itf);
 149:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_abort        (USBD_DFU_IfHandleType *itf);
 150:USBDevice/Class/DFU/usbd_dfu.c **** 
 151:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 152:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t         dfu_getAltsDesc (USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 153:USBDevice/Class/DFU/usbd_dfu.c **** #else
 154:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t         dfu_getDesc     (USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 155:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 156:USBDevice/Class/DFU/usbd_dfu.c **** static const char *     dfu_getString   (USBD_DFU_IfHandleType *itf, uint8_t intNum);
 157:USBDevice/Class/DFU/usbd_dfu.c **** static void             dfu_init        (USBD_DFU_IfHandleType *itf);
 158:USBDevice/Class/DFU/usbd_dfu.c **** static void             dfu_deinit      (USBD_DFU_IfHandleType *itf);
 159:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType  dfu_setupStage  (USBD_DFU_IfHandleType *itf);
 160:USBDevice/Class/DFU/usbd_dfu.c **** static void             dfu_dataStage   (USBD_DFU_IfHandleType *itf);
 161:USBDevice/Class/DFU/usbd_dfu.c **** 
 162:USBDevice/Class/DFU/usbd_dfu.c **** 
 163:USBDevice/Class/DFU/usbd_dfu.c **** /* DFU interface class callbacks structure */
 164:USBDevice/Class/DFU/usbd_dfu.c **** static const USBD_ClassType dfu_cbks = {
 165:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 166:USBDevice/Class/DFU/usbd_dfu.c ****     .GetDescriptor  = (USBD_IfDescCbkType)  dfu_getAltsDesc,
 167:USBDevice/Class/DFU/usbd_dfu.c **** #else
 168:USBDevice/Class/DFU/usbd_dfu.c ****     .GetDescriptor  = (USBD_IfDescCbkType)  dfu_getDesc,
 169:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 170:USBDevice/Class/DFU/usbd_dfu.c ****     .GetString      = (USBD_IfStrCbkType)   dfu_getString,
 171:USBDevice/Class/DFU/usbd_dfu.c ****     .Init           = (USBD_IfCbkType)      dfu_init,
 172:USBDevice/Class/DFU/usbd_dfu.c ****     .Deinit         = (USBD_IfCbkType)      dfu_deinit,
 173:USBDevice/Class/DFU/usbd_dfu.c ****     .SetupStage     = (USBD_IfSetupCbkType) dfu_setupStage,
 174:USBDevice/Class/DFU/usbd_dfu.c ****     .DataStage      = (USBD_IfCbkType)      dfu_dataStage,
 175:USBDevice/Class/DFU/usbd_dfu.c **** };
 176:USBDevice/Class/DFU/usbd_dfu.c **** 
 177:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType (*const dfu_reqFns[])(USBD_DFU_IfHandleType *itf) = {
 178:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_detach,
 179:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_download,
 180:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_upload,
 181:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_getStatus,
 182:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_clearStatus,
 183:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_getState,
 184:USBDevice/Class/DFU/usbd_dfu.c ****     dfu_abort,
 185:USBDevice/Class/DFU/usbd_dfu.c **** };
 186:USBDevice/Class/DFU/usbd_dfu.c **** 
 187:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t         rodfu_getDesc   (USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 188:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType  rodfu_setupStage(USBD_DFU_IfHandleType *itf);
 189:USBDevice/Class/DFU/usbd_dfu.c **** 
 190:USBDevice/Class/DFU/usbd_dfu.c **** /* Reboot-only DFU interface class callbacks structure */
 191:USBDevice/Class/DFU/usbd_dfu.c **** static const USBD_ClassType rodfu_cbks = {
 192:USBDevice/Class/DFU/usbd_dfu.c ****     .GetDescriptor  = (USBD_IfDescCbkType)  rodfu_getDesc,
 193:USBDevice/Class/DFU/usbd_dfu.c ****     .GetString      = (USBD_IfStrCbkType)   dfu_getString,
 194:USBDevice/Class/DFU/usbd_dfu.c ****     .SetupStage     = (USBD_IfSetupCbkType) rodfu_setupStage,
 195:USBDevice/Class/DFU/usbd_dfu.c **** };
 196:USBDevice/Class/DFU/usbd_dfu.c **** 
 197:USBDevice/Class/DFU/usbd_dfu.c **** /** @ingroup USBD_DFU
 198:USBDevice/Class/DFU/usbd_dfu.c ****  * @defgroup USBD_DFU_Private_Functions DFU Private Functions
 199:USBDevice/Class/DFU/usbd_dfu.c ****  * @{ */
 200:USBDevice/Class/DFU/usbd_dfu.c **** 
ARM GAS  /tmp/ccCRZMdU.s 			page 5


 201:USBDevice/Class/DFU/usbd_dfu.c **** /**
 202:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Copies the interface descriptor to the destination buffer.
 203:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 204:USBDevice/Class/DFU/usbd_dfu.c ****  * @param ifNum: the index of the current interface in the device
 205:USBDevice/Class/DFU/usbd_dfu.c ****  * @param dest: the destination buffer
 206:USBDevice/Class/DFU/usbd_dfu.c ****  * @return Length of the copied descriptor
 207:USBDevice/Class/DFU/usbd_dfu.c ****  */
 208:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t rodfu_getDesc(USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 209:USBDevice/Class/DFU/usbd_dfu.c **** {
  30              		.loc 1 209 1 view -0
  31              		.cfi_startproc
  32              		@ args = 0, pretend = 0, frame = 0
  33              		@ frame_needed = 0, uses_anonymous_args = 0
  34              		@ link register save eliminated.
 210:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
  35              		.loc 1 210 5 view .LVU1
 209:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
  36              		.loc 1 209 1 is_stmt 0 view .LVU2
  37 0000 F0B4     		push	{r4, r5, r6, r7}
  38              	.LCFI0:
  39              		.cfi_def_cfa_offset 16
  40              		.cfi_offset 4, -16
  41              		.cfi_offset 5, -12
  42              		.cfi_offset 6, -8
  43              		.cfi_offset 7, -4
 211:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = sizeof(dfu_desc);
 212:USBDevice/Class/DFU/usbd_dfu.c **** 
 213:USBDevice/Class/DFU/usbd_dfu.c ****     memcpy(dest, &dfu_desc, sizeof(dfu_desc));
  44              		.loc 1 213 5 view .LVU3
  45 0002 0A4D     		ldr	r5, .L4
 209:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
  46              		.loc 1 209 1 view .LVU4
  47 0004 1446     		mov	r4, r2
  48 0006 0E46     		mov	r6, r1
  49 0008 0746     		mov	r7, r0
  50              		.loc 1 213 5 view .LVU5
  51 000a 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
  52              	.LVL1:
 211:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = sizeof(dfu_desc);
  53              		.loc 1 211 5 is_stmt 1 view .LVU6
  54              		.loc 1 213 5 view .LVU7
  55 000c B5F800C0 		ldrh	ip, [r5]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 215:USBDevice/Class/DFU/usbd_dfu.c **** 
 216:USBDevice/Class/DFU/usbd_dfu.c ****     /* Adjustment of interface indexes */
 217:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFU.bInterfaceNumber = ifNum;
 218:USBDevice/Class/DFU/usbd_dfu.c **** 
 219:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFU.iInterface = USBD_IIF_INDEX(ifNum, 0);
  56              		.loc 1 219 28 is_stmt 0 view .LVU8
  57 0010 751C     		adds	r5, r6, #1
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
  58              		.loc 1 213 5 view .LVU9
  59 0012 2060     		str	r0, [r4]	@ unaligned
 220:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 221:USBDevice/Class/DFU/usbd_dfu.c **** }
  60              		.loc 1 221 1 view .LVU10
  61 0014 1220     		movs	r0, #18
ARM GAS  /tmp/ccCRZMdU.s 			page 6


 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
  62              		.loc 1 213 5 view .LVU11
  63 0016 A260     		str	r2, [r4, #8]	@ unaligned
  64 0018 E360     		str	r3, [r4, #12]	@ unaligned
  65 001a A4F810C0 		strh	ip, [r4, #16]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
  66              		.loc 1 214 5 is_stmt 1 view .LVU12
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
  67              		.loc 1 213 5 is_stmt 0 view .LVU13
  68 001e 6160     		str	r1, [r4, #4]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
  69              		.loc 1 214 32 view .LVU14
  70 0020 BB8A     		ldrh	r3, [r7, #20]
 217:USBDevice/Class/DFU/usbd_dfu.c **** 
  71              		.loc 1 217 32 view .LVU15
  72 0022 A670     		strb	r6, [r4, #2]
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
  73              		.loc 1 214 32 view .LVU16
  74 0024 A381     		strh	r3, [r4, #12]	@ unaligned
 217:USBDevice/Class/DFU/usbd_dfu.c **** 
  75              		.loc 1 217 5 is_stmt 1 view .LVU17
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
  76              		.loc 1 219 5 view .LVU18
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
  77              		.loc 1 219 26 is_stmt 0 view .LVU19
  78 0026 2572     		strb	r5, [r4, #8]
 220:USBDevice/Class/DFU/usbd_dfu.c **** }
  79              		.loc 1 220 5 is_stmt 1 view .LVU20
  80              		.loc 1 221 1 is_stmt 0 view .LVU21
  81 0028 F0BC     		pop	{r4, r5, r6, r7}
  82              	.LCFI1:
  83              		.cfi_restore 7
  84              		.cfi_restore 6
  85              		.cfi_restore 5
  86              		.cfi_restore 4
  87              		.cfi_def_cfa_offset 0
  88              	.LVL2:
  89              		.loc 1 221 1 view .LVU22
  90 002a 7047     		bx	lr
  91              	.L5:
  92              		.align	2
  93              	.L4:
  94 002c 00000000 		.word	.LANCHOR0
  95              		.cfi_endproc
  96              	.LFE149:
  98              		.section	.text.dfu_getDesc,"ax",%progbits
  99              		.align	1
 100              		.p2align 2,,3
 101              		.syntax unified
 102              		.thumb
 103              		.thumb_func
 104              		.fpu fpv4-sp-d16
 106              	dfu_getDesc:
 107              	.LVL3:
 108              	.LFB150:
 222:USBDevice/Class/DFU/usbd_dfu.c **** 
 223:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
ARM GAS  /tmp/ccCRZMdU.s 			page 7


 224:USBDevice/Class/DFU/usbd_dfu.c **** /**
 225:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Copies the interface descriptor to the destination buffer.
 226:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 227:USBDevice/Class/DFU/usbd_dfu.c ****  * @param ifNum: the index of the current interface in the device
 228:USBDevice/Class/DFU/usbd_dfu.c ****  * @param dest: the destination buffer
 229:USBDevice/Class/DFU/usbd_dfu.c ****  * @return Length of the copied descriptor
 230:USBDevice/Class/DFU/usbd_dfu.c ****  */
 231:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t dfu_getAltsDesc(USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 232:USBDevice/Class/DFU/usbd_dfu.c **** {
 233:USBDevice/Class/DFU/usbd_dfu.c ****     uint8_t as;
 234:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = 0;
 235:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_FuncDescType *desc = (USBD_DFU_FuncDescType*)(dest +
 236:USBDevice/Class/DFU/usbd_dfu.c ****             (itf->Base.AltCount * sizeof(dfu_desc.DFU)));
 237:USBDevice/Class/DFU/usbd_dfu.c **** 
 238:USBDevice/Class/DFU/usbd_dfu.c ****     /* Copy the DFU func desc after the interface descriptors */
 239:USBDevice/Class/DFU/usbd_dfu.c ****     memcpy(desc, &dfu_desc.DFUFD, sizeof(dfu_desc.DFUFD));
 240:USBDevice/Class/DFU/usbd_dfu.c ****     desc->wDetachTimeOut = itf->Config.DetachTimeout_ms;
 241:USBDevice/Class/DFU/usbd_dfu.c **** 
 242:USBDevice/Class/DFU/usbd_dfu.c ****     /* Copy the descriptors many times, add alternate setting indexes */
 243:USBDevice/Class/DFU/usbd_dfu.c ****     for (as = 0; as < itf->Base.AltCount; as++)
 244:USBDevice/Class/DFU/usbd_dfu.c ****     {
 245:USBDevice/Class/DFU/usbd_dfu.c ****         USB_InterfaceDescType *ifdesc = (USB_InterfaceDescType*)&dest[len];
 246:USBDevice/Class/DFU/usbd_dfu.c ****         memcpy(ifdesc, &dfu_desc.DFU, sizeof(dfu_desc.DFU));
 247:USBDevice/Class/DFU/usbd_dfu.c ****         len += sizeof(dfu_desc.DFU);
 248:USBDevice/Class/DFU/usbd_dfu.c **** 
 249:USBDevice/Class/DFU/usbd_dfu.c ****         /* Set attributes */
 250:USBDevice/Class/DFU/usbd_dfu.c ****         if ((itf->App[as].Erase != NULL) && (itf->App[as].Write != NULL))
 251:USBDevice/Class/DFU/usbd_dfu.c ****         {
 252:USBDevice/Class/DFU/usbd_dfu.c ****             desc->bmAttributes |= DFU_ATTR_CAN_DNLOAD;
 253:USBDevice/Class/DFU/usbd_dfu.c ****         }
 254:USBDevice/Class/DFU/usbd_dfu.c ****         if (itf->App[as].Read != NULL)
 255:USBDevice/Class/DFU/usbd_dfu.c ****         {
 256:USBDevice/Class/DFU/usbd_dfu.c ****             desc->bmAttributes |= DFU_ATTR_CAN_UPLOAD;
 257:USBDevice/Class/DFU/usbd_dfu.c ****         }
 258:USBDevice/Class/DFU/usbd_dfu.c **** 
 259:USBDevice/Class/DFU/usbd_dfu.c ****         /* Adjustment of interface indexes */
 260:USBDevice/Class/DFU/usbd_dfu.c ****         ifdesc->bInterfaceNumber = ifNum;
 261:USBDevice/Class/DFU/usbd_dfu.c ****         ifdesc->bAlternateSetting = as;
 262:USBDevice/Class/DFU/usbd_dfu.c **** 
 263:USBDevice/Class/DFU/usbd_dfu.c ****         ifdesc->iInterface = USBD_IIF_INDEX(ifNum, as);
 264:USBDevice/Class/DFU/usbd_dfu.c ****     }
 265:USBDevice/Class/DFU/usbd_dfu.c ****     len += sizeof(dfu_desc.DFUFD);
 266:USBDevice/Class/DFU/usbd_dfu.c **** 
 267:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 268:USBDevice/Class/DFU/usbd_dfu.c **** }
 269:USBDevice/Class/DFU/usbd_dfu.c **** #else
 270:USBDevice/Class/DFU/usbd_dfu.c **** /**
 271:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Copies the interface descriptor to the destination buffer.
 272:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 273:USBDevice/Class/DFU/usbd_dfu.c ****  * @param ifNum: the index of the current interface in the device
 274:USBDevice/Class/DFU/usbd_dfu.c ****  * @param dest: the destination buffer
 275:USBDevice/Class/DFU/usbd_dfu.c ****  * @return Length of the copied descriptor
 276:USBDevice/Class/DFU/usbd_dfu.c ****  */
 277:USBDevice/Class/DFU/usbd_dfu.c **** static uint16_t dfu_getDesc(USBD_DFU_IfHandleType *itf, uint8_t ifNum, uint8_t * dest)
 278:USBDevice/Class/DFU/usbd_dfu.c **** {
 109              		.loc 1 278 1 is_stmt 1 view -0
 110              		.cfi_startproc
ARM GAS  /tmp/ccCRZMdU.s 			page 8


 111              		@ args = 0, pretend = 0, frame = 0
 112              		@ frame_needed = 0, uses_anonymous_args = 0
 113              		@ link register save eliminated.
 279:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
 114              		.loc 1 279 5 view .LVU24
 278:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
 115              		.loc 1 278 1 is_stmt 0 view .LVU25
 116 0000 F0B4     		push	{r4, r5, r6, r7}
 117              	.LCFI2:
 118              		.cfi_def_cfa_offset 16
 119              		.cfi_offset 4, -16
 120              		.cfi_offset 5, -12
 121              		.cfi_offset 6, -8
 122              		.cfi_offset 7, -4
 123              	.LBB13:
 124              	.LBB14:
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 125              		.loc 1 213 5 view .LVU26
 126 0002 114D     		ldr	r5, .L19
 127              	.LBE14:
 128              	.LBE13:
 278:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
 129              		.loc 1 278 1 view .LVU27
 130 0004 1446     		mov	r4, r2
 131              	.LVL4:
 280:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = rodfu_getDesc(itf, ifNum, dest);
 132              		.loc 1 280 5 is_stmt 1 view .LVU28
 278:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
 133              		.loc 1 278 1 is_stmt 0 view .LVU29
 134 0006 0646     		mov	r6, r0
 135              	.LVL5:
 136              	.LBB18:
 137              	.LBI13:
 208:USBDevice/Class/DFU/usbd_dfu.c **** {
 138              		.loc 1 208 17 is_stmt 1 view .LVU30
 139              	.LBB15:
 210:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = sizeof(dfu_desc);
 140              		.loc 1 210 5 view .LVU31
 211:USBDevice/Class/DFU/usbd_dfu.c **** 
 141              		.loc 1 211 5 view .LVU32
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 142              		.loc 1 213 5 view .LVU33
 143              	.LBE15:
 144              	.LBE18:
 278:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_DescType *desc = (USBD_DFU_DescType*)dest;
 145              		.loc 1 278 1 is_stmt 0 view .LVU34
 146 0008 0F46     		mov	r7, r1
 147              	.LBB19:
 148              	.LBB16:
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 149              		.loc 1 219 28 view .LVU35
 150 000a 01F1010C 		add	ip, r1, #1
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 151              		.loc 1 213 5 view .LVU36
 152 000e 0FCD     		ldmia	r5!, {r0, r1, r2, r3}
 153              	.LVL6:
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
ARM GAS  /tmp/ccCRZMdU.s 			page 9


 154              		.loc 1 213 5 view .LVU37
 155 0010 2D88     		ldrh	r5, [r5]	@ unaligned
 156 0012 2060     		str	r0, [r4]	@ unaligned
 157 0014 A260     		str	r2, [r4, #8]	@ unaligned
 158 0016 E360     		str	r3, [r4, #12]	@ unaligned
 159 0018 2582     		strh	r5, [r4, #16]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 160              		.loc 1 214 5 is_stmt 1 view .LVU38
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 161              		.loc 1 213 5 is_stmt 0 view .LVU39
 162 001a 6160     		str	r1, [r4, #4]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 163              		.loc 1 214 32 view .LVU40
 164 001c B28A     		ldrh	r2, [r6, #20]
 217:USBDevice/Class/DFU/usbd_dfu.c **** 
 165              		.loc 1 217 32 view .LVU41
 166 001e A770     		strb	r7, [r4, #2]
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 167              		.loc 1 219 26 view .LVU42
 168 0020 84F808C0 		strb	ip, [r4, #8]
 169              	.LBE16:
 170              	.LBE19:
 281:USBDevice/Class/DFU/usbd_dfu.c **** 
 282:USBDevice/Class/DFU/usbd_dfu.c ****     /* Set attributes */
 283:USBDevice/Class/DFU/usbd_dfu.c ****     if ((DFU_APP(itf)->Erase != NULL) && (DFU_APP(itf)->Write != NULL))
 171              		.loc 1 283 10 view .LVU43
 172 0024 F368     		ldr	r3, [r6, #12]
 173              	.LBB20:
 174              	.LBB17:
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 175              		.loc 1 214 32 view .LVU44
 176 0026 A281     		strh	r2, [r4, #12]	@ unaligned
 217:USBDevice/Class/DFU/usbd_dfu.c **** 
 177              		.loc 1 217 5 is_stmt 1 view .LVU45
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 178              		.loc 1 219 5 view .LVU46
 220:USBDevice/Class/DFU/usbd_dfu.c **** }
 179              		.loc 1 220 5 view .LVU47
 180              	.LVL7:
 220:USBDevice/Class/DFU/usbd_dfu.c **** }
 181              		.loc 1 220 5 is_stmt 0 view .LVU48
 182              	.LBE17:
 183              	.LBE20:
 184              		.loc 1 283 5 is_stmt 1 view .LVU49
 185              		.loc 1 283 8 is_stmt 0 view .LVU50
 186 0028 1A69     		ldr	r2, [r3, #16]
 187 002a 1AB1     		cbz	r2, .L7
 188              		.loc 1 283 39 discriminator 1 view .LVU51
 189 002c 5A69     		ldr	r2, [r3, #20]
 190 002e 0AB1     		cbz	r2, .L7
 284:USBDevice/Class/DFU/usbd_dfu.c ****     {
 285:USBDevice/Class/DFU/usbd_dfu.c ****         desc->DFUFD.bmAttributes |= DFU_ATTR_CAN_DNLOAD;
 191              		.loc 1 285 9 is_stmt 1 view .LVU52
 192              		.loc 1 285 34 is_stmt 0 view .LVU53
 193 0030 0922     		movs	r2, #9
 194 0032 E272     		strb	r2, [r4, #11]
 195              	.L7:
ARM GAS  /tmp/ccCRZMdU.s 			page 10


 286:USBDevice/Class/DFU/usbd_dfu.c ****     }
 287:USBDevice/Class/DFU/usbd_dfu.c ****     if (DFU_APP(itf)->Read != NULL)
 196              		.loc 1 287 5 is_stmt 1 view .LVU54
 197              		.loc 1 287 8 is_stmt 0 view .LVU55
 198 0034 9B69     		ldr	r3, [r3, #24]
 199 0036 1BB1     		cbz	r3, .L8
 288:USBDevice/Class/DFU/usbd_dfu.c ****     {
 289:USBDevice/Class/DFU/usbd_dfu.c ****         desc->DFUFD.bmAttributes |= DFU_ATTR_CAN_UPLOAD;
 200              		.loc 1 289 9 is_stmt 1 view .LVU56
 201              		.loc 1 289 34 is_stmt 0 view .LVU57
 202 0038 E37A     		ldrb	r3, [r4, #11]	@ zero_extendqisi2
 203 003a 43F00203 		orr	r3, r3, #2
 204 003e E372     		strb	r3, [r4, #11]
 205              	.L8:
 290:USBDevice/Class/DFU/usbd_dfu.c ****     }
 291:USBDevice/Class/DFU/usbd_dfu.c **** 
 292:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 206              		.loc 1 292 5 is_stmt 1 view .LVU58
 293:USBDevice/Class/DFU/usbd_dfu.c **** }
 207              		.loc 1 293 1 is_stmt 0 view .LVU59
 208 0040 1220     		movs	r0, #18
 209 0042 F0BC     		pop	{r4, r5, r6, r7}
 210              	.LCFI3:
 211              		.cfi_restore 7
 212              		.cfi_restore 6
 213              		.cfi_restore 5
 214              		.cfi_restore 4
 215              		.cfi_def_cfa_offset 0
 216              	.LVL8:
 217              		.loc 1 293 1 view .LVU60
 218 0044 7047     		bx	lr
 219              	.L20:
 220 0046 00BF     		.align	2
 221              	.L19:
 222 0048 00000000 		.word	.LANCHOR0
 223              		.cfi_endproc
 224              	.LFE150:
 226              		.section	.text.dfu_getString,"ax",%progbits
 227              		.align	1
 228              		.p2align 2,,3
 229              		.syntax unified
 230              		.thumb
 231              		.thumb_func
 232              		.fpu fpv4-sp-d16
 234              	dfu_getString:
 235              	.LVL9:
 236              	.LFB151:
 294:USBDevice/Class/DFU/usbd_dfu.c **** #endif /* (USBD_DFU_ALTSETTINGS != 0) */
 295:USBDevice/Class/DFU/usbd_dfu.c **** 
 296:USBDevice/Class/DFU/usbd_dfu.c **** /**
 297:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Returns the selected interface string.
 298:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 299:USBDevice/Class/DFU/usbd_dfu.c ****  * @param intNum: interface-internal string index
 300:USBDevice/Class/DFU/usbd_dfu.c ****  * @return The referenced string
 301:USBDevice/Class/DFU/usbd_dfu.c ****  */
 302:USBDevice/Class/DFU/usbd_dfu.c **** static const char* dfu_getString(USBD_DFU_IfHandleType *itf, uint8_t intNum)
 303:USBDevice/Class/DFU/usbd_dfu.c **** {
ARM GAS  /tmp/ccCRZMdU.s 			page 11


 237              		.loc 1 303 1 is_stmt 1 view -0
 238              		.cfi_startproc
 239              		@ args = 0, pretend = 0, frame = 0
 240              		@ frame_needed = 0, uses_anonymous_args = 0
 241              		@ link register save eliminated.
 304:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 305:USBDevice/Class/DFU/usbd_dfu.c ****     if (intNum < itf->Base.AltCount)
 306:USBDevice/Class/DFU/usbd_dfu.c ****     {
 307:USBDevice/Class/DFU/usbd_dfu.c ****         return itf->App[intNum].Name;
 308:USBDevice/Class/DFU/usbd_dfu.c ****     }
 309:USBDevice/Class/DFU/usbd_dfu.c ****     else
 310:USBDevice/Class/DFU/usbd_dfu.c ****     {
 311:USBDevice/Class/DFU/usbd_dfu.c ****         return NULL;
 312:USBDevice/Class/DFU/usbd_dfu.c ****     }
 313:USBDevice/Class/DFU/usbd_dfu.c **** #else
 314:USBDevice/Class/DFU/usbd_dfu.c ****     return itf->App->Name;
 242              		.loc 1 314 5 view .LVU62
 243              		.loc 1 314 20 is_stmt 0 view .LVU63
 244 0000 C368     		ldr	r3, [r0, #12]
 315:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 316:USBDevice/Class/DFU/usbd_dfu.c **** }
 245              		.loc 1 316 1 view .LVU64
 246 0002 1868     		ldr	r0, [r3]
 247              	.LVL10:
 248              		.loc 1 316 1 view .LVU65
 249 0004 7047     		bx	lr
 250              		.cfi_endproc
 251              	.LFE151:
 253 0006 00BF     		.section	.text.dfu_clearStatus,"ax",%progbits
 254              		.align	1
 255              		.p2align 2,,3
 256              		.syntax unified
 257              		.thumb
 258              		.thumb_func
 259              		.fpu fpv4-sp-d16
 261              	dfu_clearStatus:
 262              	.LVL11:
 263              	.LFB160:
 317:USBDevice/Class/DFU/usbd_dfu.c **** 
 318:USBDevice/Class/DFU/usbd_dfu.c **** /**
 319:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Initializes the interface by resetting the internal variables
 320:USBDevice/Class/DFU/usbd_dfu.c ****  *        and initializing the attached application.
 321:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 322:USBDevice/Class/DFU/usbd_dfu.c ****  */
 323:USBDevice/Class/DFU/usbd_dfu.c **** static void dfu_init(USBD_DFU_IfHandleType *itf)
 324:USBDevice/Class/DFU/usbd_dfu.c **** {
 325:USBDevice/Class/DFU/usbd_dfu.c ****     /* Internal variables initialization */
 326:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.__reserved  = 0;
 327:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.iString     = 0;
 328:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 329:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Tag[0] = itf->Tag[1] = 0;
 330:USBDevice/Class/DFU/usbd_dfu.c **** 
 331:USBDevice/Class/DFU/usbd_dfu.c ****     /* DFU mode only */
 332:USBDevice/Class/DFU/usbd_dfu.c ****     if (itf->DevStatus.State >= DFU_STATE_IDLE)
 333:USBDevice/Class/DFU/usbd_dfu.c ****     {
 334:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Address = (uint8_t*)DFU_APP(itf)->Firmware.Address;
 335:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockNum = 0;
ARM GAS  /tmp/ccCRZMdU.s 			page 12


 336:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockLength = 0;
 337:USBDevice/Class/DFU/usbd_dfu.c **** 
 338:USBDevice/Class/DFU/usbd_dfu.c ****         /* Initialize media */
 339:USBDevice/Class/DFU/usbd_dfu.c ****         USBD_SAFE_CALLBACK(DFU_APP(itf)->Init, );
 340:USBDevice/Class/DFU/usbd_dfu.c ****     }
 341:USBDevice/Class/DFU/usbd_dfu.c **** }
 342:USBDevice/Class/DFU/usbd_dfu.c **** 
 343:USBDevice/Class/DFU/usbd_dfu.c **** /**
 344:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Removes other USB interfaces from the device if in APP_DETACH state.
 345:USBDevice/Class/DFU/usbd_dfu.c ****  *        Otherwise deinitializes the interface's attached application.
 346:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 347:USBDevice/Class/DFU/usbd_dfu.c ****  */
 348:USBDevice/Class/DFU/usbd_dfu.c **** static void dfu_deinit(USBD_DFU_IfHandleType *itf)
 349:USBDevice/Class/DFU/usbd_dfu.c **** {
 350:USBDevice/Class/DFU/usbd_dfu.c ****     /* In DFU mode */
 351:USBDevice/Class/DFU/usbd_dfu.c ****     if (itf->DevStatus.State >= DFU_STATE_IDLE)
 352:USBDevice/Class/DFU/usbd_dfu.c ****     {
 353:USBDevice/Class/DFU/usbd_dfu.c ****         /* Deinitialize media */
 354:USBDevice/Class/DFU/usbd_dfu.c ****         USBD_SAFE_CALLBACK(DFU_APP(itf)->Deinit, );
 355:USBDevice/Class/DFU/usbd_dfu.c ****     }
 356:USBDevice/Class/DFU/usbd_dfu.c **** }
 357:USBDevice/Class/DFU/usbd_dfu.c **** 
 358:USBDevice/Class/DFU/usbd_dfu.c **** /**
 359:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Performs the interface-specific setup request handling.
 360:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 361:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK if the setup request is accepted, INVALID otherwise
 362:USBDevice/Class/DFU/usbd_dfu.c ****  */
 363:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType rodfu_setupStage(USBD_DFU_IfHandleType *itf)
 364:USBDevice/Class/DFU/usbd_dfu.c **** {
 365:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 366:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 367:USBDevice/Class/DFU/usbd_dfu.c **** 
 368:USBDevice/Class/DFU/usbd_dfu.c ****     switch (dev->Setup.RequestType.Type)
 369:USBDevice/Class/DFU/usbd_dfu.c ****     {
 370:USBDevice/Class/DFU/usbd_dfu.c ****         case USB_REQ_TYPE_STANDARD:
 371:USBDevice/Class/DFU/usbd_dfu.c ****         {
 372:USBDevice/Class/DFU/usbd_dfu.c ****             /* DFU specific descriptors can be requested */
 373:USBDevice/Class/DFU/usbd_dfu.c ****             if (dev->Setup.Request == USB_REQ_GET_DESCRIPTOR)
 374:USBDevice/Class/DFU/usbd_dfu.c ****             {
 375:USBDevice/Class/DFU/usbd_dfu.c ****                 switch (dev->Setup.Value >> 8)
 376:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 377:USBDevice/Class/DFU/usbd_dfu.c ****                     /* Return DFU func. descriptor */
 378:USBDevice/Class/DFU/usbd_dfu.c ****                     case DFU_DESC_TYPE_FUNCTIONAL:
 379:USBDevice/Class/DFU/usbd_dfu.c ****                     {
 380:USBDevice/Class/DFU/usbd_dfu.c **** #if USBD_DATA_ALIGNMENT > 1
 381:USBDevice/Class/DFU/usbd_dfu.c ****                         void* data = dev->CtrlData;
 382:USBDevice/Class/DFU/usbd_dfu.c ****                         memcpy(dev->CtrlData, &dfu_desc.DFUFD, sizeof(dfu_desc.DFUFD));
 383:USBDevice/Class/DFU/usbd_dfu.c **** #else
 384:USBDevice/Class/DFU/usbd_dfu.c ****                         void* data = &dfu_desc.DFUFD;
 385:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 386:USBDevice/Class/DFU/usbd_dfu.c ****                         retval = USBD_CtrlSendData(dev, data, sizeof(dfu_desc.DFUFD));
 387:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 388:USBDevice/Class/DFU/usbd_dfu.c ****                     }
 389:USBDevice/Class/DFU/usbd_dfu.c ****                     default:
 390:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 391:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 392:USBDevice/Class/DFU/usbd_dfu.c ****             }
ARM GAS  /tmp/ccCRZMdU.s 			page 13


 393:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 394:USBDevice/Class/DFU/usbd_dfu.c ****         }
 395:USBDevice/Class/DFU/usbd_dfu.c **** 
 396:USBDevice/Class/DFU/usbd_dfu.c ****         case USB_REQ_TYPE_CLASS:
 397:USBDevice/Class/DFU/usbd_dfu.c ****         {
 398:USBDevice/Class/DFU/usbd_dfu.c ****             switch (dev->Setup.Request)
 399:USBDevice/Class/DFU/usbd_dfu.c ****             {
 400:USBDevice/Class/DFU/usbd_dfu.c ****                 case DFU_REQ_DETACH:
 401:USBDevice/Class/DFU/usbd_dfu.c ****                     retval = dfu_detach(itf);
 402:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 403:USBDevice/Class/DFU/usbd_dfu.c ****                 case DFU_REQ_GETSTATUS:
 404:USBDevice/Class/DFU/usbd_dfu.c ****                     return USBD_CtrlSendData(dev,
 405:USBDevice/Class/DFU/usbd_dfu.c ****                             &itf->DevStatus, sizeof(itf->DevStatus));
 406:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 407:USBDevice/Class/DFU/usbd_dfu.c ****                 case DFU_REQ_GETSTATE:
 408:USBDevice/Class/DFU/usbd_dfu.c ****                     retval = dfu_getState(itf);
 409:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 410:USBDevice/Class/DFU/usbd_dfu.c ****                 default:
 411:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 412:USBDevice/Class/DFU/usbd_dfu.c ****             }
 413:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 414:USBDevice/Class/DFU/usbd_dfu.c ****         }
 415:USBDevice/Class/DFU/usbd_dfu.c **** 
 416:USBDevice/Class/DFU/usbd_dfu.c ****         default:
 417:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 418:USBDevice/Class/DFU/usbd_dfu.c ****     }
 419:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
 420:USBDevice/Class/DFU/usbd_dfu.c **** }
 421:USBDevice/Class/DFU/usbd_dfu.c **** 
 422:USBDevice/Class/DFU/usbd_dfu.c **** /**
 423:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Performs the interface-specific setup request handling.
 424:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 425:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK if the setup request is accepted, INVALID otherwise
 426:USBDevice/Class/DFU/usbd_dfu.c ****  */
 427:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_setupStage(USBD_DFU_IfHandleType *itf)
 428:USBDevice/Class/DFU/usbd_dfu.c **** {
 429:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 430:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 431:USBDevice/Class/DFU/usbd_dfu.c **** 
 432:USBDevice/Class/DFU/usbd_dfu.c ****     switch (dev->Setup.RequestType.Type)
 433:USBDevice/Class/DFU/usbd_dfu.c ****     {
 434:USBDevice/Class/DFU/usbd_dfu.c ****         case USB_REQ_TYPE_STANDARD:
 435:USBDevice/Class/DFU/usbd_dfu.c ****         {
 436:USBDevice/Class/DFU/usbd_dfu.c ****             /* DFU specific descriptors can be requested */
 437:USBDevice/Class/DFU/usbd_dfu.c ****             if (dev->Setup.Request == USB_REQ_GET_DESCRIPTOR)
 438:USBDevice/Class/DFU/usbd_dfu.c ****             {
 439:USBDevice/Class/DFU/usbd_dfu.c ****                 switch (dev->Setup.Value >> 8)
 440:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 441:USBDevice/Class/DFU/usbd_dfu.c ****                     /* Return DFU func. descriptor */
 442:USBDevice/Class/DFU/usbd_dfu.c ****                     case DFU_DESC_TYPE_FUNCTIONAL:
 443:USBDevice/Class/DFU/usbd_dfu.c ****                     {
 444:USBDevice/Class/DFU/usbd_dfu.c ****                         uint16_t len = dfu_cbks.GetDescriptor((void*)itf, 0, dev->CtrlData);
 445:USBDevice/Class/DFU/usbd_dfu.c ****                         memcpy(dev->CtrlData, &dev->CtrlData[len - sizeof(dfu_desc.DFUFD)],
 446:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 447:USBDevice/Class/DFU/usbd_dfu.c ****                         retval = USBD_CtrlSendData(dev, dev->CtrlData,
 448:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 449:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
ARM GAS  /tmp/ccCRZMdU.s 			page 14


 450:USBDevice/Class/DFU/usbd_dfu.c ****                     }
 451:USBDevice/Class/DFU/usbd_dfu.c ****                     default:
 452:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 453:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 454:USBDevice/Class/DFU/usbd_dfu.c ****             }
 455:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 456:USBDevice/Class/DFU/usbd_dfu.c ****         }
 457:USBDevice/Class/DFU/usbd_dfu.c **** 
 458:USBDevice/Class/DFU/usbd_dfu.c ****         case USB_REQ_TYPE_CLASS:
 459:USBDevice/Class/DFU/usbd_dfu.c ****         {
 460:USBDevice/Class/DFU/usbd_dfu.c ****             uint8_t reqId = dev->Setup.Request;
 461:USBDevice/Class/DFU/usbd_dfu.c ****             uint16_t stateMask = 1 << itf->DevStatus.State;
 462:USBDevice/Class/DFU/usbd_dfu.c **** 
 463:USBDevice/Class/DFU/usbd_dfu.c ****             /* Call the operation indexed by bRequest
 464:USBDevice/Class/DFU/usbd_dfu.c ****              * only if it can be executed in the current state */
 465:USBDevice/Class/DFU/usbd_dfu.c ****             if ((reqId < DFU_CLASS_REQ_COUNT) &&
 466:USBDevice/Class/DFU/usbd_dfu.c ****                 ((dfu_validStates[reqId] & stateMask) != 0) &&
 467:USBDevice/Class/DFU/usbd_dfu.c ****                 (USBD_E_OK == dfu_reqFns[reqId](itf)))
 468:USBDevice/Class/DFU/usbd_dfu.c ****             {
 469:USBDevice/Class/DFU/usbd_dfu.c ****                 retval = USBD_E_OK;
 470:USBDevice/Class/DFU/usbd_dfu.c ****             }
 471:USBDevice/Class/DFU/usbd_dfu.c ****             /* Don't leave APP mode */
 472:USBDevice/Class/DFU/usbd_dfu.c ****             else if (itf->DevStatus.State < DFU_STATE_IDLE)
 473:USBDevice/Class/DFU/usbd_dfu.c ****             {
 474:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_APP_IDLE;
 475:USBDevice/Class/DFU/usbd_dfu.c ****             }
 476:USBDevice/Class/DFU/usbd_dfu.c ****             else /* Enter error state on unexpected request */
 477:USBDevice/Class/DFU/usbd_dfu.c ****             {
 478:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_ERROR;
 479:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.Status = DFU_ERROR_STALLEDPKT;
 480:USBDevice/Class/DFU/usbd_dfu.c ****             }
 481:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 482:USBDevice/Class/DFU/usbd_dfu.c ****         }
 483:USBDevice/Class/DFU/usbd_dfu.c **** 
 484:USBDevice/Class/DFU/usbd_dfu.c ****         default:
 485:USBDevice/Class/DFU/usbd_dfu.c ****             break;
 486:USBDevice/Class/DFU/usbd_dfu.c ****     }
 487:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
 488:USBDevice/Class/DFU/usbd_dfu.c **** }
 489:USBDevice/Class/DFU/usbd_dfu.c **** 
 490:USBDevice/Class/DFU/usbd_dfu.c **** /**
 491:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Handles the DFU DETACH request, which is followed by
 492:USBDevice/Class/DFU/usbd_dfu.c ****  *        USB reset and device reconfiguration to DFU mode.
 493:USBDevice/Class/DFU/usbd_dfu.c ****  *        When configured, performs attach-detach sequence.
 494:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 495:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK
 496:USBDevice/Class/DFU/usbd_dfu.c ****  */
 497:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_detach(USBD_DFU_IfHandleType *itf)
 498:USBDevice/Class/DFU/usbd_dfu.c **** {
 499:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_APP_DETACH;
 500:USBDevice/Class/DFU/usbd_dfu.c **** 
 501:USBDevice/Class/DFU/usbd_dfu.c ****     /* Check the detach capability in the DFU functional descriptor */
 502:USBDevice/Class/DFU/usbd_dfu.c ****     if ((dfu_desc.DFUFD.bmAttributes & DFU_ATTR_WILL_DETACH) != 0)
 503:USBDevice/Class/DFU/usbd_dfu.c ****     {
 504:USBDevice/Class/DFU/usbd_dfu.c ****         /* Shutting down USB detaches it from the host,
 505:USBDevice/Class/DFU/usbd_dfu.c ****          * attach will be done in DFU mode */
 506:USBDevice/Class/DFU/usbd_dfu.c ****         USBD_Deinit(itf->Base.Device);
ARM GAS  /tmp/ccCRZMdU.s 			page 15


 507:USBDevice/Class/DFU/usbd_dfu.c **** 
 508:USBDevice/Class/DFU/usbd_dfu.c ****         /* Set tag to DFU mode */
 509:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[0] =  DFU_MODE_TAG;
 510:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[1] = ~DFU_MODE_TAG;
 511:USBDevice/Class/DFU/usbd_dfu.c **** 
 512:USBDevice/Class/DFU/usbd_dfu.c ****         /* Reset the system into DFU mode */
 513:USBDevice/Class/DFU/usbd_dfu.c ****         USBD_SAFE_CALLBACK(itf->Config.Reboot, );
 514:USBDevice/Class/DFU/usbd_dfu.c ****     }
 515:USBDevice/Class/DFU/usbd_dfu.c **** 
 516:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 517:USBDevice/Class/DFU/usbd_dfu.c **** }
 518:USBDevice/Class/DFU/usbd_dfu.c **** 
 519:USBDevice/Class/DFU/usbd_dfu.c **** /**
 520:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Saves context data for block downloading.
 521:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 522:USBDevice/Class/DFU/usbd_dfu.c ****  * @return INVALID if the request is rejected, OK otherwise
 523:USBDevice/Class/DFU/usbd_dfu.c ****  */
 524:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_download(USBD_DFU_IfHandleType *itf)
 525:USBDevice/Class/DFU/usbd_dfu.c **** {
 526:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 527:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 528:USBDevice/Class/DFU/usbd_dfu.c **** 
 529:USBDevice/Class/DFU/usbd_dfu.c ****     if (dev->Setup.Length > 0)
 530:USBDevice/Class/DFU/usbd_dfu.c ****     {
 531:USBDevice/Class/DFU/usbd_dfu.c ****         /* Check for download support */
 532:USBDevice/Class/DFU/usbd_dfu.c ****         if ((DFU_APP(itf)->Erase != NULL) && (DFU_APP(itf)->Write != NULL))
 533:USBDevice/Class/DFU/usbd_dfu.c ****         {
 534:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION == 0)
 535:USBDevice/Class/DFU/usbd_dfu.c ****             if (itf->DevStatus.State == DFU_STATE_IDLE)
 536:USBDevice/Class/DFU/usbd_dfu.c ****             {
 537:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Initialize address at first block */
 538:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->Address = (uint8_t*)DFU_APP(itf)->Firmware.Address;
 539:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockNum = 0xFFFF;
 540:USBDevice/Class/DFU/usbd_dfu.c ****             }
 541:USBDevice/Class/DFU/usbd_dfu.c **** 
 542:USBDevice/Class/DFU/usbd_dfu.c ****             /* Checks for valid sequence and overall length */
 543:USBDevice/Class/DFU/usbd_dfu.c ****             if (   ( dev->Setup.Value == ((itf->BlockNum + 1) & 0xFFFF))
 544:USBDevice/Class/DFU/usbd_dfu.c ****                 && (((uint32_t)itf->Address + dev->Setup.Length) <
 545:USBDevice/Class/DFU/usbd_dfu.c ****                     (DFU_APP(itf)->Firmware.Address + DFU_APP(itf)->Firmware.TotalSize)))
 546:USBDevice/Class/DFU/usbd_dfu.c **** #endif /* (USBD_DFU_ST_EXTENSION == 0) */
 547:USBDevice/Class/DFU/usbd_dfu.c ****             {
 548:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Update the global length and block number */
 549:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockNum    = dev->Setup.Value;
 550:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockLength = dev->Setup.Length;
 551:USBDevice/Class/DFU/usbd_dfu.c **** 
 552:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Update the state machine */
 553:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_DNLOAD_SYNC;
 554:USBDevice/Class/DFU/usbd_dfu.c **** 
 555:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Prepare the reception of the buffer over EP0 */
 556:USBDevice/Class/DFU/usbd_dfu.c ****                 retval = USBD_CtrlReceiveData(dev, dev->CtrlData);
 557:USBDevice/Class/DFU/usbd_dfu.c ****             }
 558:USBDevice/Class/DFU/usbd_dfu.c ****         }
 559:USBDevice/Class/DFU/usbd_dfu.c ****     }
 560:USBDevice/Class/DFU/usbd_dfu.c ****     /* Deviation from spec: allow 0 length Dnload in IDLE state to
 561:USBDevice/Class/DFU/usbd_dfu.c ****      * put device in manifestation mode ->
 562:USBDevice/Class/DFU/usbd_dfu.c ****      * It is possible to return to application mode without effective update */
 563:USBDevice/Class/DFU/usbd_dfu.c ****     else
ARM GAS  /tmp/ccCRZMdU.s 			page 16


 564:USBDevice/Class/DFU/usbd_dfu.c ****     {
 565:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockLength = 1;
 566:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_MANIFEST_SYNC;
 567:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 568:USBDevice/Class/DFU/usbd_dfu.c ****     }
 569:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
 570:USBDevice/Class/DFU/usbd_dfu.c **** }
 571:USBDevice/Class/DFU/usbd_dfu.c **** 
 572:USBDevice/Class/DFU/usbd_dfu.c **** /**
 573:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Reads and sends a firmware block to the host.
 574:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 575:USBDevice/Class/DFU/usbd_dfu.c ****  * @return INVALID if the request is rejected, OK otherwise
 576:USBDevice/Class/DFU/usbd_dfu.c ****  */
 577:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_upload(USBD_DFU_IfHandleType *itf)
 578:USBDevice/Class/DFU/usbd_dfu.c **** {
 579:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 580:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 581:USBDevice/Class/DFU/usbd_dfu.c **** 
 582:USBDevice/Class/DFU/usbd_dfu.c ****     /* Send data to host if supported */
 583:USBDevice/Class/DFU/usbd_dfu.c ****     if ((dev->Setup.Length > 0) && (DFU_APP(itf)->Read != NULL))
 584:USBDevice/Class/DFU/usbd_dfu.c ****     {
 585:USBDevice/Class/DFU/usbd_dfu.c ****         uint8_t *data = dev->CtrlData;
 586:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 587:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockNum = dev->Setup.Value;
 588:USBDevice/Class/DFU/usbd_dfu.c **** 
 589:USBDevice/Class/DFU/usbd_dfu.c ****         /* Get commands */
 590:USBDevice/Class/DFU/usbd_dfu.c ****         if (itf->BlockNum == 0)
 591:USBDevice/Class/DFU/usbd_dfu.c ****         {
 592:USBDevice/Class/DFU/usbd_dfu.c ****             itf->DevStatus.State = (dev->Setup.Length > sizeof(dfuse_cmds)) ?
 593:USBDevice/Class/DFU/usbd_dfu.c ****                     DFU_STATE_IDLE : DFU_STATE_UPLOAD_IDLE;
 594:USBDevice/Class/DFU/usbd_dfu.c **** 
 595:USBDevice/Class/DFU/usbd_dfu.c ****             /* Return with supported commands */
 596:USBDevice/Class/DFU/usbd_dfu.c ****             retval = USBD_CtrlSendData(dev, dfuse_cmds, sizeof(dfuse_cmds));
 597:USBDevice/Class/DFU/usbd_dfu.c ****         }
 598:USBDevice/Class/DFU/usbd_dfu.c ****         /* Read memory */
 599:USBDevice/Class/DFU/usbd_dfu.c ****         else if (itf->BlockNum > 1)
 600:USBDevice/Class/DFU/usbd_dfu.c ****         {
 601:USBDevice/Class/DFU/usbd_dfu.c ****             itf->DevStatus.State = DFU_STATE_UPLOAD_IDLE;
 602:USBDevice/Class/DFU/usbd_dfu.c **** 
 603:USBDevice/Class/DFU/usbd_dfu.c ****             DFU_APP(itf)->Read(
 604:USBDevice/Class/DFU/usbd_dfu.c ****                     DFUSE_GETADDRESS(itf, &dfu_desc),
 605:USBDevice/Class/DFU/usbd_dfu.c ****                     data,
 606:USBDevice/Class/DFU/usbd_dfu.c ****                     dev->Setup.Length);
 607:USBDevice/Class/DFU/usbd_dfu.c **** 
 608:USBDevice/Class/DFU/usbd_dfu.c ****             retval = USBD_CtrlSendData(dev, data, dev->Setup.Length);
 609:USBDevice/Class/DFU/usbd_dfu.c ****         }
 610:USBDevice/Class/DFU/usbd_dfu.c **** #else
 611:USBDevice/Class/DFU/usbd_dfu.c ****         /* The host sends DFU_UPLOAD requests to the device until it
 612:USBDevice/Class/DFU/usbd_dfu.c ****          * responds with a short frame as an end of file (EOF) indicator.
 613:USBDevice/Class/DFU/usbd_dfu.c ****          * The device is responsible for selecting the address range
 614:USBDevice/Class/DFU/usbd_dfu.c ****          * to upload and formatting the firmware image appropriately. */
 615:USBDevice/Class/DFU/usbd_dfu.c **** 
 616:USBDevice/Class/DFU/usbd_dfu.c ****         if (itf->DevStatus.State == DFU_STATE_IDLE)
 617:USBDevice/Class/DFU/usbd_dfu.c ****         {
 618:USBDevice/Class/DFU/usbd_dfu.c ****             /* Initialize address at first block */
 619:USBDevice/Class/DFU/usbd_dfu.c ****             itf->Address = (uint8_t*)DFU_APP(itf)->Firmware.Address;
 620:USBDevice/Class/DFU/usbd_dfu.c ****             itf->BlockNum = 0xFFFF;
ARM GAS  /tmp/ccCRZMdU.s 			page 17


 621:USBDevice/Class/DFU/usbd_dfu.c ****         }
 622:USBDevice/Class/DFU/usbd_dfu.c **** 
 623:USBDevice/Class/DFU/usbd_dfu.c ****         /* Check for correct sequence */
 624:USBDevice/Class/DFU/usbd_dfu.c ****         if (dev->Setup.Value == ((itf->BlockNum + 1) & 0xFFFF))
 625:USBDevice/Class/DFU/usbd_dfu.c ****         {
 626:USBDevice/Class/DFU/usbd_dfu.c ****             uint16_t len;
 627:USBDevice/Class/DFU/usbd_dfu.c ****             uint32_t progress = (uint32_t)itf->Address - DFU_APP(itf)->Firmware.Address;
 628:USBDevice/Class/DFU/usbd_dfu.c **** 
 629:USBDevice/Class/DFU/usbd_dfu.c ****             /* Shorten the block size if it's the end of the firmware memory,
 630:USBDevice/Class/DFU/usbd_dfu.c ****              * return to IDLE */
 631:USBDevice/Class/DFU/usbd_dfu.c ****             if ((progress + dev->Setup.Length) > DFU_APP(itf)->Firmware.TotalSize)
 632:USBDevice/Class/DFU/usbd_dfu.c ****             {
 633:USBDevice/Class/DFU/usbd_dfu.c ****                 len = DFU_APP(itf)->Firmware.TotalSize - progress;
 634:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_IDLE;
 635:USBDevice/Class/DFU/usbd_dfu.c ****             }
 636:USBDevice/Class/DFU/usbd_dfu.c ****             else
 637:USBDevice/Class/DFU/usbd_dfu.c ****             {
 638:USBDevice/Class/DFU/usbd_dfu.c ****                 len = dev->Setup.Length;
 639:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_UPLOAD_IDLE;
 640:USBDevice/Class/DFU/usbd_dfu.c ****             }
 641:USBDevice/Class/DFU/usbd_dfu.c **** 
 642:USBDevice/Class/DFU/usbd_dfu.c ****             DFU_APP(itf)->Read(itf->Address, data, len);
 643:USBDevice/Class/DFU/usbd_dfu.c **** 
 644:USBDevice/Class/DFU/usbd_dfu.c ****             /* Increment address for next block upload */
 645:USBDevice/Class/DFU/usbd_dfu.c ****             itf->Address  += len;
 646:USBDevice/Class/DFU/usbd_dfu.c ****             itf->BlockNum  = dev->Setup.Value;
 647:USBDevice/Class/DFU/usbd_dfu.c **** 
 648:USBDevice/Class/DFU/usbd_dfu.c ****             retval = USBD_CtrlSendData(dev, data, len);
 649:USBDevice/Class/DFU/usbd_dfu.c ****         }
 650:USBDevice/Class/DFU/usbd_dfu.c **** #endif /* (USBD_DFU_ST_EXTENSION != 0) */
 651:USBDevice/Class/DFU/usbd_dfu.c ****     }
 652:USBDevice/Class/DFU/usbd_dfu.c ****     else /* No data stage */
 653:USBDevice/Class/DFU/usbd_dfu.c ****     {
 654:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_IDLE;
 655:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 656:USBDevice/Class/DFU/usbd_dfu.c ****     }
 657:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
 658:USBDevice/Class/DFU/usbd_dfu.c **** }
 659:USBDevice/Class/DFU/usbd_dfu.c **** 
 660:USBDevice/Class/DFU/usbd_dfu.c **** /**
 661:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Updates and sends the DFU Status through the control pipe.
 662:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 663:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK
 664:USBDevice/Class/DFU/usbd_dfu.c ****  */
 665:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_getStatus(USBD_DFU_IfHandleType *itf)
 666:USBDevice/Class/DFU/usbd_dfu.c **** {
 667:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 668:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_StateType nextState = itf->DevStatus.State;
 669:USBDevice/Class/DFU/usbd_dfu.c **** 
 670:USBDevice/Class/DFU/usbd_dfu.c ****     /* Provide timeout values before starting download / manifestation */
 671:USBDevice/Class/DFU/usbd_dfu.c ****     if ((itf->DevStatus.State == DFU_STATE_DNLOAD_SYNC) ||
 672:USBDevice/Class/DFU/usbd_dfu.c ****         (itf->DevStatus.State == DFU_STATE_MANIFEST_SYNC))
 673:USBDevice/Class/DFU/usbd_dfu.c ****     {
 674:USBDevice/Class/DFU/usbd_dfu.c ****         if (itf->BlockLength > 0)
 675:USBDevice/Class/DFU/usbd_dfu.c ****         {
 676:USBDevice/Class/DFU/usbd_dfu.c ****             if (DFU_APP(itf)->GetTimeout_ms != NULL)
 677:USBDevice/Class/DFU/usbd_dfu.c ****             {
ARM GAS  /tmp/ccCRZMdU.s 			page 18


 678:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Read the poll timeout */
 679:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = DFU_APP(itf)->GetTimeout_ms(
 680:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->Address,
 681:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->BlockLength);
 682:USBDevice/Class/DFU/usbd_dfu.c ****             }
 683:USBDevice/Class/DFU/usbd_dfu.c **** 
 684:USBDevice/Class/DFU/usbd_dfu.c ****             /* DNLOAD_SYNC   -> DNLOAD_BUSY
 685:USBDevice/Class/DFU/usbd_dfu.c ****              * MANIFEST_SYNC -> MANIFEST */
 686:USBDevice/Class/DFU/usbd_dfu.c ****             nextState += 1;
 687:USBDevice/Class/DFU/usbd_dfu.c ****         }
 688:USBDevice/Class/DFU/usbd_dfu.c ****         else if (itf->DevStatus.State == DFU_STATE_DNLOAD_SYNC)
 689:USBDevice/Class/DFU/usbd_dfu.c ****         {
 690:USBDevice/Class/DFU/usbd_dfu.c ****             /* Download has been completed */
 691:USBDevice/Class/DFU/usbd_dfu.c ****             itf->DevStatus.State = nextState = DFU_STATE_DNLOAD_IDLE;
 692:USBDevice/Class/DFU/usbd_dfu.c ****         }
 693:USBDevice/Class/DFU/usbd_dfu.c ****         else
 694:USBDevice/Class/DFU/usbd_dfu.c ****         {
 695:USBDevice/Class/DFU/usbd_dfu.c ****             /* Manifestation has been completed */
 696:USBDevice/Class/DFU/usbd_dfu.c ****             itf->DevStatus.State = nextState = DFU_STATE_IDLE;
 697:USBDevice/Class/DFU/usbd_dfu.c ****         }
 698:USBDevice/Class/DFU/usbd_dfu.c ****     }
 699:USBDevice/Class/DFU/usbd_dfu.c **** 
 700:USBDevice/Class/DFU/usbd_dfu.c ****     /* Send the status data over EP0 */
 701:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_CtrlSendData(dev, &itf->DevStatus, sizeof(itf->DevStatus));
 702:USBDevice/Class/DFU/usbd_dfu.c **** 
 703:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = nextState;
 704:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 705:USBDevice/Class/DFU/usbd_dfu.c **** }
 706:USBDevice/Class/DFU/usbd_dfu.c **** 
 707:USBDevice/Class/DFU/usbd_dfu.c **** /**
 708:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Clears the error status from the DFU interface.
 709:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 710:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK
 711:USBDevice/Class/DFU/usbd_dfu.c ****  */
 712:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_clearStatus(USBD_DFU_IfHandleType *itf)
 713:USBDevice/Class/DFU/usbd_dfu.c **** {
 264              		.loc 1 713 1 is_stmt 1 view -0
 265              		.cfi_startproc
 266              		@ args = 0, pretend = 0, frame = 0
 267              		@ frame_needed = 0, uses_anonymous_args = 0
 268              		@ link register save eliminated.
 714:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_IDLE;
 269              		.loc 1 714 5 view .LVU67
 713:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_IDLE;
 270              		.loc 1 713 1 is_stmt 0 view .LVU68
 271 0000 0346     		mov	r3, r0
 715:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 272              		.loc 1 715 27 view .LVU69
 273 0002 0022     		movs	r2, #0
 714:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_IDLE;
 274              		.loc 1 714 26 view .LVU70
 275 0004 0221     		movs	r1, #2
 716:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 717:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 718:USBDevice/Class/DFU/usbd_dfu.c **** }
 276              		.loc 1 718 1 view .LVU71
 277 0006 1046     		mov	r0, r2
ARM GAS  /tmp/ccCRZMdU.s 			page 19


 278              	.LVL12:
 715:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 279              		.loc 1 715 27 view .LVU72
 280 0008 83F82C20 		strb	r2, [r3, #44]
 714:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 281              		.loc 1 714 26 view .LVU73
 282 000c 83F83010 		strb	r1, [r3, #48]
 715:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 283              		.loc 1 715 5 is_stmt 1 view .LVU74
 716:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 284              		.loc 1 716 5 view .LVU75
 716:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 285              		.loc 1 716 32 is_stmt 0 view .LVU76
 286 0010 83F82D20 		strb	r2, [r3, #45]
 287 0014 83F82E20 		strb	r2, [r3, #46]
 717:USBDevice/Class/DFU/usbd_dfu.c **** }
 288              		.loc 1 717 5 is_stmt 1 view .LVU77
 289              		.loc 1 718 1 is_stmt 0 view .LVU78
 290 0018 7047     		bx	lr
 291              		.cfi_endproc
 292              	.LFE160:
 294 001a 00BF     		.section	.text.dfu_abort,"ax",%progbits
 295              		.align	1
 296              		.p2align 2,,3
 297              		.syntax unified
 298              		.thumb
 299              		.thumb_func
 300              		.fpu fpv4-sp-d16
 302              	dfu_abort:
 303              	.LVL13:
 304              	.LFB162:
 719:USBDevice/Class/DFU/usbd_dfu.c **** 
 720:USBDevice/Class/DFU/usbd_dfu.c **** /**
 721:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Sends the DFU state through the control pipe.
 722:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 723:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK
 724:USBDevice/Class/DFU/usbd_dfu.c ****  */
 725:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_getState(USBD_DFU_IfHandleType *itf)
 726:USBDevice/Class/DFU/usbd_dfu.c **** {
 727:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_CtrlSendData(itf->Base.Device,
 728:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 729:USBDevice/Class/DFU/usbd_dfu.c **** }
 730:USBDevice/Class/DFU/usbd_dfu.c **** 
 731:USBDevice/Class/DFU/usbd_dfu.c **** /**
 732:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Returns the DFU to dfuIDLE state.
 733:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 734:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK
 735:USBDevice/Class/DFU/usbd_dfu.c ****  */
 736:USBDevice/Class/DFU/usbd_dfu.c **** static USBD_ReturnType dfu_abort(USBD_DFU_IfHandleType *itf)
 737:USBDevice/Class/DFU/usbd_dfu.c **** {
 305              		.loc 1 737 1 is_stmt 1 view -0
 306              		.cfi_startproc
 307              		@ args = 0, pretend = 0, frame = 0
 308              		@ frame_needed = 0, uses_anonymous_args = 0
 309              		@ link register save eliminated.
 738:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State  = DFU_STATE_IDLE;
 310              		.loc 1 738 5 view .LVU80
ARM GAS  /tmp/ccCRZMdU.s 			page 20


 737:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State  = DFU_STATE_IDLE;
 311              		.loc 1 737 1 is_stmt 0 view .LVU81
 312 0000 0346     		mov	r3, r0
 739:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 313              		.loc 1 739 27 view .LVU82
 314 0002 0022     		movs	r2, #0
 738:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State  = DFU_STATE_IDLE;
 315              		.loc 1 738 27 view .LVU83
 316 0004 0221     		movs	r1, #2
 740:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 741:USBDevice/Class/DFU/usbd_dfu.c ****     itf->BlockNum    = 0;
 742:USBDevice/Class/DFU/usbd_dfu.c ****     itf->BlockLength = 0;
 743:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 744:USBDevice/Class/DFU/usbd_dfu.c **** }
 317              		.loc 1 744 1 view .LVU84
 318 0006 1046     		mov	r0, r2
 319              	.LVL14:
 739:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 320              		.loc 1 739 27 view .LVU85
 321 0008 83F82C20 		strb	r2, [r3, #44]
 738:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 322              		.loc 1 738 27 view .LVU86
 323 000c 83F83010 		strb	r1, [r3, #48]
 739:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 324              		.loc 1 739 5 is_stmt 1 view .LVU87
 740:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 325              		.loc 1 740 5 view .LVU88
 740:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 326              		.loc 1 740 32 is_stmt 0 view .LVU89
 327 0010 83F82D20 		strb	r2, [r3, #45]
 328 0014 83F82E20 		strb	r2, [r3, #46]
 741:USBDevice/Class/DFU/usbd_dfu.c ****     itf->BlockLength = 0;
 329              		.loc 1 741 5 is_stmt 1 view .LVU90
 742:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 330              		.loc 1 742 5 view .LVU91
 741:USBDevice/Class/DFU/usbd_dfu.c ****     itf->BlockLength = 0;
 331              		.loc 1 741 22 is_stmt 0 view .LVU92
 332 0018 5A62     		str	r2, [r3, #36]
 743:USBDevice/Class/DFU/usbd_dfu.c **** }
 333              		.loc 1 743 5 is_stmt 1 view .LVU93
 334              		.loc 1 744 1 is_stmt 0 view .LVU94
 335 001a 7047     		bx	lr
 336              		.cfi_endproc
 337              	.LFE162:
 339              		.section	.text.dfu_dataStage,"ax",%progbits
 340              		.align	1
 341              		.p2align 2,,3
 342              		.syntax unified
 343              		.thumb
 344              		.thumb_func
 345              		.fpu fpv4-sp-d16
 347              	dfu_dataStage:
 348              	.LVL15:
 349              	.LFB163:
 745:USBDevice/Class/DFU/usbd_dfu.c **** 
 746:USBDevice/Class/DFU/usbd_dfu.c **** /**
 747:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Performs time-consuming memory operations after a successful GetStatus transfer.
ARM GAS  /tmp/ccCRZMdU.s 			page 21


 748:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 749:USBDevice/Class/DFU/usbd_dfu.c ****  */
 750:USBDevice/Class/DFU/usbd_dfu.c **** static void dfu_dataStage(USBD_DFU_IfHandleType *itf)
 751:USBDevice/Class/DFU/usbd_dfu.c **** {
 350              		.loc 1 751 1 is_stmt 1 view -0
 351              		.cfi_startproc
 352              		@ args = 0, pretend = 0, frame = 0
 353              		@ frame_needed = 0, uses_anonymous_args = 0
 752:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 354              		.loc 1 752 5 view .LVU96
 355              		.loc 1 752 22 is_stmt 0 view .LVU97
 356 0000 0168     		ldr	r1, [r0]
 357              	.LVL16:
 753:USBDevice/Class/DFU/usbd_dfu.c **** 
 754:USBDevice/Class/DFU/usbd_dfu.c ****     /* Perform after GetStatus request */
 755:USBDevice/Class/DFU/usbd_dfu.c ****     if ((dev->Setup.RequestType.Type == USB_REQ_TYPE_CLASS) &&
 358              		.loc 1 755 5 is_stmt 1 view .LVU98
 359              		.loc 1 755 61 is_stmt 0 view .LVU99
 360 0002 8B88     		ldrh	r3, [r1, #4]
 361 0004 23F09F03 		bic	r3, r3, #159
 362              		.loc 1 755 8 view .LVU100
 363 0008 B3F5487F 		cmp	r3, #800
 751:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 364              		.loc 1 751 1 view .LVU101
 365 000c 10B5     		push	{r4, lr}
 366              	.LCFI4:
 367              		.cfi_def_cfa_offset 8
 368              		.cfi_offset 4, -8
 369              		.cfi_offset 14, -4
 751:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 370              		.loc 1 751 1 view .LVU102
 371 000e 0446     		mov	r4, r0
 372              		.loc 1 755 8 view .LVU103
 373 0010 12D0     		beq	.L25
 374              	.LVL17:
 375              	.L48:
 756:USBDevice/Class/DFU/usbd_dfu.c ****         (dev->Setup.Request == DFU_REQ_GETSTATUS))
 757:USBDevice/Class/DFU/usbd_dfu.c ****     {
 758:USBDevice/Class/DFU/usbd_dfu.c ****         switch (itf->DevStatus.State)
 759:USBDevice/Class/DFU/usbd_dfu.c ****         {
 760:USBDevice/Class/DFU/usbd_dfu.c ****             case DFU_STATE_DNLOAD_BUSY:
 761:USBDevice/Class/DFU/usbd_dfu.c ****             {
 762:USBDevice/Class/DFU/usbd_dfu.c ****                 /* New state if no errors occur */
 763:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.State = DFU_STATE_DNLOAD_SYNC;
 764:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 765:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Regular Download Command */
 766:USBDevice/Class/DFU/usbd_dfu.c ****                 if (itf->BlockNum > 1)
 767:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 768:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.Status = DFU_APP(itf)->Write(
 769:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 770:USBDevice/Class/DFU/usbd_dfu.c ****                             dev->CtrlData,
 771:USBDevice/Class/DFU/usbd_dfu.c ****                             itf->BlockLength);
 772:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 773:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Execute special command */
 774:USBDevice/Class/DFU/usbd_dfu.c ****                 else if (itf->BlockNum == 0)
 775:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 776:USBDevice/Class/DFU/usbd_dfu.c ****                     uint8_t cmd = dev->CtrlData[0], *data = dev->CtrlData + 1;
ARM GAS  /tmp/ccCRZMdU.s 			page 22


 777:USBDevice/Class/DFU/usbd_dfu.c **** 
 778:USBDevice/Class/DFU/usbd_dfu.c ****                     switch (cmd)
 779:USBDevice/Class/DFU/usbd_dfu.c ****                     {
 780:USBDevice/Class/DFU/usbd_dfu.c ****                         /* Change the address pointer for more optimal flashing */
 781:USBDevice/Class/DFU/usbd_dfu.c ****                         case DFUSE_CMD_SETADDRESSPOINTER:
 782:USBDevice/Class/DFU/usbd_dfu.c ****                             if (itf->BlockLength == 5)
 783:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 784:USBDevice/Class/DFU/usbd_dfu.c ****                                 itf->Address = (uint8_t*)(*(__packed uint32_t *)data);
 785:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 786:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 787:USBDevice/Class/DFU/usbd_dfu.c **** 
 788:USBDevice/Class/DFU/usbd_dfu.c ****                         /* Erase a flash block */
 789:USBDevice/Class/DFU/usbd_dfu.c ****                         case DFUSE_CMD_ERASE:
 790:USBDevice/Class/DFU/usbd_dfu.c ****                             if (itf->BlockLength == 5)
 791:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 792:USBDevice/Class/DFU/usbd_dfu.c ****                                 itf->Address = (uint8_t*)(*(__packed uint32_t *)data);
 793:USBDevice/Class/DFU/usbd_dfu.c **** 
 794:USBDevice/Class/DFU/usbd_dfu.c ****                                 itf->DevStatus.Status = DFU_APP(itf)->Erase(
 795:USBDevice/Class/DFU/usbd_dfu.c ****                                         itf->Address);
 796:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 797:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 798:USBDevice/Class/DFU/usbd_dfu.c **** 
 799:USBDevice/Class/DFU/usbd_dfu.c ****                         case DFUSE_CMD_READ_UNPROTECT:
 800:USBDevice/Class/DFU/usbd_dfu.c ****                         case DFUSE_CMD_GETCOMMANDS:
 801:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 802:USBDevice/Class/DFU/usbd_dfu.c ****                         /* Not supported */
 803:USBDevice/Class/DFU/usbd_dfu.c ****                         default:
 804:USBDevice/Class/DFU/usbd_dfu.c ****                             itf->DevStatus.Status = DFU_ERROR_STALLEDPKT;
 805:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 806:USBDevice/Class/DFU/usbd_dfu.c ****                     }
 807:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 808:USBDevice/Class/DFU/usbd_dfu.c **** #else
 809:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Erase firmware on the first block */
 810:USBDevice/Class/DFU/usbd_dfu.c ****                 if (itf->Address == (uint8_t*)DFU_APP(itf)->Firmware.Address)
 811:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 812:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.Status = DFU_APP(itf)->Erase(
 813:USBDevice/Class/DFU/usbd_dfu.c ****                             itf->Address);
 814:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 815:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Write after erase */
 816:USBDevice/Class/DFU/usbd_dfu.c ****                 if (itf->DevStatus.Status == DFU_ERROR_NONE)
 817:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 818:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.Status = DFU_APP(itf)->Write(
 819:USBDevice/Class/DFU/usbd_dfu.c ****                             itf->Address,
 820:USBDevice/Class/DFU/usbd_dfu.c ****                             dev->CtrlData,
 821:USBDevice/Class/DFU/usbd_dfu.c ****                             itf->BlockLength);
 822:USBDevice/Class/DFU/usbd_dfu.c **** 
 823:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->Address += itf->BlockLength;
 824:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 825:USBDevice/Class/DFU/usbd_dfu.c **** #endif /* (USBD_DFU_ST_EXTENSION != 0) */
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockLength = 0;
 827:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 828:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 829:USBDevice/Class/DFU/usbd_dfu.c ****             }
 830:USBDevice/Class/DFU/usbd_dfu.c **** 
 831:USBDevice/Class/DFU/usbd_dfu.c ****             case DFU_STATE_MANIFEST:
 832:USBDevice/Class/DFU/usbd_dfu.c ****             {
 833:USBDevice/Class/DFU/usbd_dfu.c ****                 /* Perform manifestation */
ARM GAS  /tmp/ccCRZMdU.s 			page 23


 834:USBDevice/Class/DFU/usbd_dfu.c ****                 if (DFU_APP(itf)->Manifest != NULL)
 835:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 836:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.Status = DFU_APP(itf)->Manifest();
 837:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 838:USBDevice/Class/DFU/usbd_dfu.c **** 
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 if (itf->DevStatus.Status == DFU_ERROR_NONE)
 840:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 841:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_MANIFEST_TOLERANT != 0)
 842:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.State = DFU_STATE_MANIFEST_SYNC;
 843:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->BlockLength = 0;
 844:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.PollTimeout = 0;
 845:USBDevice/Class/DFU/usbd_dfu.c **** #else
 846:USBDevice/Class/DFU/usbd_dfu.c ****                     itf->DevStatus.State = DFU_STATE_MANIFEST_WAIT_RESET;
 847:USBDevice/Class/DFU/usbd_dfu.c **** 
 848:USBDevice/Class/DFU/usbd_dfu.c ****                     /* Disconnect the USB device */
 849:USBDevice/Class/DFU/usbd_dfu.c ****                     USBD_Deinit(itf->Base.Device);
 850:USBDevice/Class/DFU/usbd_dfu.c **** 
 851:USBDevice/Class/DFU/usbd_dfu.c ****                     /* Generate system reset to allow jumping to the user code */
 852:USBDevice/Class/DFU/usbd_dfu.c ****                     USBD_SAFE_CALLBACK(itf->Config.Reboot, );
 853:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 854:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 855:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 856:USBDevice/Class/DFU/usbd_dfu.c ****             }
 857:USBDevice/Class/DFU/usbd_dfu.c **** 
 858:USBDevice/Class/DFU/usbd_dfu.c ****             default:
 859:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 860:USBDevice/Class/DFU/usbd_dfu.c ****         }
 861:USBDevice/Class/DFU/usbd_dfu.c ****     }
 862:USBDevice/Class/DFU/usbd_dfu.c **** 
 863:USBDevice/Class/DFU/usbd_dfu.c ****     /* If any operation encountered error, enter error state */
 864:USBDevice/Class/DFU/usbd_dfu.c ****     if (itf->DevStatus.Status != DFU_ERROR_NONE)
 376              		.loc 1 864 5 is_stmt 1 discriminator 1 view .LVU104
 377 0012 94F82C00 		ldrb	r0, [r4, #44]	@ zero_extendqisi2
 378              		.loc 1 864 8 is_stmt 0 discriminator 1 view .LVU105
 379 0016 58B9     		cbnz	r0, .L38
 380              	.L24:
 865:USBDevice/Class/DFU/usbd_dfu.c ****     {
 866:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_ERROR;
 867:USBDevice/Class/DFU/usbd_dfu.c ****     }
 868:USBDevice/Class/DFU/usbd_dfu.c **** }
 381              		.loc 1 868 1 view .LVU106
 382 0018 10BD     		pop	{r4, pc}
 383              	.LVL18:
 384              	.L33:
 385              	.LBB21:
 386              		.loc 1 868 1 view .LVU107
 387 001a 922B     		cmp	r3, #146
 388 001c 58D0     		beq	.L34
 389              	.L36:
 804:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 390              		.loc 1 804 29 is_stmt 1 view .LVU108
 391              	.LBE21:
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 392              		.loc 1 826 34 is_stmt 0 view .LVU109
 393 001e 0023     		movs	r3, #0
 394              	.LVL19:
 395              	.LBB22:
ARM GAS  /tmp/ccCRZMdU.s 			page 24


 804:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 396              		.loc 1 804 51 view .LVU110
 397 0020 0F22     		movs	r2, #15
 398              	.LBE22:
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 399              		.loc 1 826 34 view .LVU111
 400 0022 E384     		strh	r3, [r4, #38]	@ movhi
 401              	.LVL20:
 402              	.LBB23:
 804:USBDevice/Class/DFU/usbd_dfu.c ****                             break;
 403              		.loc 1 804 51 view .LVU112
 404 0024 84F82C20 		strb	r2, [r4, #44]
 805:USBDevice/Class/DFU/usbd_dfu.c ****                     }
 405              		.loc 1 805 29 is_stmt 1 view .LVU113
 406              	.LBE23:
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 407              		.loc 1 826 17 view .LVU114
 827:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 408              		.loc 1 827 17 view .LVU115
 827:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 409              		.loc 1 827 44 is_stmt 0 view .LVU116
 410 0028 84F82D30 		strb	r3, [r4, #45]
 411 002c 84F82E30 		strb	r3, [r4, #46]
 828:USBDevice/Class/DFU/usbd_dfu.c ****             }
 412              		.loc 1 828 17 is_stmt 1 view .LVU117
 864:USBDevice/Class/DFU/usbd_dfu.c ****     {
 413              		.loc 1 864 5 view .LVU118
 414              	.LVL21:
 415              	.L38:
 866:USBDevice/Class/DFU/usbd_dfu.c ****     }
 416              		.loc 1 866 9 view .LVU119
 866:USBDevice/Class/DFU/usbd_dfu.c ****     }
 417              		.loc 1 866 30 is_stmt 0 view .LVU120
 418 0030 0A23     		movs	r3, #10
 419 0032 84F83030 		strb	r3, [r4, #48]
 420              		.loc 1 868 1 view .LVU121
 421 0036 10BD     		pop	{r4, pc}
 422              	.LVL22:
 423              	.L25:
 758:USBDevice/Class/DFU/usbd_dfu.c ****         {
 424              		.loc 1 758 9 is_stmt 1 view .LVU122
 758:USBDevice/Class/DFU/usbd_dfu.c ****         {
 425              		.loc 1 758 31 is_stmt 0 view .LVU123
 426 0038 90F83030 		ldrb	r3, [r0, #48]	@ zero_extendqisi2
 758:USBDevice/Class/DFU/usbd_dfu.c ****         {
 427              		.loc 1 758 9 view .LVU124
 428 003c 042B     		cmp	r3, #4
 429 003e 15D0     		beq	.L27
 430 0040 072B     		cmp	r3, #7
 431 0042 E6D1     		bne	.L48
 834:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 432              		.loc 1 834 17 is_stmt 1 view .LVU125
 834:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 433              		.loc 1 834 33 is_stmt 0 view .LVU126
 434 0044 C368     		ldr	r3, [r0, #12]
 435 0046 DB68     		ldr	r3, [r3, #12]
 834:USBDevice/Class/DFU/usbd_dfu.c ****                 {
ARM GAS  /tmp/ccCRZMdU.s 			page 25


 436              		.loc 1 834 20 view .LVU127
 437 0048 002B     		cmp	r3, #0
 438 004a 3CD0     		beq	.L49
 836:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 439              		.loc 1 836 21 is_stmt 1 view .LVU128
 836:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 440              		.loc 1 836 45 is_stmt 0 view .LVU129
 441 004c 9847     		blx	r3
 442              	.LVL23:
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 443              		.loc 1 839 17 is_stmt 1 view .LVU130
 836:USBDevice/Class/DFU/usbd_dfu.c ****                 }
 444              		.loc 1 836 43 is_stmt 0 view .LVU131
 445 004e 84F82C00 		strb	r0, [r4, #44]
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 446              		.loc 1 839 20 view .LVU132
 447 0052 0028     		cmp	r0, #0
 448 0054 ECD1     		bne	.L38
 449              	.L41:
 846:USBDevice/Class/DFU/usbd_dfu.c **** 
 450              		.loc 1 846 21 is_stmt 1 view .LVU133
 846:USBDevice/Class/DFU/usbd_dfu.c **** 
 451              		.loc 1 846 42 is_stmt 0 view .LVU134
 452 0056 0823     		movs	r3, #8
 849:USBDevice/Class/DFU/usbd_dfu.c **** 
 453              		.loc 1 849 21 view .LVU135
 454 0058 2068     		ldr	r0, [r4]
 846:USBDevice/Class/DFU/usbd_dfu.c **** 
 455              		.loc 1 846 42 view .LVU136
 456 005a 84F83030 		strb	r3, [r4, #48]
 849:USBDevice/Class/DFU/usbd_dfu.c **** 
 457              		.loc 1 849 21 is_stmt 1 view .LVU137
 458 005e FFF7FEFF 		bl	USBD_Deinit
 459              	.LVL24:
 852:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 460              		.loc 1 852 21 view .LVU138
 852:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 461              		.loc 1 852 21 view .LVU139
 462 0062 2369     		ldr	r3, [r4, #16]
 463 0064 002B     		cmp	r3, #0
 464 0066 D4D0     		beq	.L48
 852:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 465              		.loc 1 852 21 discriminator 1 view .LVU140
 466 0068 9847     		blx	r3
 467              	.LVL25:
 468 006a D2E7     		b	.L48
 469              	.LVL26:
 470              	.L27:
 763:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 471              		.loc 1 763 17 view .LVU141
 766:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 472              		.loc 1 766 24 is_stmt 0 view .LVU142
 473 006c 808C     		ldrh	r0, [r0, #36]
 474              	.LVL27:
 763:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 475              		.loc 1 763 38 view .LVU143
 476 006e 0323     		movs	r3, #3
ARM GAS  /tmp/ccCRZMdU.s 			page 26


 766:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 477              		.loc 1 766 20 view .LVU144
 478 0070 0128     		cmp	r0, #1
 763:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 479              		.loc 1 763 38 view .LVU145
 480 0072 84F83030 		strb	r3, [r4, #48]
 766:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 481              		.loc 1 766 17 is_stmt 1 view .LVU146
 766:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 482              		.loc 1 766 20 is_stmt 0 view .LVU147
 483 0076 14D9     		bls	.L29
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 484              		.loc 1 768 21 is_stmt 1 view .LVU148
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 485              		.loc 1 768 45 is_stmt 0 view .LVU149
 486 0078 A26A     		ldr	r2, [r4, #40]
 769:USBDevice/Class/DFU/usbd_dfu.c ****                             dev->CtrlData,
 487              		.loc 1 769 29 view .LVU150
 488 007a 0238     		subs	r0, r0, #2
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 489              		.loc 1 768 57 view .LVU151
 490 007c E368     		ldr	r3, [r4, #12]
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 491              		.loc 1 768 45 view .LVU152
 492 007e 01F58671 		add	r1, r1, #268
 493              	.LVL28:
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 494              		.loc 1 768 45 view .LVU153
 495 0082 02EB4020 		add	r0, r2, r0, lsl #9
 496 0086 E28C     		ldrh	r2, [r4, #38]
 497 0088 5B69     		ldr	r3, [r3, #20]
 498 008a 9847     		blx	r3
 499              	.LVL29:
 768:USBDevice/Class/DFU/usbd_dfu.c ****                             DFUSE_GETADDRESS(itf, &dfu_desc),
 500              		.loc 1 768 43 view .LVU154
 501 008c 84F82C00 		strb	r0, [r4, #44]
 502              	.L30:
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 503              		.loc 1 826 17 is_stmt 1 view .LVU155
 826:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.PollTimeout = 0;
 504              		.loc 1 826 34 is_stmt 0 view .LVU156
 505 0090 0023     		movs	r3, #0
 506 0092 E384     		strh	r3, [r4, #38]	@ movhi
 827:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 507              		.loc 1 827 17 is_stmt 1 view .LVU157
 827:USBDevice/Class/DFU/usbd_dfu.c ****                 break;
 508              		.loc 1 827 44 is_stmt 0 view .LVU158
 509 0094 84F82D30 		strb	r3, [r4, #45]
 510 0098 84F82E30 		strb	r3, [r4, #46]
 828:USBDevice/Class/DFU/usbd_dfu.c ****             }
 511              		.loc 1 828 17 is_stmt 1 view .LVU159
 864:USBDevice/Class/DFU/usbd_dfu.c ****     {
 512              		.loc 1 864 5 view .LVU160
 864:USBDevice/Class/DFU/usbd_dfu.c ****     {
 513              		.loc 1 864 8 is_stmt 0 view .LVU161
 514 009c 0028     		cmp	r0, #0
 515 009e BBD0     		beq	.L24
ARM GAS  /tmp/ccCRZMdU.s 			page 27


 516 00a0 C6E7     		b	.L38
 517              	.LVL30:
 518              	.L29:
 774:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 519              		.loc 1 774 22 is_stmt 1 view .LVU162
 774:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 520              		.loc 1 774 25 is_stmt 0 view .LVU163
 521 00a2 A8B9     		cbnz	r0, .L34
 522              	.LBB24:
 776:USBDevice/Class/DFU/usbd_dfu.c **** 
 523              		.loc 1 776 21 is_stmt 1 view .LVU164
 776:USBDevice/Class/DFU/usbd_dfu.c **** 
 524              		.loc 1 776 29 is_stmt 0 view .LVU165
 525 00a4 91F80C31 		ldrb	r3, [r1, #268]	@ zero_extendqisi2
 526              	.LVL31:
 778:USBDevice/Class/DFU/usbd_dfu.c ****                     {
 527              		.loc 1 778 21 is_stmt 1 view .LVU166
 528 00a8 412B     		cmp	r3, #65
 529 00aa 14D0     		beq	.L32
 530 00ac B5D8     		bhi	.L33
 531 00ae 7BB1     		cbz	r3, .L34
 532 00b0 212B     		cmp	r3, #33
 533 00b2 B4D1     		bne	.L36
 782:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 534              		.loc 1 782 29 view .LVU167
 782:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 535              		.loc 1 782 32 is_stmt 0 view .LVU168
 536 00b4 E38C     		ldrh	r3, [r4, #38]
 537              	.LVL32:
 782:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 538              		.loc 1 782 32 view .LVU169
 539 00b6 94F82C00 		ldrb	r0, [r4, #44]	@ zero_extendqisi2
 540 00ba 052B     		cmp	r3, #5
 541 00bc E8D1     		bne	.L30
 784:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 542              		.loc 1 784 33 is_stmt 1 view .LVU170
 784:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 543              		.loc 1 784 46 is_stmt 0 view .LVU171
 544 00be D1F80D31 		ldr	r3, [r1, #269]
 545 00c2 A362     		str	r3, [r4, #40]
 546              	.LVL33:
 784:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 547              		.loc 1 784 46 view .LVU172
 548 00c4 E4E7     		b	.L30
 549              	.LVL34:
 550              	.L49:
 784:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 551              		.loc 1 784 46 view .LVU173
 552 00c6 90F82C00 		ldrb	r0, [r0, #44]	@ zero_extendqisi2
 553              	.LVL35:
 784:USBDevice/Class/DFU/usbd_dfu.c ****                             }
 554              		.loc 1 784 46 view .LVU174
 555              	.LBE24:
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 556              		.loc 1 839 17 is_stmt 1 view .LVU175
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 557              		.loc 1 839 20 is_stmt 0 view .LVU176
ARM GAS  /tmp/ccCRZMdU.s 			page 28


 558 00ca 0028     		cmp	r0, #0
 559 00cc B0D1     		bne	.L38
 560 00ce C2E7     		b	.L41
 561              	.L34:
 839:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 562              		.loc 1 839 20 view .LVU177
 563 00d0 94F82C00 		ldrb	r0, [r4, #44]	@ zero_extendqisi2
 564 00d4 DCE7     		b	.L30
 565              	.LVL36:
 566              	.L32:
 567              	.LBB25:
 790:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 568              		.loc 1 790 29 is_stmt 1 view .LVU178
 790:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 569              		.loc 1 790 32 is_stmt 0 view .LVU179
 570 00d6 E38C     		ldrh	r3, [r4, #38]
 571              	.LVL37:
 790:USBDevice/Class/DFU/usbd_dfu.c ****                             {
 572              		.loc 1 790 32 view .LVU180
 573 00d8 052B     		cmp	r3, #5
 574 00da F9D1     		bne	.L34
 792:USBDevice/Class/DFU/usbd_dfu.c **** 
 575              		.loc 1 792 33 is_stmt 1 view .LVU181
 792:USBDevice/Class/DFU/usbd_dfu.c **** 
 576              		.loc 1 792 48 is_stmt 0 view .LVU182
 577 00dc D1F80D01 		ldr	r0, [r1, #269]
 794:USBDevice/Class/DFU/usbd_dfu.c ****                                         itf->Address);
 578              		.loc 1 794 69 view .LVU183
 579 00e0 E368     		ldr	r3, [r4, #12]
 792:USBDevice/Class/DFU/usbd_dfu.c **** 
 580              		.loc 1 792 46 view .LVU184
 581 00e2 A062     		str	r0, [r4, #40]
 582              	.LVL38:
 794:USBDevice/Class/DFU/usbd_dfu.c ****                                         itf->Address);
 583              		.loc 1 794 33 is_stmt 1 view .LVU185
 794:USBDevice/Class/DFU/usbd_dfu.c ****                                         itf->Address);
 584              		.loc 1 794 57 is_stmt 0 view .LVU186
 585 00e4 1B69     		ldr	r3, [r3, #16]
 586 00e6 9847     		blx	r3
 587              	.LVL39:
 794:USBDevice/Class/DFU/usbd_dfu.c ****                                         itf->Address);
 588              		.loc 1 794 55 view .LVU187
 589 00e8 84F82C00 		strb	r0, [r4, #44]
 590 00ec D0E7     		b	.L30
 591              	.LBE25:
 592              		.cfi_endproc
 593              	.LFE163:
 595 00ee 00BF     		.section	.text.dfu_detach,"ax",%progbits
 596              		.align	1
 597              		.p2align 2,,3
 598              		.syntax unified
 599              		.thumb
 600              		.thumb_func
 601              		.fpu fpv4-sp-d16
 603              	dfu_detach:
 604              	.LVL40:
 605              	.LFB156:
ARM GAS  /tmp/ccCRZMdU.s 			page 29


 498:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_APP_DETACH;
 606              		.loc 1 498 1 is_stmt 1 view -0
 607              		.cfi_startproc
 608              		@ args = 0, pretend = 0, frame = 0
 609              		@ frame_needed = 0, uses_anonymous_args = 0
 499:USBDevice/Class/DFU/usbd_dfu.c **** 
 610              		.loc 1 499 5 view .LVU189
 499:USBDevice/Class/DFU/usbd_dfu.c **** 
 611              		.loc 1 499 26 is_stmt 0 view .LVU190
 612 0000 0123     		movs	r3, #1
 498:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_APP_DETACH;
 613              		.loc 1 498 1 view .LVU191
 614 0002 10B5     		push	{r4, lr}
 615              	.LCFI5:
 616              		.cfi_def_cfa_offset 8
 617              		.cfi_offset 4, -8
 618              		.cfi_offset 14, -4
 498:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State = DFU_STATE_APP_DETACH;
 619              		.loc 1 498 1 view .LVU192
 620 0004 0446     		mov	r4, r0
 499:USBDevice/Class/DFU/usbd_dfu.c **** 
 621              		.loc 1 499 26 view .LVU193
 622 0006 80F83030 		strb	r3, [r0, #48]
 502:USBDevice/Class/DFU/usbd_dfu.c ****     {
 623              		.loc 1 502 5 is_stmt 1 view .LVU194
 506:USBDevice/Class/DFU/usbd_dfu.c **** 
 624              		.loc 1 506 9 view .LVU195
 625 000a 0068     		ldr	r0, [r0]
 626              	.LVL41:
 506:USBDevice/Class/DFU/usbd_dfu.c **** 
 627              		.loc 1 506 9 is_stmt 0 view .LVU196
 628 000c FFF7FEFF 		bl	USBD_Deinit
 629              	.LVL42:
 509:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[1] = ~DFU_MODE_TAG;
 630              		.loc 1 509 9 is_stmt 1 view .LVU197
 509:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[1] = ~DFU_MODE_TAG;
 631              		.loc 1 509 21 is_stmt 0 view .LVU198
 632 0010 0449     		ldr	r1, .L56
 510:USBDevice/Class/DFU/usbd_dfu.c **** 
 633              		.loc 1 510 21 view .LVU199
 634 0012 054A     		ldr	r2, .L56+4
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 635              		.loc 1 513 9 view .LVU200
 636 0014 2369     		ldr	r3, [r4, #16]
 510:USBDevice/Class/DFU/usbd_dfu.c **** 
 637              		.loc 1 510 21 view .LVU201
 638 0016 C4E90712 		strd	r1, r2, [r4, #28]
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 639              		.loc 1 513 9 is_stmt 1 view .LVU202
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 640              		.loc 1 513 9 view .LVU203
 641 001a 03B1     		cbz	r3, .L51
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 642              		.loc 1 513 9 discriminator 1 view .LVU204
 643 001c 9847     		blx	r3
 644              	.LVL43:
 645              	.L51:
ARM GAS  /tmp/ccCRZMdU.s 			page 30


 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 646              		.loc 1 513 9 discriminator 3 view .LVU205
 516:USBDevice/Class/DFU/usbd_dfu.c **** }
 647              		.loc 1 516 5 discriminator 3 view .LVU206
 517:USBDevice/Class/DFU/usbd_dfu.c **** 
 648              		.loc 1 517 1 is_stmt 0 discriminator 3 view .LVU207
 649 001e 0020     		movs	r0, #0
 650 0020 10BD     		pop	{r4, pc}
 651              	.LVL44:
 652              	.L57:
 517:USBDevice/Class/DFU/usbd_dfu.c **** 
 653              		.loc 1 517 1 discriminator 3 view .LVU208
 654 0022 00BF     		.align	2
 655              	.L56:
 656 0024 DF7007B0 		.word	-1341689633
 657 0028 208FF84F 		.word	1341689632
 658              		.cfi_endproc
 659              	.LFE156:
 661              		.section	.text.dfu_getState,"ax",%progbits
 662              		.align	1
 663              		.p2align 2,,3
 664              		.syntax unified
 665              		.thumb
 666              		.thumb_func
 667              		.fpu fpv4-sp-d16
 669              	dfu_getState:
 670              	.LVL45:
 671              	.LFB161:
 726:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_CtrlSendData(itf->Base.Device,
 672              		.loc 1 726 1 is_stmt 1 view -0
 673              		.cfi_startproc
 674              		@ args = 0, pretend = 0, frame = 0
 675              		@ frame_needed = 0, uses_anonymous_args = 0
 676              		@ link register save eliminated.
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 677              		.loc 1 727 5 view .LVU210
 728:USBDevice/Class/DFU/usbd_dfu.c **** }
 678              		.loc 1 728 13 is_stmt 0 view .LVU211
 679 0000 0146     		mov	r1, r0
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 680              		.loc 1 727 12 view .LVU212
 681 0002 0122     		movs	r2, #1
 682 0004 51F8300B 		ldr	r0, [r1], #48
 683              	.LVL46:
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 684              		.loc 1 727 12 view .LVU213
 685 0008 FFF7FEBF 		b	USBD_CtrlSendData
 686              	.LVL47:
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 687              		.loc 1 727 12 view .LVU214
 688              		.cfi_endproc
 689              	.LFE161:
 691              		.section	.text.dfu_getStatus,"ax",%progbits
 692              		.align	1
 693              		.p2align 2,,3
 694              		.syntax unified
 695              		.thumb
ARM GAS  /tmp/ccCRZMdU.s 			page 31


 696              		.thumb_func
 697              		.fpu fpv4-sp-d16
 699              	dfu_getStatus:
 700              	.LVL48:
 701              	.LFB159:
 666:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 702              		.loc 1 666 1 is_stmt 1 view -0
 703              		.cfi_startproc
 704              		@ args = 0, pretend = 0, frame = 0
 705              		@ frame_needed = 0, uses_anonymous_args = 0
 667:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_StateType nextState = itf->DevStatus.State;
 706              		.loc 1 667 5 view .LVU216
 666:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 707              		.loc 1 666 1 is_stmt 0 view .LVU217
 708 0000 70B5     		push	{r4, r5, r6, lr}
 709              	.LCFI6:
 710              		.cfi_def_cfa_offset 16
 711              		.cfi_offset 4, -16
 712              		.cfi_offset 5, -12
 713              		.cfi_offset 6, -8
 714              		.cfi_offset 14, -4
 668:USBDevice/Class/DFU/usbd_dfu.c **** 
 715              		.loc 1 668 24 view .LVU218
 716 0002 90F83050 		ldrb	r5, [r0, #48]	@ zero_extendqisi2
 666:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 717              		.loc 1 666 1 view .LVU219
 718 0006 0446     		mov	r4, r0
 667:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_DFU_StateType nextState = itf->DevStatus.State;
 719              		.loc 1 667 22 view .LVU220
 720 0008 0668     		ldr	r6, [r0]
 721              	.LVL49:
 668:USBDevice/Class/DFU/usbd_dfu.c **** 
 722              		.loc 1 668 5 is_stmt 1 view .LVU221
 671:USBDevice/Class/DFU/usbd_dfu.c ****         (itf->DevStatus.State == DFU_STATE_MANIFEST_SYNC))
 723              		.loc 1 671 5 view .LVU222
 671:USBDevice/Class/DFU/usbd_dfu.c ****         (itf->DevStatus.State == DFU_STATE_MANIFEST_SYNC))
 724              		.loc 1 671 8 is_stmt 0 view .LVU223
 725 000a 032D     		cmp	r5, #3
 726 000c 0BD0     		beq	.L65
 727 000e 062D     		cmp	r5, #6
 728 0010 09D0     		beq	.L65
 729              	.LVL50:
 730              	.L60:
 701:USBDevice/Class/DFU/usbd_dfu.c **** 
 731              		.loc 1 701 5 is_stmt 1 view .LVU224
 732 0012 3046     		mov	r0, r6
 733 0014 0622     		movs	r2, #6
 734 0016 04F12C01 		add	r1, r4, #44
 735 001a FFF7FEFF 		bl	USBD_CtrlSendData
 736              	.LVL51:
 703:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 737              		.loc 1 703 5 view .LVU225
 705:USBDevice/Class/DFU/usbd_dfu.c **** 
 738              		.loc 1 705 1 is_stmt 0 view .LVU226
 739 001e 0020     		movs	r0, #0
 703:USBDevice/Class/DFU/usbd_dfu.c ****     return USBD_E_OK;
 740              		.loc 1 703 26 view .LVU227
ARM GAS  /tmp/ccCRZMdU.s 			page 32


 741 0020 84F83050 		strb	r5, [r4, #48]
 704:USBDevice/Class/DFU/usbd_dfu.c **** }
 742              		.loc 1 704 5 is_stmt 1 view .LVU228
 705:USBDevice/Class/DFU/usbd_dfu.c **** 
 743              		.loc 1 705 1 is_stmt 0 view .LVU229
 744 0024 70BD     		pop	{r4, r5, r6, pc}
 745              	.LVL52:
 746              	.L65:
 674:USBDevice/Class/DFU/usbd_dfu.c ****         {
 747              		.loc 1 674 9 is_stmt 1 view .LVU230
 674:USBDevice/Class/DFU/usbd_dfu.c ****         {
 748              		.loc 1 674 16 is_stmt 0 view .LVU231
 749 0026 E18C     		ldrh	r1, [r4, #38]
 674:USBDevice/Class/DFU/usbd_dfu.c ****         {
 750              		.loc 1 674 12 view .LVU232
 751 0028 49B1     		cbz	r1, .L62
 676:USBDevice/Class/DFU/usbd_dfu.c ****             {
 752              		.loc 1 676 13 is_stmt 1 view .LVU233
 676:USBDevice/Class/DFU/usbd_dfu.c ****             {
 753              		.loc 1 676 29 is_stmt 0 view .LVU234
 754 002a E368     		ldr	r3, [r4, #12]
 755 002c DB69     		ldr	r3, [r3, #28]
 676:USBDevice/Class/DFU/usbd_dfu.c ****             {
 756              		.loc 1 676 16 view .LVU235
 757 002e 1BB1     		cbz	r3, .L63
 679:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->Address,
 758              		.loc 1 679 17 is_stmt 1 view .LVU236
 679:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->Address,
 759              		.loc 1 679 46 is_stmt 0 view .LVU237
 760 0030 A06A     		ldr	r0, [r4, #40]
 761              	.LVL53:
 679:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->Address,
 762              		.loc 1 679 46 view .LVU238
 763 0032 9847     		blx	r3
 764              	.LVL54:
 679:USBDevice/Class/DFU/usbd_dfu.c ****                         itf->Address,
 765              		.loc 1 679 44 view .LVU239
 766 0034 A4F82D00 		strh	r0, [r4, #45]	@ unaligned
 767              	.L63:
 686:USBDevice/Class/DFU/usbd_dfu.c ****         }
 768              		.loc 1 686 13 is_stmt 1 view .LVU240
 686:USBDevice/Class/DFU/usbd_dfu.c ****         }
 769              		.loc 1 686 23 is_stmt 0 view .LVU241
 770 0038 0135     		adds	r5, r5, #1
 771              	.LVL55:
 686:USBDevice/Class/DFU/usbd_dfu.c ****         }
 772              		.loc 1 686 23 view .LVU242
 773 003a EDB2     		uxtb	r5, r5
 774              	.LVL56:
 686:USBDevice/Class/DFU/usbd_dfu.c ****         }
 775              		.loc 1 686 23 view .LVU243
 776 003c E9E7     		b	.L60
 777              	.LVL57:
 778              	.L62:
 688:USBDevice/Class/DFU/usbd_dfu.c ****         {
 779              		.loc 1 688 14 is_stmt 1 view .LVU244
 688:USBDevice/Class/DFU/usbd_dfu.c ****         {
ARM GAS  /tmp/ccCRZMdU.s 			page 33


 780              		.loc 1 688 17 is_stmt 0 view .LVU245
 781 003e 032D     		cmp	r5, #3
 782 0040 04D0     		beq	.L73
 696:USBDevice/Class/DFU/usbd_dfu.c ****         }
 783              		.loc 1 696 13 is_stmt 1 view .LVU246
 784              	.LVL58:
 696:USBDevice/Class/DFU/usbd_dfu.c ****         }
 785              		.loc 1 696 34 is_stmt 0 view .LVU247
 786 0042 0223     		movs	r3, #2
 696:USBDevice/Class/DFU/usbd_dfu.c ****         }
 787              		.loc 1 696 46 view .LVU248
 788 0044 1D46     		mov	r5, r3
 696:USBDevice/Class/DFU/usbd_dfu.c ****         }
 789              		.loc 1 696 34 view .LVU249
 790 0046 84F83030 		strb	r3, [r4, #48]
 791 004a E2E7     		b	.L60
 792              	.LVL59:
 793              	.L73:
 691:USBDevice/Class/DFU/usbd_dfu.c ****         }
 794              		.loc 1 691 13 is_stmt 1 view .LVU250
 691:USBDevice/Class/DFU/usbd_dfu.c ****         }
 795              		.loc 1 691 34 is_stmt 0 view .LVU251
 796 004c 0525     		movs	r5, #5
 797 004e 84F83050 		strb	r5, [r4, #48]
 798 0052 DEE7     		b	.L60
 799              		.cfi_endproc
 800              	.LFE159:
 802              		.section	.text.dfu_upload,"ax",%progbits
 803              		.align	1
 804              		.p2align 2,,3
 805              		.syntax unified
 806              		.thumb
 807              		.thumb_func
 808              		.fpu fpv4-sp-d16
 810              	dfu_upload:
 811              	.LVL60:
 812              	.LFB158:
 578:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 813              		.loc 1 578 1 is_stmt 1 view -0
 814              		.cfi_startproc
 815              		@ args = 0, pretend = 0, frame = 8
 816              		@ frame_needed = 0, uses_anonymous_args = 0
 579:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 817              		.loc 1 579 5 view .LVU253
 580:USBDevice/Class/DFU/usbd_dfu.c **** 
 818              		.loc 1 580 5 view .LVU254
 578:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 819              		.loc 1 578 1 is_stmt 0 view .LVU255
 820 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 821              	.LCFI7:
 822              		.cfi_def_cfa_offset 20
 823              		.cfi_offset 4, -20
 824              		.cfi_offset 5, -16
 825              		.cfi_offset 6, -12
 826              		.cfi_offset 7, -8
 827              		.cfi_offset 14, -4
 580:USBDevice/Class/DFU/usbd_dfu.c **** 
ARM GAS  /tmp/ccCRZMdU.s 			page 34


 828              		.loc 1 580 22 view .LVU256
 829 0002 0468     		ldr	r4, [r0]
 830              	.LVL61:
 583:USBDevice/Class/DFU/usbd_dfu.c ****     {
 831              		.loc 1 583 5 is_stmt 1 view .LVU257
 578:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 832              		.loc 1 578 1 is_stmt 0 view .LVU258
 833 0004 83B0     		sub	sp, sp, #12
 834              	.LCFI8:
 835              		.cfi_def_cfa_offset 32
 578:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 836              		.loc 1 578 1 view .LVU259
 837 0006 0346     		mov	r3, r0
 583:USBDevice/Class/DFU/usbd_dfu.c ****     {
 838              		.loc 1 583 20 view .LVU260
 839 0008 6289     		ldrh	r2, [r4, #10]
 583:USBDevice/Class/DFU/usbd_dfu.c ****     {
 840              		.loc 1 583 8 view .LVU261
 841 000a D2B1     		cbz	r2, .L75
 583:USBDevice/Class/DFU/usbd_dfu.c ****     {
 842              		.loc 1 583 49 discriminator 1 view .LVU262
 843 000c C168     		ldr	r1, [r0, #12]
 844 000e 8D69     		ldr	r5, [r1, #24]
 583:USBDevice/Class/DFU/usbd_dfu.c ****     {
 845              		.loc 1 583 33 discriminator 1 view .LVU263
 846 0010 BDB1     		cbz	r5, .L75
 847              	.LBB26:
 585:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 848              		.loc 1 585 9 is_stmt 1 view .LVU264
 849              	.LVL62:
 587:USBDevice/Class/DFU/usbd_dfu.c **** 
 850              		.loc 1 587 9 view .LVU265
 587:USBDevice/Class/DFU/usbd_dfu.c **** 
 851              		.loc 1 587 35 is_stmt 0 view .LVU266
 852 0012 E088     		ldrh	r0, [r4, #6]
 853              	.LVL63:
 587:USBDevice/Class/DFU/usbd_dfu.c **** 
 854              		.loc 1 587 23 view .LVU267
 855 0014 9884     		strh	r0, [r3, #36]	@ movhi
 590:USBDevice/Class/DFU/usbd_dfu.c ****         {
 856              		.loc 1 590 9 is_stmt 1 view .LVU268
 590:USBDevice/Class/DFU/usbd_dfu.c ****         {
 857              		.loc 1 590 12 is_stmt 0 view .LVU269
 858 0016 D0B1     		cbz	r0, .L89
 599:USBDevice/Class/DFU/usbd_dfu.c ****         {
 859              		.loc 1 599 14 is_stmt 1 view .LVU270
 599:USBDevice/Class/DFU/usbd_dfu.c ****         {
 860              		.loc 1 599 17 is_stmt 0 view .LVU271
 861 0018 0128     		cmp	r0, #1
 862 001a 27D9     		bls	.L80
 603:USBDevice/Class/DFU/usbd_dfu.c ****                     DFUSE_GETADDRESS(itf, &dfu_desc),
 863              		.loc 1 603 13 view .LVU272
 864 001c 9E6A     		ldr	r6, [r3, #40]
 601:USBDevice/Class/DFU/usbd_dfu.c **** 
 865              		.loc 1 601 34 view .LVU273
 866 001e 0927     		movs	r7, #9
 604:USBDevice/Class/DFU/usbd_dfu.c ****                     data,
ARM GAS  /tmp/ccCRZMdU.s 			page 35


 867              		.loc 1 604 21 view .LVU274
 868 0020 0238     		subs	r0, r0, #2
 585:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ST_EXTENSION != 0)
 869              		.loc 1 585 18 view .LVU275
 870 0022 04F58671 		add	r1, r4, #268
 871              	.LVL64:
 601:USBDevice/Class/DFU/usbd_dfu.c **** 
 872              		.loc 1 601 13 is_stmt 1 view .LVU276
 601:USBDevice/Class/DFU/usbd_dfu.c **** 
 873              		.loc 1 601 34 is_stmt 0 view .LVU277
 874 0026 83F83070 		strb	r7, [r3, #48]
 603:USBDevice/Class/DFU/usbd_dfu.c ****                     DFUSE_GETADDRESS(itf, &dfu_desc),
 875              		.loc 1 603 13 is_stmt 1 view .LVU278
 876 002a 06EB4020 		add	r0, r6, r0, lsl #9
 877 002e 0191     		str	r1, [sp, #4]
 878 0030 A847     		blx	r5
 879              	.LVL65:
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 880              		.loc 1 608 13 view .LVU279
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 881              		.loc 1 608 22 is_stmt 0 view .LVU280
 882 0032 0199     		ldr	r1, [sp, #4]
 883 0034 6289     		ldrh	r2, [r4, #10]
 884 0036 2046     		mov	r0, r4
 885              	.LBE26:
 658:USBDevice/Class/DFU/usbd_dfu.c **** 
 886              		.loc 1 658 1 view .LVU281
 887 0038 03B0     		add	sp, sp, #12
 888              	.LCFI9:
 889              		.cfi_remember_state
 890              		.cfi_def_cfa_offset 20
 891              		@ sp needed
 892 003a BDE8F040 		pop	{r4, r5, r6, r7, lr}
 893              	.LCFI10:
 894              		.cfi_restore 14
 895              		.cfi_restore 7
 896              		.cfi_restore 6
 897              		.cfi_restore 5
 898              		.cfi_restore 4
 899              		.cfi_def_cfa_offset 0
 900              	.LVL66:
 901              	.LBB27:
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 902              		.loc 1 608 22 view .LVU282
 903 003e FFF7FEBF 		b	USBD_CtrlSendData
 904              	.LVL67:
 905              	.L75:
 906              	.LCFI11:
 907              		.cfi_restore_state
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 908              		.loc 1 608 22 view .LVU283
 909              	.LBE27:
 654:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 910              		.loc 1 654 9 is_stmt 1 view .LVU284
 654:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 911              		.loc 1 654 30 is_stmt 0 view .LVU285
 912 0042 0222     		movs	r2, #2
ARM GAS  /tmp/ccCRZMdU.s 			page 36


 655:USBDevice/Class/DFU/usbd_dfu.c ****     }
 913              		.loc 1 655 16 view .LVU286
 914 0044 0020     		movs	r0, #0
 915              	.LVL68:
 654:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 916              		.loc 1 654 30 view .LVU287
 917 0046 83F83020 		strb	r2, [r3, #48]
 655:USBDevice/Class/DFU/usbd_dfu.c ****     }
 918              		.loc 1 655 9 is_stmt 1 view .LVU288
 919              	.LVL69:
 920              	.L78:
 657:USBDevice/Class/DFU/usbd_dfu.c **** }
 921              		.loc 1 657 5 view .LVU289
 658:USBDevice/Class/DFU/usbd_dfu.c **** 
 922              		.loc 1 658 1 is_stmt 0 view .LVU290
 923 004a 03B0     		add	sp, sp, #12
 924              	.LCFI12:
 925              		.cfi_remember_state
 926              		.cfi_def_cfa_offset 20
 927              		@ sp needed
 928 004c F0BD     		pop	{r4, r5, r6, r7, pc}
 929              	.LVL70:
 930              	.L89:
 931              	.LCFI13:
 932              		.cfi_restore_state
 933              	.LBB28:
 592:USBDevice/Class/DFU/usbd_dfu.c ****                     DFU_STATE_IDLE : DFU_STATE_UPLOAD_IDLE;
 934              		.loc 1 592 13 is_stmt 1 view .LVU291
 592:USBDevice/Class/DFU/usbd_dfu.c ****                     DFU_STATE_IDLE : DFU_STATE_UPLOAD_IDLE;
 935              		.loc 1 592 34 is_stmt 0 view .LVU292
 936 004e 032A     		cmp	r2, #3
 596:USBDevice/Class/DFU/usbd_dfu.c ****         }
 937              		.loc 1 596 22 view .LVU293
 938 0050 2046     		mov	r0, r4
 939 0052 4FF00302 		mov	r2, #3
 940 0056 0649     		ldr	r1, .L90
 592:USBDevice/Class/DFU/usbd_dfu.c ****                     DFU_STATE_IDLE : DFU_STATE_UPLOAD_IDLE;
 941              		.loc 1 592 34 view .LVU294
 942 0058 8CBF     		ite	hi
 943 005a 0224     		movhi	r4, #2
 944              	.LVL71:
 592:USBDevice/Class/DFU/usbd_dfu.c ****                     DFU_STATE_IDLE : DFU_STATE_UPLOAD_IDLE;
 945              		.loc 1 592 34 view .LVU295
 946 005c 0924     		movls	r4, #9
 947 005e 83F83040 		strb	r4, [r3, #48]
 596:USBDevice/Class/DFU/usbd_dfu.c ****         }
 948              		.loc 1 596 13 is_stmt 1 view .LVU296
 949              	.LBE28:
 658:USBDevice/Class/DFU/usbd_dfu.c **** 
 950              		.loc 1 658 1 is_stmt 0 view .LVU297
 951 0062 03B0     		add	sp, sp, #12
 952              	.LCFI14:
 953              		.cfi_remember_state
 954              		.cfi_def_cfa_offset 20
 955              		@ sp needed
 956 0064 BDE8F040 		pop	{r4, r5, r6, r7, lr}
 957              	.LCFI15:
ARM GAS  /tmp/ccCRZMdU.s 			page 37


 958              		.cfi_restore 14
 959              		.cfi_restore 7
 960              		.cfi_restore 6
 961              		.cfi_restore 5
 962              		.cfi_restore 4
 963              		.cfi_def_cfa_offset 0
 964              	.LBB29:
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 965              		.loc 1 608 22 view .LVU298
 966 0068 FFF7FEBF 		b	USBD_CtrlSendData
 967              	.LVL72:
 968              	.L80:
 969              	.LCFI16:
 970              		.cfi_restore_state
 608:USBDevice/Class/DFU/usbd_dfu.c ****         }
 971              		.loc 1 608 22 view .LVU299
 972              	.LBE29:
 579:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 973              		.loc 1 579 21 view .LVU300
 974 006c 0320     		movs	r0, #3
 975 006e ECE7     		b	.L78
 976              	.L91:
 977              		.align	2
 978              	.L90:
 979 0070 00000000 		.word	.LANCHOR1
 980              		.cfi_endproc
 981              	.LFE158:
 983              		.section	.text.rodfu_setupStage,"ax",%progbits
 984              		.align	1
 985              		.p2align 2,,3
 986              		.syntax unified
 987              		.thumb
 988              		.thumb_func
 989              		.fpu fpv4-sp-d16
 991              	rodfu_setupStage:
 992              	.LVL73:
 993              	.LFB154:
 364:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 994              		.loc 1 364 1 is_stmt 1 view -0
 995              		.cfi_startproc
 996              		@ args = 0, pretend = 0, frame = 0
 997              		@ frame_needed = 0, uses_anonymous_args = 0
 365:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 998              		.loc 1 365 5 view .LVU302
 366:USBDevice/Class/DFU/usbd_dfu.c **** 
 999              		.loc 1 366 5 view .LVU303
 364:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1000              		.loc 1 364 1 is_stmt 0 view .LVU304
 1001 0000 38B5     		push	{r3, r4, r5, lr}
 1002              	.LCFI17:
 1003              		.cfi_def_cfa_offset 16
 1004              		.cfi_offset 3, -16
 1005              		.cfi_offset 4, -12
 1006              		.cfi_offset 5, -8
 1007              		.cfi_offset 14, -4
 364:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1008              		.loc 1 364 1 view .LVU305
ARM GAS  /tmp/ccCRZMdU.s 			page 38


 1009 0002 0446     		mov	r4, r0
 366:USBDevice/Class/DFU/usbd_dfu.c **** 
 1010              		.loc 1 366 22 view .LVU306
 1011 0004 0068     		ldr	r0, [r0]
 1012              	.LVL74:
 368:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1013              		.loc 1 368 5 is_stmt 1 view .LVU307
 368:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1014              		.loc 1 368 35 is_stmt 0 view .LVU308
 1015 0006 0379     		ldrb	r3, [r0, #4]	@ zero_extendqisi2
 368:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1016              		.loc 1 368 5 view .LVU309
 1017 0008 13F0600F 		tst	r3, #96
 368:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1018              		.loc 1 368 35 view .LVU310
 1019 000c C3F34111 		ubfx	r1, r3, #5, #2
 368:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1020              		.loc 1 368 5 view .LVU311
 1021 0010 0BD0     		beq	.L93
 1022 0012 0129     		cmp	r1, #1
 1023 0014 0A46     		mov	r2, r1
 1024 0016 05D1     		bne	.L100
 398:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1025              		.loc 1 398 13 is_stmt 1 view .LVU312
 398:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1026              		.loc 1 398 31 is_stmt 0 view .LVU313
 1027 0018 4579     		ldrb	r5, [r0, #5]	@ zero_extendqisi2
 1028 001a 032D     		cmp	r5, #3
 1029 001c 29D0     		beq	.L96
 1030 001e 052D     		cmp	r5, #5
 1031 0020 2ED0     		beq	.L97
 1032 0022 CDB1     		cbz	r5, .L105
 1033              	.L100:
 1034 0024 0325     		movs	r5, #3
 1035              	.LVL75:
 1036              	.L95:
 420:USBDevice/Class/DFU/usbd_dfu.c **** 
 1037              		.loc 1 420 1 view .LVU314
 1038 0026 2846     		mov	r0, r5
 1039 0028 38BD     		pop	{r3, r4, r5, pc}
 1040              	.LVL76:
 1041              	.L93:
 373:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1042              		.loc 1 373 13 is_stmt 1 view .LVU315
 373:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1043              		.loc 1 373 16 is_stmt 0 view .LVU316
 1044 002a 4379     		ldrb	r3, [r0, #5]	@ zero_extendqisi2
 1045 002c 062B     		cmp	r3, #6
 1046 002e F9D1     		bne	.L100
 375:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 1047              		.loc 1 375 17 is_stmt 1 view .LVU317
 375:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 1048              		.loc 1 375 42 is_stmt 0 view .LVU318
 1049 0030 C388     		ldrh	r3, [r0, #6]
 1050 0032 1B0A     		lsrs	r3, r3, #8
 1051 0034 212B     		cmp	r3, #33
 1052 0036 F5D1     		bne	.L100
ARM GAS  /tmp/ccCRZMdU.s 			page 39


 1053              	.LBB30:
 381:USBDevice/Class/DFU/usbd_dfu.c ****                         memcpy(dev->CtrlData, &dfu_desc.DFUFD, sizeof(dfu_desc.DFUFD));
 1054              		.loc 1 381 25 is_stmt 1 view .LVU319
 1055              	.LVL77:
 382:USBDevice/Class/DFU/usbd_dfu.c **** #else
 1056              		.loc 1 382 25 view .LVU320
 1057 0038 144B     		ldr	r3, .L106
 1058 003a 00F58671 		add	r1, r0, #268
 1059              	.LVL78:
 386:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 1060              		.loc 1 386 34 is_stmt 0 view .LVU321
 1061 003e 0922     		movs	r2, #9
 382:USBDevice/Class/DFU/usbd_dfu.c **** #else
 1062              		.loc 1 382 25 view .LVU322
 1063 0040 1D68     		ldr	r5, [r3]	@ unaligned
 1064 0042 5C68     		ldr	r4, [r3, #4]	@ unaligned
 1065              	.LVL79:
 382:USBDevice/Class/DFU/usbd_dfu.c **** #else
 1066              		.loc 1 382 25 view .LVU323
 1067 0044 1B7A     		ldrb	r3, [r3, #8]	@ zero_extendqisi2
 1068 0046 C0F80C51 		str	r5, [r0, #268]	@ unaligned
 1069 004a C0F81041 		str	r4, [r0, #272]	@ unaligned
 1070 004e 0B72     		strb	r3, [r1, #8]
 386:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 1071              		.loc 1 386 25 is_stmt 1 view .LVU324
 1072              	.LBE30:
 420:USBDevice/Class/DFU/usbd_dfu.c **** 
 1073              		.loc 1 420 1 is_stmt 0 view .LVU325
 1074 0050 BDE83840 		pop	{r3, r4, r5, lr}
 1075              	.LCFI18:
 1076              		.cfi_remember_state
 1077              		.cfi_restore 14
 1078              		.cfi_restore 5
 1079              		.cfi_restore 4
 1080              		.cfi_restore 3
 1081              		.cfi_def_cfa_offset 0
 1082              	.LBB31:
 386:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 1083              		.loc 1 386 34 view .LVU326
 1084 0054 FFF7FEBF 		b	USBD_CtrlSendData
 1085              	.LVL80:
 1086              	.L105:
 1087              	.LCFI19:
 1088              		.cfi_restore_state
 386:USBDevice/Class/DFU/usbd_dfu.c ****                         break;
 1089              		.loc 1 386 34 view .LVU327
 1090              	.LBE31:
 401:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 1091              		.loc 1 401 21 is_stmt 1 view .LVU328
 1092              	.LBB32:
 1093              	.LBI32:
 497:USBDevice/Class/DFU/usbd_dfu.c **** {
 1094              		.loc 1 497 24 view .LVU329
 1095              	.LBB33:
 499:USBDevice/Class/DFU/usbd_dfu.c **** 
 1096              		.loc 1 499 5 view .LVU330
 499:USBDevice/Class/DFU/usbd_dfu.c **** 
ARM GAS  /tmp/ccCRZMdU.s 			page 40


 1097              		.loc 1 499 26 is_stmt 0 view .LVU331
 1098 0058 84F83010 		strb	r1, [r4, #48]
 502:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1099              		.loc 1 502 5 is_stmt 1 view .LVU332
 506:USBDevice/Class/DFU/usbd_dfu.c **** 
 1100              		.loc 1 506 9 view .LVU333
 1101 005c FFF7FEFF 		bl	USBD_Deinit
 1102              	.LVL81:
 509:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[1] = ~DFU_MODE_TAG;
 1103              		.loc 1 509 9 view .LVU334
 509:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Tag[1] = ~DFU_MODE_TAG;
 1104              		.loc 1 509 21 is_stmt 0 view .LVU335
 1105 0060 0B49     		ldr	r1, .L106+4
 510:USBDevice/Class/DFU/usbd_dfu.c **** 
 1106              		.loc 1 510 21 view .LVU336
 1107 0062 0C4A     		ldr	r2, .L106+8
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1108              		.loc 1 513 9 view .LVU337
 1109 0064 2369     		ldr	r3, [r4, #16]
 510:USBDevice/Class/DFU/usbd_dfu.c **** 
 1110              		.loc 1 510 21 view .LVU338
 1111 0066 C4E90712 		strd	r1, r2, [r4, #28]
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1112              		.loc 1 513 9 is_stmt 1 view .LVU339
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1113              		.loc 1 513 9 view .LVU340
 1114 006a 002B     		cmp	r3, #0
 1115 006c DBD0     		beq	.L95
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1116              		.loc 1 513 9 view .LVU341
 1117 006e 9847     		blx	r3
 1118              	.LVL82:
 1119 0070 D9E7     		b	.L95
 1120              	.LVL83:
 1121              	.L96:
 513:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1122              		.loc 1 513 9 is_stmt 0 view .LVU342
 1123              	.LBE33:
 1124              	.LBE32:
 404:USBDevice/Class/DFU/usbd_dfu.c ****                             &itf->DevStatus, sizeof(itf->DevStatus));
 1125              		.loc 1 404 21 is_stmt 1 view .LVU343
 404:USBDevice/Class/DFU/usbd_dfu.c ****                             &itf->DevStatus, sizeof(itf->DevStatus));
 1126              		.loc 1 404 28 is_stmt 0 view .LVU344
 1127 0072 04F12C01 		add	r1, r4, #44
 1128 0076 0622     		movs	r2, #6
 420:USBDevice/Class/DFU/usbd_dfu.c **** 
 1129              		.loc 1 420 1 view .LVU345
 1130 0078 BDE83840 		pop	{r3, r4, r5, lr}
 1131              	.LCFI20:
 1132              		.cfi_remember_state
 1133              		.cfi_restore 14
 1134              		.cfi_restore 5
 1135              		.cfi_restore 4
 1136              		.cfi_restore 3
 1137              		.cfi_def_cfa_offset 0
 1138              	.LVL84:
 404:USBDevice/Class/DFU/usbd_dfu.c ****                             &itf->DevStatus, sizeof(itf->DevStatus));
ARM GAS  /tmp/ccCRZMdU.s 			page 41


 1139              		.loc 1 404 28 view .LVU346
 1140 007c FFF7FEBF 		b	USBD_CtrlSendData
 1141              	.LVL85:
 1142              	.L97:
 1143              	.LCFI21:
 1144              		.cfi_restore_state
 406:USBDevice/Class/DFU/usbd_dfu.c ****                 case DFU_REQ_GETSTATE:
 1145              		.loc 1 406 21 is_stmt 1 view .LVU347
 408:USBDevice/Class/DFU/usbd_dfu.c ****                     break;
 1146              		.loc 1 408 21 view .LVU348
 1147              	.LBB34:
 1148              	.LBI34:
 725:USBDevice/Class/DFU/usbd_dfu.c **** {
 1149              		.loc 1 725 24 view .LVU349
 1150              	.LBB35:
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 1151              		.loc 1 727 5 view .LVU350
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 1152              		.loc 1 727 12 is_stmt 0 view .LVU351
 1153 0080 04F13001 		add	r1, r4, #48
 1154              	.LBE35:
 1155              	.LBE34:
 420:USBDevice/Class/DFU/usbd_dfu.c **** 
 1156              		.loc 1 420 1 view .LVU352
 1157 0084 BDE83840 		pop	{r3, r4, r5, lr}
 1158              	.LCFI22:
 1159              		.cfi_restore 14
 1160              		.cfi_restore 5
 1161              		.cfi_restore 4
 1162              		.cfi_restore 3
 1163              		.cfi_def_cfa_offset 0
 1164              	.LVL86:
 1165              	.LBB37:
 1166              	.LBB36:
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 1167              		.loc 1 727 12 view .LVU353
 1168 0088 FFF7FEBF 		b	USBD_CtrlSendData
 1169              	.LVL87:
 1170              	.L107:
 727:USBDevice/Class/DFU/usbd_dfu.c ****             &itf->DevStatus.State, sizeof(itf->DevStatus.State));
 1171              		.loc 1 727 12 view .LVU354
 1172              		.align	2
 1173              	.L106:
 1174 008c 09000000 		.word	.LANCHOR0+9
 1175 0090 DF7007B0 		.word	-1341689633
 1176 0094 208FF84F 		.word	1341689632
 1177              	.LBE36:
 1178              	.LBE37:
 1179              		.cfi_endproc
 1180              	.LFE154:
 1182              		.section	.text.dfu_download,"ax",%progbits
 1183              		.align	1
 1184              		.p2align 2,,3
 1185              		.syntax unified
 1186              		.thumb
 1187              		.thumb_func
 1188              		.fpu fpv4-sp-d16
ARM GAS  /tmp/ccCRZMdU.s 			page 42


 1190              	dfu_download:
 1191              	.LVL88:
 1192              	.LFB157:
 525:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1193              		.loc 1 525 1 is_stmt 1 view -0
 1194              		.cfi_startproc
 1195              		@ args = 0, pretend = 0, frame = 0
 1196              		@ frame_needed = 0, uses_anonymous_args = 0
 1197              		@ link register save eliminated.
 526:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1198              		.loc 1 526 5 view .LVU356
 527:USBDevice/Class/DFU/usbd_dfu.c **** 
 1199              		.loc 1 527 5 view .LVU357
 527:USBDevice/Class/DFU/usbd_dfu.c **** 
 1200              		.loc 1 527 22 is_stmt 0 view .LVU358
 1201 0000 0268     		ldr	r2, [r0]
 1202              	.LVL89:
 529:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1203              		.loc 1 529 5 is_stmt 1 view .LVU359
 525:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1204              		.loc 1 525 1 is_stmt 0 view .LVU360
 1205 0002 0346     		mov	r3, r0
 529:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1206              		.loc 1 529 19 view .LVU361
 1207 0004 5089     		ldrh	r0, [r2, #10]
 1208              	.LVL90:
 529:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1209              		.loc 1 529 8 view .LVU362
 1210 0006 88B1     		cbz	r0, .L109
 532:USBDevice/Class/DFU/usbd_dfu.c ****         {
 1211              		.loc 1 532 9 is_stmt 1 view .LVU363
 532:USBDevice/Class/DFU/usbd_dfu.c ****         {
 1212              		.loc 1 532 14 is_stmt 0 view .LVU364
 1213 0008 D968     		ldr	r1, [r3, #12]
 525:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1214              		.loc 1 525 1 view .LVU365
 1215 000a 30B4     		push	{r4, r5}
 1216              	.LCFI23:
 1217              		.cfi_def_cfa_offset 8
 1218              		.cfi_offset 4, -8
 1219              		.cfi_offset 5, -4
 532:USBDevice/Class/DFU/usbd_dfu.c ****         {
 1220              		.loc 1 532 12 view .LVU366
 1221 000c 0C69     		ldr	r4, [r1, #16]
 1222 000e 9CB1     		cbz	r4, .L112
 532:USBDevice/Class/DFU/usbd_dfu.c ****         {
 1223              		.loc 1 532 43 discriminator 1 view .LVU367
 1224 0010 4969     		ldr	r1, [r1, #20]
 1225 0012 89B1     		cbz	r1, .L112
 549:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockLength = dev->Setup.Length;
 1226              		.loc 1 549 17 is_stmt 1 view .LVU368
 549:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockLength = dev->Setup.Length;
 1227              		.loc 1 549 34 is_stmt 0 view .LVU369
 1228 0014 D588     		ldrh	r5, [r2, #6]
 553:USBDevice/Class/DFU/usbd_dfu.c **** 
 1229              		.loc 1 553 38 view .LVU370
 1230 0016 0324     		movs	r4, #3
ARM GAS  /tmp/ccCRZMdU.s 			page 43


 550:USBDevice/Class/DFU/usbd_dfu.c **** 
 1231              		.loc 1 550 34 view .LVU371
 1232 0018 D884     		strh	r0, [r3, #38]	@ movhi
 556:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1233              		.loc 1 556 26 view .LVU372
 1234 001a 02F58671 		add	r1, r2, #268
 549:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->BlockLength = dev->Setup.Length;
 1235              		.loc 1 549 34 view .LVU373
 1236 001e 9D84     		strh	r5, [r3, #36]	@ movhi
 550:USBDevice/Class/DFU/usbd_dfu.c **** 
 1237              		.loc 1 550 17 is_stmt 1 view .LVU374
 553:USBDevice/Class/DFU/usbd_dfu.c **** 
 1238              		.loc 1 553 17 view .LVU375
 556:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1239              		.loc 1 556 26 is_stmt 0 view .LVU376
 1240 0020 1046     		mov	r0, r2
 553:USBDevice/Class/DFU/usbd_dfu.c **** 
 1241              		.loc 1 553 38 view .LVU377
 1242 0022 83F83040 		strb	r4, [r3, #48]
 556:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1243              		.loc 1 556 17 is_stmt 1 view .LVU378
 570:USBDevice/Class/DFU/usbd_dfu.c **** 
 1244              		.loc 1 570 1 is_stmt 0 view .LVU379
 1245 0026 30BC     		pop	{r4, r5}
 1246              	.LCFI24:
 1247              		.cfi_restore 5
 1248              		.cfi_restore 4
 1249              		.cfi_def_cfa_offset 0
 556:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1250              		.loc 1 556 26 view .LVU380
 1251 0028 FFF7FEBF 		b	USBD_CtrlReceiveData
 1252              	.LVL91:
 1253              	.L109:
 565:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_MANIFEST_SYNC;
 1254              		.loc 1 565 9 is_stmt 1 view .LVU381
 565:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_MANIFEST_SYNC;
 1255              		.loc 1 565 26 is_stmt 0 view .LVU382
 1256 002c 0121     		movs	r1, #1
 566:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 1257              		.loc 1 566 30 view .LVU383
 1258 002e 0622     		movs	r2, #6
 1259              	.LVL92:
 565:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State = DFU_STATE_MANIFEST_SYNC;
 1260              		.loc 1 565 26 view .LVU384
 1261 0030 D984     		strh	r1, [r3, #38]	@ movhi
 566:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 1262              		.loc 1 566 9 is_stmt 1 view .LVU385
 566:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 1263              		.loc 1 566 30 is_stmt 0 view .LVU386
 1264 0032 83F83020 		strb	r2, [r3, #48]
 567:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1265              		.loc 1 567 9 is_stmt 1 view .LVU387
 1266              	.LVL93:
 569:USBDevice/Class/DFU/usbd_dfu.c **** }
 1267              		.loc 1 569 5 view .LVU388
 570:USBDevice/Class/DFU/usbd_dfu.c **** 
 1268              		.loc 1 570 1 is_stmt 0 view .LVU389
ARM GAS  /tmp/ccCRZMdU.s 			page 44


 1269 0036 7047     		bx	lr
 1270              	.LVL94:
 1271              	.L112:
 1272              	.LCFI25:
 1273              		.cfi_def_cfa_offset 8
 1274              		.cfi_offset 4, -8
 1275              		.cfi_offset 5, -4
 526:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1276              		.loc 1 526 21 view .LVU390
 1277 0038 0320     		movs	r0, #3
 1278              	.LVL95:
 569:USBDevice/Class/DFU/usbd_dfu.c **** }
 1279              		.loc 1 569 5 is_stmt 1 view .LVU391
 570:USBDevice/Class/DFU/usbd_dfu.c **** 
 1280              		.loc 1 570 1 is_stmt 0 view .LVU392
 1281 003a 30BC     		pop	{r4, r5}
 1282              	.LCFI26:
 1283              		.cfi_restore 5
 1284              		.cfi_restore 4
 1285              		.cfi_def_cfa_offset 0
 1286 003c 7047     		bx	lr
 1287              		.cfi_endproc
 1288              	.LFE157:
 1290 003e 00BF     		.section	.text.dfu_init,"ax",%progbits
 1291              		.align	1
 1292              		.p2align 2,,3
 1293              		.syntax unified
 1294              		.thumb
 1295              		.thumb_func
 1296              		.fpu fpv4-sp-d16
 1298              	dfu_init:
 1299              	.LVL96:
 1300              	.LFB152:
 324:USBDevice/Class/DFU/usbd_dfu.c ****     /* Internal variables initialization */
 1301              		.loc 1 324 1 is_stmt 1 view -0
 1302              		.cfi_startproc
 1303              		@ args = 0, pretend = 0, frame = 0
 1304              		@ frame_needed = 0, uses_anonymous_args = 0
 1305              		@ link register save eliminated.
 326:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.iString     = 0;
 1306              		.loc 1 326 5 view .LVU394
 332:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1307              		.loc 1 332 8 is_stmt 0 view .LVU395
 1308 0000 90F83020 		ldrb	r2, [r0, #48]	@ zero_extendqisi2
 326:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.iString     = 0;
 1309              		.loc 1 326 32 view .LVU396
 1310 0004 0023     		movs	r3, #0
 332:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1311              		.loc 1 332 8 view .LVU397
 1312 0006 012A     		cmp	r2, #1
 326:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.iString     = 0;
 1313              		.loc 1 326 32 view .LVU398
 1314 0008 80F82F30 		strb	r3, [r0, #47]
 327:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 1315              		.loc 1 327 5 is_stmt 1 view .LVU399
 327:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.PollTimeout = 0;
 1316              		.loc 1 327 32 is_stmt 0 view .LVU400
ARM GAS  /tmp/ccCRZMdU.s 			page 45


 1317 000c 80F83130 		strb	r3, [r0, #49]
 328:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Tag[0] = itf->Tag[1] = 0;
 1318              		.loc 1 328 5 is_stmt 1 view .LVU401
 328:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Tag[0] = itf->Tag[1] = 0;
 1319              		.loc 1 328 32 is_stmt 0 view .LVU402
 1320 0010 80F82D30 		strb	r3, [r0, #45]
 1321 0014 80F82E30 		strb	r3, [r0, #46]
 329:USBDevice/Class/DFU/usbd_dfu.c **** 
 1322              		.loc 1 329 5 is_stmt 1 view .LVU403
 329:USBDevice/Class/DFU/usbd_dfu.c **** 
 1323              		.loc 1 329 17 is_stmt 0 view .LVU404
 1324 0018 C0E90733 		strd	r3, r3, [r0, #28]
 332:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1325              		.loc 1 332 5 is_stmt 1 view .LVU405
 332:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1326              		.loc 1 332 8 is_stmt 0 view .LVU406
 1327 001c 06D9     		bls	.L117
 1328              	.LVL97:
 1329              	.LBB40:
 1330              	.LBI40:
 323:USBDevice/Class/DFU/usbd_dfu.c **** {
 1331              		.loc 1 323 13 is_stmt 1 view .LVU407
 1332              	.LBB41:
 334:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockNum = 0;
 1333              		.loc 1 334 9 view .LVU408
 334:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockNum = 0;
 1334              		.loc 1 334 34 is_stmt 0 view .LVU409
 1335 001e C268     		ldr	r2, [r0, #12]
 334:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockNum = 0;
 1336              		.loc 1 334 22 view .LVU410
 1337 0020 116A     		ldr	r1, [r2, #32]
 339:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1338              		.loc 1 339 9 view .LVU411
 1339 0022 5268     		ldr	r2, [r2, #4]
 335:USBDevice/Class/DFU/usbd_dfu.c ****         itf->BlockLength = 0;
 1340              		.loc 1 335 23 view .LVU412
 1341 0024 C0E90931 		strd	r3, r1, [r0, #36]
 339:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1342              		.loc 1 339 9 is_stmt 1 view .LVU413
 339:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1343              		.loc 1 339 9 view .LVU414
 1344 0028 02B1     		cbz	r2, .L117
 339:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1345              		.loc 1 339 9 view .LVU415
 1346 002a 1047     		bx	r2	@ indirect register sibling call
 1347              	.LVL98:
 1348              	.L117:
 339:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1349              		.loc 1 339 9 is_stmt 0 view .LVU416
 1350              	.LBE41:
 1351              	.LBE40:
 341:USBDevice/Class/DFU/usbd_dfu.c **** 
 1352              		.loc 1 341 1 view .LVU417
 1353 002c 7047     		bx	lr
 1354              		.cfi_endproc
 1355              	.LFE152:
 1357 002e 00BF     		.section	.text.dfu_deinit,"ax",%progbits
ARM GAS  /tmp/ccCRZMdU.s 			page 46


 1358              		.align	1
 1359              		.p2align 2,,3
 1360              		.syntax unified
 1361              		.thumb
 1362              		.thumb_func
 1363              		.fpu fpv4-sp-d16
 1365              	dfu_deinit:
 1366              	.LVL99:
 1367              	.LFB153:
 349:USBDevice/Class/DFU/usbd_dfu.c ****     /* In DFU mode */
 1368              		.loc 1 349 1 is_stmt 1 view -0
 1369              		.cfi_startproc
 1370              		@ args = 0, pretend = 0, frame = 0
 1371              		@ frame_needed = 0, uses_anonymous_args = 0
 1372              		@ link register save eliminated.
 351:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1373              		.loc 1 351 5 view .LVU419
 351:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1374              		.loc 1 351 8 is_stmt 0 view .LVU420
 1375 0000 90F83030 		ldrb	r3, [r0, #48]	@ zero_extendqisi2
 1376 0004 012B     		cmp	r3, #1
 1377 0006 03D9     		bls	.L124
 1378              	.LVL100:
 1379              	.LBB44:
 1380              	.LBI44:
 348:USBDevice/Class/DFU/usbd_dfu.c **** {
 1381              		.loc 1 348 13 is_stmt 1 view .LVU421
 1382              	.LBB45:
 354:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1383              		.loc 1 354 9 view .LVU422
 354:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1384              		.loc 1 354 9 view .LVU423
 1385 0008 C368     		ldr	r3, [r0, #12]
 1386 000a 9B68     		ldr	r3, [r3, #8]
 1387 000c 03B1     		cbz	r3, .L124
 354:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1388              		.loc 1 354 9 view .LVU424
 1389 000e 1847     		bx	r3	@ indirect register sibling call
 1390              	.LVL101:
 1391              	.L124:
 354:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1392              		.loc 1 354 9 is_stmt 0 view .LVU425
 1393              	.LBE45:
 1394              	.LBE44:
 356:USBDevice/Class/DFU/usbd_dfu.c **** 
 1395              		.loc 1 356 1 view .LVU426
 1396 0010 7047     		bx	lr
 1397              		.cfi_endproc
 1398              	.LFE153:
 1400 0012 00BF     		.section	.text.dfu_setupStage,"ax",%progbits
 1401              		.align	1
 1402              		.p2align 2,,3
 1403              		.syntax unified
 1404              		.thumb
 1405              		.thumb_func
 1406              		.fpu fpv4-sp-d16
 1408              	dfu_setupStage:
ARM GAS  /tmp/ccCRZMdU.s 			page 47


 1409              	.LVL102:
 1410              	.LFB155:
 428:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1411              		.loc 1 428 1 is_stmt 1 view -0
 1412              		.cfi_startproc
 1413              		@ args = 0, pretend = 0, frame = 0
 1414              		@ frame_needed = 0, uses_anonymous_args = 0
 429:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1415              		.loc 1 429 5 view .LVU428
 430:USBDevice/Class/DFU/usbd_dfu.c **** 
 1416              		.loc 1 430 5 view .LVU429
 428:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1417              		.loc 1 428 1 is_stmt 0 view .LVU430
 1418 0000 F8B5     		push	{r3, r4, r5, r6, r7, lr}
 1419              	.LCFI27:
 1420              		.cfi_def_cfa_offset 24
 1421              		.cfi_offset 3, -24
 1422              		.cfi_offset 4, -20
 1423              		.cfi_offset 5, -16
 1424              		.cfi_offset 6, -12
 1425              		.cfi_offset 7, -8
 1426              		.cfi_offset 14, -4
 430:USBDevice/Class/DFU/usbd_dfu.c **** 
 1427              		.loc 1 430 22 view .LVU431
 1428 0002 0568     		ldr	r5, [r0]
 1429              	.LVL103:
 432:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1430              		.loc 1 432 5 is_stmt 1 view .LVU432
 428:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_INVALID;
 1431              		.loc 1 428 1 is_stmt 0 view .LVU433
 1432 0004 0446     		mov	r4, r0
 432:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1433              		.loc 1 432 35 view .LVU434
 1434 0006 2B79     		ldrb	r3, [r5, #4]	@ zero_extendqisi2
 432:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1435              		.loc 1 432 5 view .LVU435
 1436 0008 13F0600F 		tst	r3, #96
 432:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1437              		.loc 1 432 35 view .LVU436
 1438 000c C3F34112 		ubfx	r2, r3, #5, #2
 432:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1439              		.loc 1 432 5 view .LVU437
 1440 0010 12D0     		beq	.L130
 1441 0012 012A     		cmp	r2, #1
 1442 0014 13D1     		bne	.L138
 1443              	.LBB52:
 460:USBDevice/Class/DFU/usbd_dfu.c ****             uint16_t stateMask = 1 << itf->DevStatus.State;
 1444              		.loc 1 460 13 is_stmt 1 view .LVU438
 460:USBDevice/Class/DFU/usbd_dfu.c ****             uint16_t stateMask = 1 << itf->DevStatus.State;
 1445              		.loc 1 460 21 is_stmt 0 view .LVU439
 1446 0016 6B79     		ldrb	r3, [r5, #5]	@ zero_extendqisi2
 1447              	.LVL104:
 461:USBDevice/Class/DFU/usbd_dfu.c **** 
 1448              		.loc 1 461 13 is_stmt 1 view .LVU440
 461:USBDevice/Class/DFU/usbd_dfu.c **** 
 1449              		.loc 1 461 53 is_stmt 0 view .LVU441
 1450 0018 90F83010 		ldrb	r1, [r0, #48]	@ zero_extendqisi2
ARM GAS  /tmp/ccCRZMdU.s 			page 48


 1451              	.LVL105:
 465:USBDevice/Class/DFU/usbd_dfu.c ****                 ((dfu_validStates[reqId] & stateMask) != 0) &&
 1452              		.loc 1 465 13 is_stmt 1 view .LVU442
 465:USBDevice/Class/DFU/usbd_dfu.c ****                 ((dfu_validStates[reqId] & stateMask) != 0) &&
 1453              		.loc 1 465 16 is_stmt 0 view .LVU443
 1454 001c 062B     		cmp	r3, #6
 1455 001e 12D8     		bhi	.L135
 466:USBDevice/Class/DFU/usbd_dfu.c ****                 (USBD_E_OK == dfu_reqFns[reqId](itf)))
 1456              		.loc 1 466 34 discriminator 1 view .LVU444
 1457 0020 2C4D     		ldr	r5, .L158
 1458              	.LVL106:
 461:USBDevice/Class/DFU/usbd_dfu.c **** 
 1459              		.loc 1 461 36 discriminator 1 view .LVU445
 1460 0022 8A40     		lsls	r2, r2, r1
 466:USBDevice/Class/DFU/usbd_dfu.c ****                 (USBD_E_OK == dfu_reqFns[reqId](itf)))
 1461              		.loc 1 466 55 discriminator 1 view .LVU446
 1462 0024 35F81350 		ldrh	r5, [r5, r3, lsl #1]
 465:USBDevice/Class/DFU/usbd_dfu.c ****                 ((dfu_validStates[reqId] & stateMask) != 0) &&
 1463              		.loc 1 465 47 discriminator 1 view .LVU447
 1464 0028 2A42     		tst	r2, r5
 1465 002a 0CD0     		beq	.L135
 467:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1466              		.loc 1 467 41 view .LVU448
 1467 002c 2A4A     		ldr	r2, .L158+4
 467:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1468              		.loc 1 467 31 view .LVU449
 1469 002e 52F82330 		ldr	r3, [r2, r3, lsl #2]
 1470              	.LVL107:
 467:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1471              		.loc 1 467 31 view .LVU450
 1472 0032 9847     		blx	r3
 1473              	.LVL108:
 466:USBDevice/Class/DFU/usbd_dfu.c ****                 (USBD_E_OK == dfu_reqFns[reqId](itf)))
 1474              		.loc 1 466 61 view .LVU451
 1475 0034 28B9     		cbnz	r0, .L155
 1476              	.LVL109:
 466:USBDevice/Class/DFU/usbd_dfu.c ****                 (USBD_E_OK == dfu_reqFns[reqId](itf)))
 1477              		.loc 1 466 61 view .LVU452
 1478              	.LBE52:
 487:USBDevice/Class/DFU/usbd_dfu.c **** }
 1479              		.loc 1 487 5 is_stmt 1 view .LVU453
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1480              		.loc 1 488 1 is_stmt 0 view .LVU454
 1481 0036 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1482              	.LVL110:
 1483              	.L130:
 437:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1484              		.loc 1 437 13 is_stmt 1 view .LVU455
 437:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1485              		.loc 1 437 16 is_stmt 0 view .LVU456
 1486 0038 6B79     		ldrb	r3, [r5, #5]	@ zero_extendqisi2
 1487 003a 062B     		cmp	r3, #6
 1488 003c 0DD0     		beq	.L156
 1489              	.L138:
 429:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1490              		.loc 1 429 21 view .LVU457
 1491 003e 0320     		movs	r0, #3
ARM GAS  /tmp/ccCRZMdU.s 			page 49


 1492              	.LVL111:
 487:USBDevice/Class/DFU/usbd_dfu.c **** }
 1493              		.loc 1 487 5 is_stmt 1 view .LVU458
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1494              		.loc 1 488 1 is_stmt 0 view .LVU459
 1495 0040 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1496              	.LVL112:
 1497              	.L155:
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1498              		.loc 1 488 1 view .LVU460
 1499 0042 94F83010 		ldrb	r1, [r4, #48]	@ zero_extendqisi2
 1500              	.L135:
 1501              	.LBB53:
 472:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1502              		.loc 1 472 18 is_stmt 1 view .LVU461
 472:USBDevice/Class/DFU/usbd_dfu.c ****             {
 1503              		.loc 1 472 21 is_stmt 0 view .LVU462
 1504 0046 0129     		cmp	r1, #1
 1505 0048 3ED9     		bls	.L157
 478:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.Status = DFU_ERROR_STALLEDPKT;
 1506              		.loc 1 478 17 is_stmt 1 view .LVU463
 478:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.Status = DFU_ERROR_STALLEDPKT;
 1507              		.loc 1 478 38 is_stmt 0 view .LVU464
 1508 004a 0A22     		movs	r2, #10
 479:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1509              		.loc 1 479 39 view .LVU465
 1510 004c 0F23     		movs	r3, #15
 1511              	.LBE53:
 429:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1512              		.loc 1 429 21 view .LVU466
 1513 004e 0320     		movs	r0, #3
 1514              	.LBB54:
 478:USBDevice/Class/DFU/usbd_dfu.c ****                 itf->DevStatus.Status = DFU_ERROR_STALLEDPKT;
 1515              		.loc 1 478 38 view .LVU467
 1516 0050 84F83020 		strb	r2, [r4, #48]
 479:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1517              		.loc 1 479 17 is_stmt 1 view .LVU468
 479:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1518              		.loc 1 479 39 is_stmt 0 view .LVU469
 1519 0054 84F82C30 		strb	r3, [r4, #44]
 1520              	.LVL113:
 479:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1521              		.loc 1 479 39 view .LVU470
 1522              	.LBE54:
 487:USBDevice/Class/DFU/usbd_dfu.c **** }
 1523              		.loc 1 487 5 is_stmt 1 view .LVU471
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1524              		.loc 1 488 1 is_stmt 0 view .LVU472
 1525 0058 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1526              	.LVL114:
 1527              	.L156:
 439:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 1528              		.loc 1 439 17 is_stmt 1 view .LVU473
 439:USBDevice/Class/DFU/usbd_dfu.c ****                 {
 1529              		.loc 1 439 42 is_stmt 0 view .LVU474
 1530 005a EB88     		ldrh	r3, [r5, #6]
 1531 005c 1B0A     		lsrs	r3, r3, #8
ARM GAS  /tmp/ccCRZMdU.s 			page 50


 1532 005e 212B     		cmp	r3, #33
 1533 0060 EDD1     		bne	.L138
 1534              	.LBB55:
 444:USBDevice/Class/DFU/usbd_dfu.c ****                         memcpy(dev->CtrlData, &dev->CtrlData[len - sizeof(dfu_desc.DFUFD)],
 1535              		.loc 1 444 25 is_stmt 1 view .LVU475
 1536              	.LBB56:
 1537              	.LBB57:
 1538              	.LBB58:
 1539              	.LBB59:
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 1540              		.loc 1 213 5 is_stmt 0 view .LVU476
 1541 0062 1E4E     		ldr	r6, .L158+8
 1542              	.LBE59:
 1543              	.LBE58:
 1544              	.LBE57:
 1545              	.LBE56:
 444:USBDevice/Class/DFU/usbd_dfu.c ****                         memcpy(dev->CtrlData, &dev->CtrlData[len - sizeof(dfu_desc.DFUFD)],
 1546              		.loc 1 444 81 view .LVU477
 1547 0064 05F58677 		add	r7, r5, #268
 1548              	.LVL115:
 1549              	.LBB67:
 1550              	.LBI56:
 277:USBDevice/Class/DFU/usbd_dfu.c **** {
 1551              		.loc 1 277 17 is_stmt 1 view .LVU478
 1552              	.LBB66:
 279:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = rodfu_getDesc(itf, ifNum, dest);
 1553              		.loc 1 279 5 view .LVU479
 280:USBDevice/Class/DFU/usbd_dfu.c **** 
 1554              		.loc 1 280 5 view .LVU480
 1555              	.LBB63:
 1556              	.LBI58:
 208:USBDevice/Class/DFU/usbd_dfu.c **** {
 1557              		.loc 1 208 17 view .LVU481
 1558              	.LBB60:
 210:USBDevice/Class/DFU/usbd_dfu.c ****     uint16_t len = sizeof(dfu_desc);
 1559              		.loc 1 210 5 view .LVU482
 211:USBDevice/Class/DFU/usbd_dfu.c **** 
 1560              		.loc 1 211 5 view .LVU483
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 1561              		.loc 1 213 5 view .LVU484
 1562 0068 0FCE     		ldmia	r6!, {r0, r1, r2, r3}
 1563              	.LVL116:
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 1564              		.loc 1 213 5 is_stmt 0 view .LVU485
 1565 006a 3688     		ldrh	r6, [r6]	@ unaligned
 1566 006c C5F81831 		str	r3, [r5, #280]	@ unaligned
 1567 0070 C5F80C01 		str	r0, [r5, #268]	@ unaligned
 1568 0074 A5F81C61 		strh	r6, [r5, #284]	@ unaligned
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 1569              		.loc 1 214 5 is_stmt 1 view .LVU486
 213:USBDevice/Class/DFU/usbd_dfu.c ****     desc->DFUFD.wDetachTimeOut = itf->Config.DetachTimeout_ms;
 1570              		.loc 1 213 5 is_stmt 0 view .LVU487
 1571 0078 C5F81011 		str	r1, [r5, #272]	@ unaligned
 1572 007c C5F81421 		str	r2, [r5, #276]	@ unaligned
 1573              	.LBE60:
 1574              	.LBE63:
 283:USBDevice/Class/DFU/usbd_dfu.c ****     {
ARM GAS  /tmp/ccCRZMdU.s 			page 51


 1575              		.loc 1 283 10 view .LVU488
 1576 0080 E368     		ldr	r3, [r4, #12]
 1577              	.LBB64:
 1578              	.LBB61:
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 1579              		.loc 1 214 32 view .LVU489
 1580 0082 A18A     		ldrh	r1, [r4, #20]
 1581              	.LBE61:
 1582              	.LBE64:
 283:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1583              		.loc 1 283 8 view .LVU490
 1584 0084 1A69     		ldr	r2, [r3, #16]
 1585              	.LBB65:
 1586              	.LBB62:
 214:USBDevice/Class/DFU/usbd_dfu.c **** 
 1587              		.loc 1 214 32 view .LVU491
 1588 0086 A5F81811 		strh	r1, [r5, #280]	@ unaligned
 217:USBDevice/Class/DFU/usbd_dfu.c **** 
 1589              		.loc 1 217 5 is_stmt 1 view .LVU492
 219:USBDevice/Class/DFU/usbd_dfu.c ****     return len;
 1590              		.loc 1 219 5 view .LVU493
 220:USBDevice/Class/DFU/usbd_dfu.c **** }
 1591              		.loc 1 220 5 view .LVU494
 1592              	.LVL117:
 220:USBDevice/Class/DFU/usbd_dfu.c **** }
 1593              		.loc 1 220 5 is_stmt 0 view .LVU495
 1594              	.LBE62:
 1595              	.LBE65:
 283:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1596              		.loc 1 283 5 is_stmt 1 view .LVU496
 283:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1597              		.loc 1 283 8 is_stmt 0 view .LVU497
 1598 008a 22B1     		cbz	r2, .L133
 283:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1599              		.loc 1 283 39 view .LVU498
 1600 008c 5A69     		ldr	r2, [r3, #20]
 1601 008e 12B1     		cbz	r2, .L133
 285:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1602              		.loc 1 285 9 is_stmt 1 view .LVU499
 285:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1603              		.loc 1 285 34 is_stmt 0 view .LVU500
 1604 0090 0922     		movs	r2, #9
 1605 0092 85F81721 		strb	r2, [r5, #279]
 1606              	.L133:
 287:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1607              		.loc 1 287 5 is_stmt 1 view .LVU501
 287:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1608              		.loc 1 287 8 is_stmt 0 view .LVU502
 1609 0096 9B69     		ldr	r3, [r3, #24]
 1610 0098 2BB1     		cbz	r3, .L134
 289:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1611              		.loc 1 289 9 is_stmt 1 view .LVU503
 289:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1612              		.loc 1 289 34 is_stmt 0 view .LVU504
 1613 009a 95F81731 		ldrb	r3, [r5, #279]	@ zero_extendqisi2
 1614 009e 43F00203 		orr	r3, r3, #2
 1615 00a2 85F81731 		strb	r3, [r5, #279]
ARM GAS  /tmp/ccCRZMdU.s 			page 52


 1616              	.L134:
 292:USBDevice/Class/DFU/usbd_dfu.c **** }
 1617              		.loc 1 292 5 is_stmt 1 view .LVU505
 1618              	.LVL118:
 292:USBDevice/Class/DFU/usbd_dfu.c **** }
 1619              		.loc 1 292 5 is_stmt 0 view .LVU506
 1620              	.LBE66:
 1621              	.LBE67:
 445:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1622              		.loc 1 445 25 is_stmt 1 view .LVU507
 1623 00a6 D5F81521 		ldr	r2, [r5, #277]	@ unaligned
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1624              		.loc 1 447 34 is_stmt 0 view .LVU508
 1625 00aa 3946     		mov	r1, r7
 445:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1626              		.loc 1 445 25 view .LVU509
 1627 00ac D5F81931 		ldr	r3, [r5, #281]	@ unaligned
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1628              		.loc 1 447 34 view .LVU510
 1629 00b0 2846     		mov	r0, r5
 445:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1630              		.loc 1 445 25 view .LVU511
 1631 00b2 C5F80C21 		str	r2, [r5, #268]	@ unaligned
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1632              		.loc 1 447 34 view .LVU512
 1633 00b6 0922     		movs	r2, #9
 445:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1634              		.loc 1 445 25 view .LVU513
 1635 00b8 7B60     		str	r3, [r7, #4]	@ unaligned
 1636 00ba 95F81D31 		ldrb	r3, [r5, #285]	@ zero_extendqisi2
 1637 00be 3B72     		strb	r3, [r7, #8]
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1638              		.loc 1 447 25 is_stmt 1 view .LVU514
 1639              	.LBE55:
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1640              		.loc 1 488 1 is_stmt 0 view .LVU515
 1641 00c0 BDE8F840 		pop	{r3, r4, r5, r6, r7, lr}
 1642              	.LCFI28:
 1643              		.cfi_remember_state
 1644              		.cfi_restore 14
 1645              		.cfi_restore 7
 1646              		.cfi_restore 6
 1647              		.cfi_restore 5
 1648              		.cfi_restore 4
 1649              		.cfi_restore 3
 1650              		.cfi_def_cfa_offset 0
 1651              	.LVL119:
 1652              	.LBB68:
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1653              		.loc 1 447 34 view .LVU516
 1654 00c4 FFF7FEBF 		b	USBD_CtrlSendData
 1655              	.LVL120:
 1656              	.L157:
 1657              	.LCFI29:
 1658              		.cfi_restore_state
 447:USBDevice/Class/DFU/usbd_dfu.c ****                                 sizeof(dfu_desc.DFUFD));
 1659              		.loc 1 447 34 view .LVU517
ARM GAS  /tmp/ccCRZMdU.s 			page 53


 1660              	.LBE68:
 1661              	.LBB69:
 474:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1662              		.loc 1 474 17 is_stmt 1 view .LVU518
 474:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1663              		.loc 1 474 38 is_stmt 0 view .LVU519
 1664 00c8 0023     		movs	r3, #0
 1665              	.LBE69:
 429:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_HandleType *dev = itf->Base.Device;
 1666              		.loc 1 429 21 view .LVU520
 1667 00ca 0320     		movs	r0, #3
 1668              	.LBB70:
 474:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1669              		.loc 1 474 38 view .LVU521
 1670 00cc 84F83030 		strb	r3, [r4, #48]
 1671              	.LVL121:
 474:USBDevice/Class/DFU/usbd_dfu.c ****             }
 1672              		.loc 1 474 38 view .LVU522
 1673              	.LBE70:
 487:USBDevice/Class/DFU/usbd_dfu.c **** }
 1674              		.loc 1 487 5 is_stmt 1 view .LVU523
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1675              		.loc 1 488 1 is_stmt 0 view .LVU524
 1676 00d0 F8BD     		pop	{r3, r4, r5, r6, r7, pc}
 1677              	.LVL122:
 1678              	.L159:
 488:USBDevice/Class/DFU/usbd_dfu.c **** 
 1679              		.loc 1 488 1 view .LVU525
 1680 00d2 00BF     		.align	2
 1681              	.L158:
 1682 00d4 00000000 		.word	.LANCHOR2
 1683 00d8 00000000 		.word	.LANCHOR3
 1684 00dc 00000000 		.word	.LANCHOR0
 1685              		.cfi_endproc
 1686              	.LFE155:
 1688              		.section	.text.USBD_DFU_BootInit,"ax",%progbits
 1689              		.align	1
 1690              		.p2align 2,,3
 1691              		.global	USBD_DFU_BootInit
 1692              		.syntax unified
 1693              		.thumb
 1694              		.thumb_func
 1695              		.fpu fpv4-sp-d16
 1697              	USBD_DFU_BootInit:
 1698              	.LVL123:
 1699              	.LFB164:
 869:USBDevice/Class/DFU/usbd_dfu.c **** 
 870:USBDevice/Class/DFU/usbd_dfu.c **** /** @} */
 871:USBDevice/Class/DFU/usbd_dfu.c **** 
 872:USBDevice/Class/DFU/usbd_dfu.c **** /** @defgroup USBD_DFU_Exported_Functions_Boot DFU Exported Functions for Bootloader
 873:USBDevice/Class/DFU/usbd_dfu.c ****  * @{ */
 874:USBDevice/Class/DFU/usbd_dfu.c **** 
 875:USBDevice/Class/DFU/usbd_dfu.c **** /**
 876:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Sets the necessary fields of the DFU interface.
 877:USBDevice/Class/DFU/usbd_dfu.c ****  * @note  This function shall be called in the DFU bootloader even if it jumps
 878:USBDevice/Class/DFU/usbd_dfu.c ****  *        to the application immediately.
 879:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
ARM GAS  /tmp/ccCRZMdU.s 			page 54


 880:USBDevice/Class/DFU/usbd_dfu.c ****  * @param pReboot: reference of the system rebooting function
 881:USBDevice/Class/DFU/usbd_dfu.c ****  * @param app: reference of the program memory handler
 882:USBDevice/Class/DFU/usbd_dfu.c ****  * @param appCount: array size of app parameter (only used when USBD_DFU_ALTSETTINGS != 0)
 883:USBDevice/Class/DFU/usbd_dfu.c ****  */
 884:USBDevice/Class/DFU/usbd_dfu.c **** void USBD_DFU_BootInit(USBD_DFU_IfHandleType *itf,
 885:USBDevice/Class/DFU/usbd_dfu.c ****                        USBD_DFU_RebootCbkType pReboot,
 886:USBDevice/Class/DFU/usbd_dfu.c ****                        const USBD_DFU_AppType *app, uint8_t appCount)
 887:USBDevice/Class/DFU/usbd_dfu.c **** {
 1700              		.loc 1 887 1 is_stmt 1 view -0
 1701              		.cfi_startproc
 1702              		@ args = 0, pretend = 0, frame = 0
 1703              		@ frame_needed = 0, uses_anonymous_args = 0
 1704              		@ link register save eliminated.
 888:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Base.Class  = &dfu_cbks;
 1705              		.loc 1 888 5 view .LVU527
 1706              	.LBB71:
 1707              	.LBB72:
 889:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 890:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Base.AltCount = appCount;
 891:USBDevice/Class/DFU/usbd_dfu.c **** #else
 892:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Base.AltCount = 1;
 893:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 894:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Base.AltSelector = 0;
 895:USBDevice/Class/DFU/usbd_dfu.c ****     itf->App = app;
 896:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Config.Reboot = pReboot;
 897:USBDevice/Class/DFU/usbd_dfu.c **** 
 898:USBDevice/Class/DFU/usbd_dfu.c ****     /* If DFU state is entered due to detach request, enter IDLE state
 899:USBDevice/Class/DFU/usbd_dfu.c ****      * Otherwise assume application firmware is missing */
 900:USBDevice/Class/DFU/usbd_dfu.c ****     if (USBD_DFU_IsRequested(itf))
 901:USBDevice/Class/DFU/usbd_dfu.c ****     {
 902:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State  = DFU_STATE_IDLE;
 903:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_NONE;
 904:USBDevice/Class/DFU/usbd_dfu.c ****     }
 905:USBDevice/Class/DFU/usbd_dfu.c ****     else
 906:USBDevice/Class/DFU/usbd_dfu.c ****     {
 907:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State  = DFU_STATE_ERROR;
 908:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_FIRMWARE;
 909:USBDevice/Class/DFU/usbd_dfu.c ****     }
 910:USBDevice/Class/DFU/usbd_dfu.c **** }
 911:USBDevice/Class/DFU/usbd_dfu.c **** 
 912:USBDevice/Class/DFU/usbd_dfu.c **** /**
 913:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Determines if DFU operation has been requested before the reset.
 914:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 915:USBDevice/Class/DFU/usbd_dfu.c ****  * @return TRUE if DFU mode is requested, FALSE otherwise
 916:USBDevice/Class/DFU/usbd_dfu.c ****  */
 917:USBDevice/Class/DFU/usbd_dfu.c **** int USBD_DFU_IsRequested(USBD_DFU_IfHandleType *itf)
 918:USBDevice/Class/DFU/usbd_dfu.c **** {
 919:USBDevice/Class/DFU/usbd_dfu.c ****     return ((itf->Tag[0] == DFU_MODE_TAG) && (itf->Tag[1] == (~DFU_MODE_TAG)));
 1708              		.loc 1 919 43 is_stmt 0 view .LVU528
 1709 0000 0F4B     		ldr	r3, .L166
 1710              	.LVL124:
 1711              		.loc 1 919 43 view .LVU529
 1712              	.LBE72:
 1713              	.LBE71:
 896:USBDevice/Class/DFU/usbd_dfu.c **** 
 1714              		.loc 1 896 24 view .LVU530
 1715 0002 0161     		str	r1, [r0, #16]
ARM GAS  /tmp/ccCRZMdU.s 			page 55


 1716              	.LBB77:
 1717              	.LBB73:
 1718              		.loc 1 919 43 view .LVU531
 1719 0004 C169     		ldr	r1, [r0, #28]
 1720              	.LVL125:
 1721              		.loc 1 919 43 view .LVU532
 1722              	.LBE73:
 1723              	.LBE77:
 895:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Config.Reboot = pReboot;
 1724              		.loc 1 895 14 view .LVU533
 1725 0006 C260     		str	r2, [r0, #12]
 1726              	.LBB78:
 1727              	.LBB74:
 1728              		.loc 1 919 43 view .LVU534
 1729 0008 9942     		cmp	r1, r3
 1730              	.LBE74:
 1731              	.LBE78:
 887:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Base.Class  = &dfu_cbks;
 1732              		.loc 1 887 1 view .LVU535
 1733 000a 30B4     		push	{r4, r5}
 1734              	.LCFI30:
 1735              		.cfi_def_cfa_offset 8
 1736              		.cfi_offset 4, -8
 1737              		.cfi_offset 5, -4
 888:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 1738              		.loc 1 888 22 view .LVU536
 1739 000c 0D4D     		ldr	r5, .L166+4
 894:USBDevice/Class/DFU/usbd_dfu.c ****     itf->App = app;
 1740              		.loc 1 894 27 view .LVU537
 1741 000e 4FF48074 		mov	r4, #256
 888:USBDevice/Class/DFU/usbd_dfu.c **** #if (USBD_DFU_ALTSETTINGS != 0)
 1742              		.loc 1 888 22 view .LVU538
 1743 0012 4560     		str	r5, [r0, #4]
 892:USBDevice/Class/DFU/usbd_dfu.c **** #endif
 1744              		.loc 1 892 5 is_stmt 1 view .LVU539
 894:USBDevice/Class/DFU/usbd_dfu.c ****     itf->App = app;
 1745              		.loc 1 894 5 view .LVU540
 894:USBDevice/Class/DFU/usbd_dfu.c ****     itf->App = app;
 1746              		.loc 1 894 27 is_stmt 0 view .LVU541
 1747 0014 0481     		strh	r4, [r0, #8]	@ movhi
 895:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Config.Reboot = pReboot;
 1748              		.loc 1 895 5 is_stmt 1 view .LVU542
 896:USBDevice/Class/DFU/usbd_dfu.c **** 
 1749              		.loc 1 896 5 view .LVU543
 900:USBDevice/Class/DFU/usbd_dfu.c ****     {
 1750              		.loc 1 900 5 view .LVU544
 1751              	.LVL126:
 1752              	.LBB79:
 1753              	.LBI71:
 917:USBDevice/Class/DFU/usbd_dfu.c **** {
 1754              		.loc 1 917 5 view .LVU545
 1755              	.LBB75:
 1756              		.loc 1 919 5 view .LVU546
 1757              		.loc 1 919 43 is_stmt 0 view .LVU547
 1758 0016 07D0     		beq	.L165
 1759              	.LVL127:
 1760              	.L163:
ARM GAS  /tmp/ccCRZMdU.s 			page 56


 1761              		.loc 1 919 43 view .LVU548
 1762              	.LBE75:
 1763              	.LBE79:
 908:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1764              		.loc 1 908 31 view .LVU549
 1765 0018 0A23     		movs	r3, #10
 907:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_FIRMWARE;
 1766              		.loc 1 907 31 view .LVU550
 1767 001a 1A46     		mov	r2, r3
 1768              	.LVL128:
 907:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_FIRMWARE;
 1769              		.loc 1 907 31 view .LVU551
 1770 001c 80F82C30 		strb	r3, [r0, #44]
 910:USBDevice/Class/DFU/usbd_dfu.c **** 
 1771              		.loc 1 910 1 view .LVU552
 1772 0020 30BC     		pop	{r4, r5}
 1773              	.LCFI31:
 1774              		.cfi_remember_state
 1775              		.cfi_restore 5
 1776              		.cfi_restore 4
 1777              		.cfi_def_cfa_offset 0
 1778 0022 80F83020 		strb	r2, [r0, #48]
 1779 0026 7047     		bx	lr
 1780              	.LVL129:
 1781              	.L165:
 1782              	.LCFI32:
 1783              		.cfi_restore_state
 1784              	.LBB80:
 1785              	.LBB76:
 1786              		.loc 1 919 43 view .LVU553
 1787 0028 074B     		ldr	r3, .L166+8
 1788 002a 026A     		ldr	r2, [r0, #32]
 1789              	.LVL130:
 1790              		.loc 1 919 43 view .LVU554
 1791 002c 9A42     		cmp	r2, r3
 1792 002e F3D1     		bne	.L163
 1793              	.LBE76:
 1794              	.LBE80:
 903:USBDevice/Class/DFU/usbd_dfu.c ****     }
 1795              		.loc 1 903 31 view .LVU555
 1796 0030 0023     		movs	r3, #0
 902:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_NONE;
 1797              		.loc 1 902 31 view .LVU556
 1798 0032 0222     		movs	r2, #2
 1799              	.LVL131:
 910:USBDevice/Class/DFU/usbd_dfu.c **** 
 1800              		.loc 1 910 1 view .LVU557
 1801 0034 30BC     		pop	{r4, r5}
 1802              	.LCFI33:
 1803              		.cfi_restore 5
 1804              		.cfi_restore 4
 1805              		.cfi_def_cfa_offset 0
 1806 0036 80F82C30 		strb	r3, [r0, #44]
 1807 003a 80F83020 		strb	r2, [r0, #48]
 1808 003e 7047     		bx	lr
 1809              	.L167:
 1810              		.align	2
ARM GAS  /tmp/ccCRZMdU.s 			page 57


 1811              	.L166:
 1812 0040 DF7007B0 		.word	-1341689633
 1813 0044 00000000 		.word	.LANCHOR4
 1814 0048 208FF84F 		.word	1341689632
 1815              		.cfi_endproc
 1816              	.LFE164:
 1818              		.section	.text.USBD_DFU_IsRequested,"ax",%progbits
 1819              		.align	1
 1820              		.p2align 2,,3
 1821              		.global	USBD_DFU_IsRequested
 1822              		.syntax unified
 1823              		.thumb
 1824              		.thumb_func
 1825              		.fpu fpv4-sp-d16
 1827              	USBD_DFU_IsRequested:
 1828              	.LVL132:
 1829              	.LFB165:
 918:USBDevice/Class/DFU/usbd_dfu.c ****     return ((itf->Tag[0] == DFU_MODE_TAG) && (itf->Tag[1] == (~DFU_MODE_TAG)));
 1830              		.loc 1 918 1 is_stmt 1 view -0
 1831              		.cfi_startproc
 1832              		@ args = 0, pretend = 0, frame = 0
 1833              		@ frame_needed = 0, uses_anonymous_args = 0
 1834              		@ link register save eliminated.
 1835              		.loc 1 919 5 view .LVU559
 1836              		.loc 1 919 43 is_stmt 0 view .LVU560
 1837 0000 064B     		ldr	r3, .L172
 1838 0002 C269     		ldr	r2, [r0, #28]
 1839 0004 9A42     		cmp	r2, r3
 1840 0006 01D0     		beq	.L171
 1841 0008 0020     		movs	r0, #0
 1842              	.LVL133:
 920:USBDevice/Class/DFU/usbd_dfu.c **** }
 1843              		.loc 1 920 1 view .LVU561
 1844 000a 7047     		bx	lr
 1845              	.LVL134:
 1846              	.L171:
 919:USBDevice/Class/DFU/usbd_dfu.c **** }
 1847              		.loc 1 919 43 discriminator 1 view .LVU562
 1848 000c 006A     		ldr	r0, [r0, #32]
 1849              	.LVL135:
 919:USBDevice/Class/DFU/usbd_dfu.c **** }
 1850              		.loc 1 919 43 discriminator 1 view .LVU563
 1851 000e 044B     		ldr	r3, .L172+4
 1852 0010 C01A     		subs	r0, r0, r3
 1853 0012 B0FA80F0 		clz	r0, r0
 1854 0016 4009     		lsrs	r0, r0, #5
 1855 0018 7047     		bx	lr
 1856              	.L173:
 1857 001a 00BF     		.align	2
 1858              	.L172:
 1859 001c DF7007B0 		.word	-1341689633
 1860 0020 208FF84F 		.word	1341689632
 1861              		.cfi_endproc
 1862              	.LFE165:
 1864              		.section	.text.USBD_DFU_AppInit,"ax",%progbits
 1865              		.align	1
 1866              		.p2align 2,,3
ARM GAS  /tmp/ccCRZMdU.s 			page 58


 1867              		.global	USBD_DFU_AppInit
 1868              		.syntax unified
 1869              		.thumb
 1870              		.thumb_func
 1871              		.fpu fpv4-sp-d16
 1873              	USBD_DFU_AppInit:
 1874              	.LVL136:
 1875              	.LFB166:
 921:USBDevice/Class/DFU/usbd_dfu.c **** 
 922:USBDevice/Class/DFU/usbd_dfu.c **** /** @} */
 923:USBDevice/Class/DFU/usbd_dfu.c **** 
 924:USBDevice/Class/DFU/usbd_dfu.c **** /** @defgroup USBD_DFU_Exported_Functions_App DFU Exported Functions for Application
 925:USBDevice/Class/DFU/usbd_dfu.c ****  * @{ */
 926:USBDevice/Class/DFU/usbd_dfu.c **** 
 927:USBDevice/Class/DFU/usbd_dfu.c **** /**
 928:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Sets the necessary fields of the DFU interface.
 929:USBDevice/Class/DFU/usbd_dfu.c ****  * @note  This function shall be called in the main application code.
 930:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 931:USBDevice/Class/DFU/usbd_dfu.c ****  * @param detachTimeout_ms: The necessary amount of time to safely shut down
 932:USBDevice/Class/DFU/usbd_dfu.c ****  *        the application before entering DFU mode
 933:USBDevice/Class/DFU/usbd_dfu.c ****  */
 934:USBDevice/Class/DFU/usbd_dfu.c **** void USBD_DFU_AppInit(USBD_DFU_IfHandleType *itf, uint16_t detachTimeout_ms)
 935:USBDevice/Class/DFU/usbd_dfu.c **** {
 1876              		.loc 1 935 1 is_stmt 1 view -0
 1877              		.cfi_startproc
 1878              		@ args = 0, pretend = 0, frame = 0
 1879              		@ frame_needed = 0, uses_anonymous_args = 0
 1880              		@ link register save eliminated.
 936:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Config.DetachTimeout_ms = detachTimeout_ms;
 1881              		.loc 1 936 5 view .LVU565
 937:USBDevice/Class/DFU/usbd_dfu.c **** 
 938:USBDevice/Class/DFU/usbd_dfu.c ****     /* Setting state in application */
 939:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.State  = DFU_STATE_APP_IDLE;
 1882              		.loc 1 939 27 is_stmt 0 view .LVU566
 1883 0000 0023     		movs	r3, #0
 936:USBDevice/Class/DFU/usbd_dfu.c ****     itf->Config.DetachTimeout_ms = detachTimeout_ms;
 1884              		.loc 1 936 34 view .LVU567
 1885 0002 8182     		strh	r1, [r0, #20]	@ movhi
 1886              		.loc 1 939 5 is_stmt 1 view .LVU568
 1887              		.loc 1 939 27 is_stmt 0 view .LVU569
 1888 0004 80F83030 		strb	r3, [r0, #48]
 940:USBDevice/Class/DFU/usbd_dfu.c ****     itf->DevStatus.Status = DFU_ERROR_NONE;
 1889              		.loc 1 940 5 is_stmt 1 view .LVU570
 1890              		.loc 1 940 27 is_stmt 0 view .LVU571
 1891 0008 80F82C30 		strb	r3, [r0, #44]
 941:USBDevice/Class/DFU/usbd_dfu.c **** }
 1892              		.loc 1 941 1 view .LVU572
 1893 000c 7047     		bx	lr
 1894              		.cfi_endproc
 1895              	.LFE166:
 1897 000e 00BF     		.section	.text.USBD_DFU_MountRebootOnly,"ax",%progbits
 1898              		.align	1
 1899              		.p2align 2,,3
 1900              		.global	USBD_DFU_MountRebootOnly
 1901              		.syntax unified
 1902              		.thumb
 1903              		.thumb_func
ARM GAS  /tmp/ccCRZMdU.s 			page 59


 1904              		.fpu fpv4-sp-d16
 1906              	USBD_DFU_MountRebootOnly:
 1907              	.LVL137:
 1908              	.LFB167:
 942:USBDevice/Class/DFU/usbd_dfu.c **** 
 943:USBDevice/Class/DFU/usbd_dfu.c **** /**
 944:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Mounts a reboot-only version of the DFU interface to the USB Device
 945:USBDevice/Class/DFU/usbd_dfu.c ****  *        at the next interface slot. Used for devices which have DFU implementation
 946:USBDevice/Class/DFU/usbd_dfu.c ****  *        in ROM.
 947:USBDevice/Class/DFU/usbd_dfu.c ****  * @note  The interface reference shall have its Config structure
 948:USBDevice/Class/DFU/usbd_dfu.c ****  *        properly set before this function is called.
 949:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 950:USBDevice/Class/DFU/usbd_dfu.c ****  * @param dev: reference of the USB Device
 951:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK if the mounting was successful,
 952:USBDevice/Class/DFU/usbd_dfu.c ****  *         ERROR if it failed due to insufficient device interface slots
 953:USBDevice/Class/DFU/usbd_dfu.c ****  */
 954:USBDevice/Class/DFU/usbd_dfu.c **** USBD_ReturnType USBD_DFU_MountRebootOnly(USBD_DFU_IfHandleType *itf, USBD_HandleType *dev)
 955:USBDevice/Class/DFU/usbd_dfu.c **** {
 1909              		.loc 1 955 1 is_stmt 1 view -0
 1910              		.cfi_startproc
 1911              		@ args = 0, pretend = 0, frame = 0
 1912              		@ frame_needed = 0, uses_anonymous_args = 0
 1913              		@ link register save eliminated.
 956:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_ERROR;
 1914              		.loc 1 956 5 view .LVU574
 957:USBDevice/Class/DFU/usbd_dfu.c **** 
 958:USBDevice/Class/DFU/usbd_dfu.c ****     if (dev->IfCount < USBD_MAX_IF_COUNT)
 1915              		.loc 1 958 5 view .LVU575
 1916              		.loc 1 958 12 is_stmt 0 view .LVU576
 1917 0000 91F82920 		ldrb	r2, [r1, #41]	@ zero_extendqisi2
 1918              		.loc 1 958 8 view .LVU577
 1919 0004 072A     		cmp	r2, #7
 1920 0006 13D8     		bhi	.L177
 959:USBDevice/Class/DFU/usbd_dfu.c ****     {
 960:USBDevice/Class/DFU/usbd_dfu.c ****         /* Binding interfaces */
 961:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.Device = dev;
 1921              		.loc 1 961 9 is_stmt 1 view .LVU578
 1922 0008 0346     		mov	r3, r0
 962:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.Class  = &rodfu_cbks;
 963:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.AltCount = 1;
 964:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.AltSelector = 0;
 1923              		.loc 1 964 31 is_stmt 0 view .LVU579
 1924 000a 4FF48070 		mov	r0, #256
 1925              	.LVL138:
 955:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_ERROR;
 1926              		.loc 1 955 1 view .LVU580
 1927 000e 70B4     		push	{r4, r5, r6}
 1928              	.LCFI34:
 1929              		.cfi_def_cfa_offset 12
 1930              		.cfi_offset 4, -12
 1931              		.cfi_offset 5, -8
 1932              		.cfi_offset 6, -4
 965:USBDevice/Class/DFU/usbd_dfu.c **** 
 966:USBDevice/Class/DFU/usbd_dfu.c ****         /* Setting state in application */
 967:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.State  = DFU_STATE_APP_IDLE;
 968:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_NONE;
 1933              		.loc 1 968 31 view .LVU581
ARM GAS  /tmp/ccCRZMdU.s 			page 60


 1934 0010 0024     		movs	r4, #0
 969:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.__reserved  = 0;
 970:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.iString     = 0;
 971:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.PollTimeout = 0;
 972:USBDevice/Class/DFU/usbd_dfu.c **** 
 973:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IF[dev->IfCount] = (USBD_IfHandleType*)itf;
 1935              		.loc 1 973 31 view .LVU582
 1936 0012 01EB8205 		add	r5, r1, r2, lsl #2
 962:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.AltCount = 1;
 1937              		.loc 1 962 26 view .LVU583
 1938 0016 074E     		ldr	r6, .L182
 974:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 1939              		.loc 1 974 21 view .LVU584
 1940 0018 0132     		adds	r2, r2, #1
 964:USBDevice/Class/DFU/usbd_dfu.c **** 
 1941              		.loc 1 964 31 view .LVU585
 1942 001a 1881     		strh	r0, [r3, #8]	@ movhi
 975:USBDevice/Class/DFU/usbd_dfu.c **** 
 976:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 1943              		.loc 1 976 16 view .LVU586
 1944 001c 2046     		mov	r0, r4
 968:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.__reserved  = 0;
 1945              		.loc 1 968 31 view .LVU587
 1946 001e DC62     		str	r4, [r3, #44]
 967:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_NONE;
 1947              		.loc 1 967 31 view .LVU588
 1948 0020 1C86     		strh	r4, [r3, #48]	@ movhi
 962:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.AltCount = 1;
 1949              		.loc 1 962 26 view .LVU589
 1950 0022 C3E90016 		strd	r1, r6, [r3]
 963:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.AltSelector = 0;
 1951              		.loc 1 963 9 is_stmt 1 view .LVU590
 964:USBDevice/Class/DFU/usbd_dfu.c **** 
 1952              		.loc 1 964 9 view .LVU591
 967:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.Status = DFU_ERROR_NONE;
 1953              		.loc 1 967 9 view .LVU592
 968:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.__reserved  = 0;
 1954              		.loc 1 968 9 view .LVU593
 969:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.iString     = 0;
 1955              		.loc 1 969 9 view .LVU594
 970:USBDevice/Class/DFU/usbd_dfu.c ****         itf->DevStatus.PollTimeout = 0;
 1956              		.loc 1 970 9 view .LVU595
 971:USBDevice/Class/DFU/usbd_dfu.c **** 
 1957              		.loc 1 971 9 view .LVU596
 973:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 1958              		.loc 1 973 9 view .LVU597
 973:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 1959              		.loc 1 973 31 is_stmt 0 view .LVU598
 1960 0026 EB62     		str	r3, [r5, #44]
 974:USBDevice/Class/DFU/usbd_dfu.c **** 
 1961              		.loc 1 974 9 is_stmt 1 view .LVU599
 974:USBDevice/Class/DFU/usbd_dfu.c **** 
 1962              		.loc 1 974 21 is_stmt 0 view .LVU600
 1963 0028 81F82920 		strb	r2, [r1, #41]
 1964              		.loc 1 976 9 is_stmt 1 view .LVU601
 1965              	.LVL139:
 977:USBDevice/Class/DFU/usbd_dfu.c ****     }
ARM GAS  /tmp/ccCRZMdU.s 			page 61


 978:USBDevice/Class/DFU/usbd_dfu.c **** 
 979:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
 1966              		.loc 1 979 5 view .LVU602
 980:USBDevice/Class/DFU/usbd_dfu.c **** }
 1967              		.loc 1 980 1 is_stmt 0 view .LVU603
 1968 002c 70BC     		pop	{r4, r5, r6}
 1969              	.LCFI35:
 1970              		.cfi_restore 6
 1971              		.cfi_restore 5
 1972              		.cfi_restore 4
 1973              		.cfi_def_cfa_offset 0
 1974 002e 7047     		bx	lr
 1975              	.LVL140:
 1976              	.L177:
 956:USBDevice/Class/DFU/usbd_dfu.c **** 
 1977              		.loc 1 956 21 view .LVU604
 1978 0030 0120     		movs	r0, #1
 1979              	.LVL141:
 979:USBDevice/Class/DFU/usbd_dfu.c **** }
 1980              		.loc 1 979 5 is_stmt 1 view .LVU605
 1981              		.loc 1 980 1 is_stmt 0 view .LVU606
 1982 0032 7047     		bx	lr
 1983              	.L183:
 1984              		.align	2
 1985              	.L182:
 1986 0034 00000000 		.word	.LANCHOR5
 1987              		.cfi_endproc
 1988              	.LFE167:
 1990              		.section	.text.USBD_DFU_MountInterface,"ax",%progbits
 1991              		.align	1
 1992              		.p2align 2,,3
 1993              		.global	USBD_DFU_MountInterface
 1994              		.syntax unified
 1995              		.thumb
 1996              		.thumb_func
 1997              		.fpu fpv4-sp-d16
 1999              	USBD_DFU_MountInterface:
 2000              	.LVL142:
 2001              	.LFB168:
 981:USBDevice/Class/DFU/usbd_dfu.c **** 
 982:USBDevice/Class/DFU/usbd_dfu.c **** /** @} */
 983:USBDevice/Class/DFU/usbd_dfu.c **** 
 984:USBDevice/Class/DFU/usbd_dfu.c **** /** @defgroup USBD_DFU_Exported_Functions DFU Common Exported Functions
 985:USBDevice/Class/DFU/usbd_dfu.c ****  * @{ */
 986:USBDevice/Class/DFU/usbd_dfu.c **** 
 987:USBDevice/Class/DFU/usbd_dfu.c **** /**
 988:USBDevice/Class/DFU/usbd_dfu.c ****  * @brief Mounts the DFU interface to the USB Device at the next interface slot.
 989:USBDevice/Class/DFU/usbd_dfu.c ****  * @note  The interface reference shall have its Config structure and App reference
 990:USBDevice/Class/DFU/usbd_dfu.c ****  *        properly set before this function is called.
 991:USBDevice/Class/DFU/usbd_dfu.c ****  * @param itf: reference of the DFU interface
 992:USBDevice/Class/DFU/usbd_dfu.c ****  * @param dev: reference of the USB Device
 993:USBDevice/Class/DFU/usbd_dfu.c ****  * @return OK if the mounting was successful,
 994:USBDevice/Class/DFU/usbd_dfu.c ****  *         ERROR if it failed due to insufficient device interface slots
 995:USBDevice/Class/DFU/usbd_dfu.c ****  */
 996:USBDevice/Class/DFU/usbd_dfu.c **** USBD_ReturnType USBD_DFU_MountInterface(USBD_DFU_IfHandleType *itf, USBD_HandleType *dev)
 997:USBDevice/Class/DFU/usbd_dfu.c **** {
 2002              		.loc 1 997 1 is_stmt 1 view -0
ARM GAS  /tmp/ccCRZMdU.s 			page 62


 2003              		.cfi_startproc
 2004              		@ args = 0, pretend = 0, frame = 0
 2005              		@ frame_needed = 0, uses_anonymous_args = 0
 2006              		@ link register save eliminated.
 998:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_ERROR;
 2007              		.loc 1 998 5 view .LVU608
 999:USBDevice/Class/DFU/usbd_dfu.c **** 
1000:USBDevice/Class/DFU/usbd_dfu.c ****     if (dev->IfCount < USBD_MAX_IF_COUNT)
 2008              		.loc 1 1000 5 view .LVU609
 2009              		.loc 1 1000 12 is_stmt 0 view .LVU610
 2010 0000 91F82930 		ldrb	r3, [r1, #41]	@ zero_extendqisi2
 2011              		.loc 1 1000 8 view .LVU611
 2012 0004 072B     		cmp	r3, #7
 2013 0006 0CD8     		bhi	.L186
1001:USBDevice/Class/DFU/usbd_dfu.c ****     {
1002:USBDevice/Class/DFU/usbd_dfu.c ****         /* Binding interfaces */
1003:USBDevice/Class/DFU/usbd_dfu.c ****         itf->Base.Device = dev;
 2014              		.loc 1 1003 9 is_stmt 1 view .LVU612
 2015 0008 0246     		mov	r2, r0
 997:USBDevice/Class/DFU/usbd_dfu.c ****     USBD_ReturnType retval = USBD_E_ERROR;
 2016              		.loc 1 997 1 is_stmt 0 view .LVU613
 2017 000a 10B4     		push	{r4}
 2018              	.LCFI36:
 2019              		.cfi_def_cfa_offset 4
 2020              		.cfi_offset 4, -4
1004:USBDevice/Class/DFU/usbd_dfu.c **** 
1005:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IF[dev->IfCount] = (USBD_IfHandleType*)itf;
 2021              		.loc 1 1005 31 view .LVU614
 2022 000c 01EB8304 		add	r4, r1, r3, lsl #2
1006:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 2023              		.loc 1 1006 21 view .LVU615
 2024 0010 0133     		adds	r3, r3, #1
1003:USBDevice/Class/DFU/usbd_dfu.c **** 
 2025              		.loc 1 1003 26 view .LVU616
 2026 0012 0160     		str	r1, [r0]
1005:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 2027              		.loc 1 1005 9 is_stmt 1 view .LVU617
1007:USBDevice/Class/DFU/usbd_dfu.c **** 
1008:USBDevice/Class/DFU/usbd_dfu.c ****         retval = USBD_E_OK;
 2028              		.loc 1 1008 16 is_stmt 0 view .LVU618
 2029 0014 0020     		movs	r0, #0
 2030              	.LVL143:
1005:USBDevice/Class/DFU/usbd_dfu.c ****         dev->IfCount++;
 2031              		.loc 1 1005 31 view .LVU619
 2032 0016 E262     		str	r2, [r4, #44]
1006:USBDevice/Class/DFU/usbd_dfu.c **** 
 2033              		.loc 1 1006 9 is_stmt 1 view .LVU620
1009:USBDevice/Class/DFU/usbd_dfu.c ****     }
1010:USBDevice/Class/DFU/usbd_dfu.c **** 
1011:USBDevice/Class/DFU/usbd_dfu.c ****     return retval;
1012:USBDevice/Class/DFU/usbd_dfu.c **** }
 2034              		.loc 1 1012 1 is_stmt 0 view .LVU621
 2035 0018 5DF8044B 		ldr	r4, [sp], #4
 2036              	.LCFI37:
 2037              		.cfi_restore 4
 2038              		.cfi_def_cfa_offset 0
1006:USBDevice/Class/DFU/usbd_dfu.c **** 
ARM GAS  /tmp/ccCRZMdU.s 			page 63


 2039              		.loc 1 1006 21 view .LVU622
 2040 001c 81F82930 		strb	r3, [r1, #41]
1008:USBDevice/Class/DFU/usbd_dfu.c ****     }
 2041              		.loc 1 1008 9 is_stmt 1 view .LVU623
 2042              	.LVL144:
1011:USBDevice/Class/DFU/usbd_dfu.c **** }
 2043              		.loc 1 1011 5 view .LVU624
 2044              		.loc 1 1012 1 is_stmt 0 view .LVU625
 2045 0020 7047     		bx	lr
 2046              	.LVL145:
 2047              	.L186:
 998:USBDevice/Class/DFU/usbd_dfu.c **** 
 2048              		.loc 1 998 21 view .LVU626
 2049 0022 0120     		movs	r0, #1
 2050              	.LVL146:
1011:USBDevice/Class/DFU/usbd_dfu.c **** }
 2051              		.loc 1 1011 5 is_stmt 1 view .LVU627
 2052              		.loc 1 1012 1 is_stmt 0 view .LVU628
 2053 0024 7047     		bx	lr
 2054              		.cfi_endproc
 2055              	.LFE168:
 2057 0026 00BF     		.section	.rodata.dfu_cbks,"a"
 2058              		.align	2
 2059              		.set	.LANCHOR4,. + 0
 2062              	dfu_cbks:
 2063 0000 00000000 		.word	dfu_getDesc
 2064 0004 00000000 		.word	dfu_getString
 2065 0008 00000000 		.word	dfu_init
 2066 000c 00000000 		.word	dfu_deinit
 2067 0010 00000000 		.word	dfu_setupStage
 2068 0014 00000000 		.word	dfu_dataStage
 2069 0018 00000000 		.space	8
 2069      00000000 
 2070              		.section	.rodata.dfu_desc,"a"
 2071              		.align	2
 2072              		.set	.LANCHOR0,. + 0
 2075              	dfu_desc:
 2076 0000 09       		.byte	9
 2077 0001 04       		.byte	4
 2078 0002 00       		.byte	0
 2079 0003 00       		.byte	0
 2080 0004 00       		.byte	0
 2081 0005 FE       		.byte	-2
 2082 0006 01       		.byte	1
 2083 0007 02       		.byte	2
 2084 0008 01       		.byte	1
 2085 0009 09       		.byte	9
 2086 000a 21       		.byte	33
 2087 000b 08       		.byte	8
 2088 000c 6400     		.2byte	100
 2089 000e 0002     		.2byte	512
 2090 0010 1A01     		.2byte	282
 2091              		.section	.rodata.dfu_reqFns,"a"
 2092              		.align	2
 2093              		.set	.LANCHOR3,. + 0
 2096              	dfu_reqFns:
 2097 0000 00000000 		.word	dfu_detach
ARM GAS  /tmp/ccCRZMdU.s 			page 64


 2098 0004 00000000 		.word	dfu_download
 2099 0008 00000000 		.word	dfu_upload
 2100 000c 00000000 		.word	dfu_getStatus
 2101 0010 00000000 		.word	dfu_clearStatus
 2102 0014 00000000 		.word	dfu_getState
 2103 0018 00000000 		.word	dfu_abort
 2104              		.section	.rodata.dfu_validStates,"a"
 2105              		.align	2
 2106              		.set	.LANCHOR2,. + 0
 2109              	dfu_validStates:
 2110 0000 0100     		.short	1
 2111 0002 2400     		.short	36
 2112 0004 0402     		.short	516
 2113 0006 6F06     		.short	1647
 2114 0008 0004     		.short	1024
 2115 000a 6F06     		.short	1647
 2116 000c 6C02     		.short	620
 2117              		.section	.rodata.dfuse_cmds,"a"
 2118              		.align	2
 2119              		.set	.LANCHOR1,. + 0
 2122              	dfuse_cmds:
 2123 0000 002141   		.ascii	"\000!A"
 2124              		.section	.rodata.rodfu_cbks,"a"
 2125              		.align	2
 2126              		.set	.LANCHOR5,. + 0
 2129              	rodfu_cbks:
 2130 0000 00000000 		.word	rodfu_getDesc
 2131 0004 00000000 		.word	dfu_getString
 2132 0008 00000000 		.space	8
 2132      00000000 
 2133 0010 00000000 		.word	rodfu_setupStage
 2134 0014 00000000 		.space	12
 2134      00000000 
 2134      00000000 
 2135              		.text
 2136              	.Letext0:
 2137              		.file 2 "/usr/arm-none-eabi/include/machine/_default_types.h"
 2138              		.file 3 "/usr/arm-none-eabi/include/sys/_stdint.h"
 2139              		.file 4 "USBDevice/Include/usb_types.h"
 2140              		.file 5 "STM32_XPD/STM32H7_XPD/inc/xpd_common.h"
 2141              		.file 6 "STM32_XPD/CMSIS/Include/core_cm7.h"
 2142              		.file 7 "STM32_XPD/CMSIS/Device/ST/STM32H7xx/Include/system_stm32h7xx.h"
 2143              		.file 8 "STM32_XPD/CMSIS/Device/ST/STM32H7xx/Include/stm32h743xx.h"
 2144              		.file 9 "USBDevice/PDs/STM32_XPD/usbd_pd_def.h"
 2145              		.file 10 "USBDevice/Include/usbd_types.h"
 2146              		.file 11 "/usr/arm-none-eabi/include/sys/lock.h"
 2147              		.file 12 "/usr/arm-none-eabi/include/sys/_types.h"
 2148              		.file 13 "/usr/lib/gcc/arm-none-eabi/9.2.0/include/stddef.h"
 2149              		.file 14 "/usr/arm-none-eabi/include/sys/reent.h"
 2150              		.file 15 "USBDevice/Include/usbd_dfu.h"
 2151              		.file 16 "USBDevice/Include/usbd.h"
 2152              		.file 17 "USBDevice/Include/private/usbd_internal.h"
ARM GAS  /tmp/ccCRZMdU.s 			page 65


DEFINED SYMBOLS
                            *ABS*:0000000000000000 usbd_dfu.c
     /tmp/ccCRZMdU.s:18     .text.rodfu_getDesc:0000000000000000 $t
     /tmp/ccCRZMdU.s:26     .text.rodfu_getDesc:0000000000000000 rodfu_getDesc
     /tmp/ccCRZMdU.s:94     .text.rodfu_getDesc:000000000000002c $d
     /tmp/ccCRZMdU.s:99     .text.dfu_getDesc:0000000000000000 $t
     /tmp/ccCRZMdU.s:106    .text.dfu_getDesc:0000000000000000 dfu_getDesc
     /tmp/ccCRZMdU.s:222    .text.dfu_getDesc:0000000000000048 $d
     /tmp/ccCRZMdU.s:227    .text.dfu_getString:0000000000000000 $t
     /tmp/ccCRZMdU.s:234    .text.dfu_getString:0000000000000000 dfu_getString
     /tmp/ccCRZMdU.s:254    .text.dfu_clearStatus:0000000000000000 $t
     /tmp/ccCRZMdU.s:261    .text.dfu_clearStatus:0000000000000000 dfu_clearStatus
     /tmp/ccCRZMdU.s:295    .text.dfu_abort:0000000000000000 $t
     /tmp/ccCRZMdU.s:302    .text.dfu_abort:0000000000000000 dfu_abort
     /tmp/ccCRZMdU.s:340    .text.dfu_dataStage:0000000000000000 $t
     /tmp/ccCRZMdU.s:347    .text.dfu_dataStage:0000000000000000 dfu_dataStage
     /tmp/ccCRZMdU.s:596    .text.dfu_detach:0000000000000000 $t
     /tmp/ccCRZMdU.s:603    .text.dfu_detach:0000000000000000 dfu_detach
     /tmp/ccCRZMdU.s:656    .text.dfu_detach:0000000000000024 $d
     /tmp/ccCRZMdU.s:662    .text.dfu_getState:0000000000000000 $t
     /tmp/ccCRZMdU.s:669    .text.dfu_getState:0000000000000000 dfu_getState
     /tmp/ccCRZMdU.s:692    .text.dfu_getStatus:0000000000000000 $t
     /tmp/ccCRZMdU.s:699    .text.dfu_getStatus:0000000000000000 dfu_getStatus
     /tmp/ccCRZMdU.s:803    .text.dfu_upload:0000000000000000 $t
     /tmp/ccCRZMdU.s:810    .text.dfu_upload:0000000000000000 dfu_upload
     /tmp/ccCRZMdU.s:979    .text.dfu_upload:0000000000000070 $d
     /tmp/ccCRZMdU.s:984    .text.rodfu_setupStage:0000000000000000 $t
     /tmp/ccCRZMdU.s:991    .text.rodfu_setupStage:0000000000000000 rodfu_setupStage
     /tmp/ccCRZMdU.s:1174   .text.rodfu_setupStage:000000000000008c $d
     /tmp/ccCRZMdU.s:1183   .text.dfu_download:0000000000000000 $t
     /tmp/ccCRZMdU.s:1190   .text.dfu_download:0000000000000000 dfu_download
     /tmp/ccCRZMdU.s:1291   .text.dfu_init:0000000000000000 $t
     /tmp/ccCRZMdU.s:1298   .text.dfu_init:0000000000000000 dfu_init
     /tmp/ccCRZMdU.s:1358   .text.dfu_deinit:0000000000000000 $t
     /tmp/ccCRZMdU.s:1365   .text.dfu_deinit:0000000000000000 dfu_deinit
     /tmp/ccCRZMdU.s:1401   .text.dfu_setupStage:0000000000000000 $t
     /tmp/ccCRZMdU.s:1408   .text.dfu_setupStage:0000000000000000 dfu_setupStage
     /tmp/ccCRZMdU.s:1682   .text.dfu_setupStage:00000000000000d4 $d
     /tmp/ccCRZMdU.s:1689   .text.USBD_DFU_BootInit:0000000000000000 $t
     /tmp/ccCRZMdU.s:1697   .text.USBD_DFU_BootInit:0000000000000000 USBD_DFU_BootInit
     /tmp/ccCRZMdU.s:1812   .text.USBD_DFU_BootInit:0000000000000040 $d
     /tmp/ccCRZMdU.s:1819   .text.USBD_DFU_IsRequested:0000000000000000 $t
     /tmp/ccCRZMdU.s:1827   .text.USBD_DFU_IsRequested:0000000000000000 USBD_DFU_IsRequested
     /tmp/ccCRZMdU.s:1859   .text.USBD_DFU_IsRequested:000000000000001c $d
     /tmp/ccCRZMdU.s:1865   .text.USBD_DFU_AppInit:0000000000000000 $t
     /tmp/ccCRZMdU.s:1873   .text.USBD_DFU_AppInit:0000000000000000 USBD_DFU_AppInit
     /tmp/ccCRZMdU.s:1898   .text.USBD_DFU_MountRebootOnly:0000000000000000 $t
     /tmp/ccCRZMdU.s:1906   .text.USBD_DFU_MountRebootOnly:0000000000000000 USBD_DFU_MountRebootOnly
     /tmp/ccCRZMdU.s:1986   .text.USBD_DFU_MountRebootOnly:0000000000000034 $d
     /tmp/ccCRZMdU.s:1991   .text.USBD_DFU_MountInterface:0000000000000000 $t
     /tmp/ccCRZMdU.s:1999   .text.USBD_DFU_MountInterface:0000000000000000 USBD_DFU_MountInterface
     /tmp/ccCRZMdU.s:2058   .rodata.dfu_cbks:0000000000000000 $d
     /tmp/ccCRZMdU.s:2062   .rodata.dfu_cbks:0000000000000000 dfu_cbks
     /tmp/ccCRZMdU.s:2071   .rodata.dfu_desc:0000000000000000 $d
     /tmp/ccCRZMdU.s:2075   .rodata.dfu_desc:0000000000000000 dfu_desc
     /tmp/ccCRZMdU.s:2092   .rodata.dfu_reqFns:0000000000000000 $d
     /tmp/ccCRZMdU.s:2096   .rodata.dfu_reqFns:0000000000000000 dfu_reqFns
ARM GAS  /tmp/ccCRZMdU.s 			page 66


     /tmp/ccCRZMdU.s:2105   .rodata.dfu_validStates:0000000000000000 $d
     /tmp/ccCRZMdU.s:2109   .rodata.dfu_validStates:0000000000000000 dfu_validStates
     /tmp/ccCRZMdU.s:2118   .rodata.dfuse_cmds:0000000000000000 $d
     /tmp/ccCRZMdU.s:2122   .rodata.dfuse_cmds:0000000000000000 dfuse_cmds
     /tmp/ccCRZMdU.s:2125   .rodata.rodfu_cbks:0000000000000000 $d
     /tmp/ccCRZMdU.s:2129   .rodata.rodfu_cbks:0000000000000000 rodfu_cbks

UNDEFINED SYMBOLS
USBD_Deinit
USBD_CtrlSendData
USBD_CtrlReceiveData
